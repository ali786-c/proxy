import{U as y,i as m,j as e,L as b,t as x}from"./index-BvLG_Cmp.js";import{S as w}from"./SEOHead-C7wUOs76.js";import{C,a as N,b as q,c as T}from"./card-Bin9LNbn.js";import{B as v}from"./badge-JftCyNWw.js";import{S as P}from"./switch-_QfATPvm.js";import{T as S,a as _,b as p,c,d as B,e as l}from"./table-DpDD3EaK.js";import{s as n}from"./client-DBtcxyoE.js";import{u as E}from"./useMutation-D0YRZUa4.js";function L(){const h=y(),{data:t}=m({queryKey:["permissions"],queryFn:async()=>{const{data:r,error:s}=await n.from("permissions").select("*").order("category");if(s)throw s;return r??[]}}),{data:o}=m({queryKey:["role-permissions"],queryFn:async()=>{const{data:r,error:s}=await n.from("role_permissions").select("*");if(s)throw s;return r??[]}}),u=E({mutationFn:async({role:r,permissionId:s,enabled:a})=>{if(a){const{error:i}=await n.from("role_permissions").insert({role:r,permission_id:s});if(i)throw i}else{const{error:i}=await n.from("role_permissions").delete().eq("role",r).eq("permission_id",s);if(i)throw i}},onSuccess:()=>{h.invalidateQueries({queryKey:["role-permissions"]}),x({title:"Permission Updated"})},onError:r=>x({title:"Error",description:r.message,variant:"destructive"})}),f=(r,s)=>(o==null?void 0:o.some(a=>a.role===r&&a.permission_id===s))??!1,j=[...new Set((t==null?void 0:t.map(r=>r.category))??[])],d=["admin","client"],g={proxy:"ðŸŒ",billing:"ðŸ’³",support:"ðŸŽ§",users:"ðŸ‘¥",api:"ðŸ”‘",audit:"ðŸ“‹",settings:"âš™ï¸",org:"ðŸ¢"};return e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Admin â€” Permissions",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"h-6 w-6"})," Role Permissions (RBAC)"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage granular permissions for each role."})]}),j.map(r=>e.jsxs(C,{children:[e.jsx(N,{children:e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx("span",{children:g[r]??"ðŸ“¦"}),e.jsx("span",{className:"capitalize",children:r})]})}),e.jsx(T,{className:"p-0",children:e.jsxs(S,{children:[e.jsx(_,{children:e.jsxs(p,{children:[e.jsx(c,{children:"Permission"}),e.jsx(c,{children:"Description"}),d.map(s=>e.jsx(c,{className:"text-center capitalize",children:s},s))]})}),e.jsx(B,{children:t==null?void 0:t.filter(s=>s.category===r).map(s=>e.jsxs(p,{children:[e.jsx(l,{children:e.jsx(v,{variant:"outline",className:"font-mono text-xs",children:s.name})}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.description}),d.map(a=>e.jsx(l,{className:"text-center",children:e.jsx(P,{checked:f(a,s.id),onCheckedChange:i=>u.mutate({role:a,permissionId:s.id,enabled:i}),disabled:a==="admin"})},a))]},s.id))})]})})]},r))]})]})}export{L as default};
