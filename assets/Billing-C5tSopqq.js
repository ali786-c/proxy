import{j as e,x as n}from"./ui-EGoD6bOB.js";import{r as c}from"./vendor-D4fZgtk8.js";import{S as W}from"./SEOHead-DioMGEto.js";import{C as h,a as p,b as j,d as Q,c as y}from"./card-CvUn82-G.js";import{T as Y,a as J,b as E,c as f,d as X,e as g}from"./table-XHShCuR9.js";import{j as M,I as N,B as w,k as Z,c as d}from"./index-D6pcsuBO.js";import{L as b}from"./label-D2s1eK-x.js";import{S as ee}from"./switch-B9VArCkN.js";import{M as se}from"./ManualCryptoDialog-C9i8mHA6.js";const te=.22,m=5,ae={paid:"default",pending:"secondary",failed:"destructive"};function xe(){const[A]=c.useState("residential"),{gateways:o,autoTopUpEnabled:F}=usePaymentConfig(),[S,T]=c.useState(!1),[U,_]=c.useState("50"),[D,L]=c.useState("5"),[r,I]=c.useState(null),[R,V]=c.useState(""),[u,i]=c.useState(!1),[$,P]=c.useState(!1),{data:H}=M({queryKey:["plans"],queryFn:()=>d.getPlans()}),{data:O}=M({queryKey:["invoices"],queryFn:()=>d.getInvoices()}),l=parseFloat(amount)||0,x=r==="cryptomus"||r==="manual",k=x?0:l*te,v=l+k,C=l<m,q=s=>{toast({title:"Product Selected",description:`Switching to ${s}.`})},z=async s=>{if(T(s),s)try{const{client_secret:t}=await d.createSetupIntent();toast({title:"Card setup started",description:"Please follow the instructions to save your card for auto top-up."})}catch(t){toast({title:"Setup Error",description:t.message,variant:"destructive"}),T(!1)}},G=async()=>{if(C){toast({title:"Minimum not met",description:`Minimum purchase is €${m}.`,variant:"destructive"});return}if(!r){toast({title:"Select a payment method",description:"Please choose how you'd like to pay.",variant:"destructive"});return}if(r==="cryptomus"){i(!0);try{const{url:s}=await d.createCryptomusCheckout(l);window.location.href=s}catch(s){toast({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{i(!1)}}else if(r==="stripe"){i(!0);try{const{url:s}=await d.createCheckout(A,l);window.location.href=s}catch(s){toast({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{i(!1)}}else r==="manual"?P(!0):toast({title:`Pay with ${r}`,description:`Redirecting to ${r} checkout for €${v.toFixed(2)}...`})},B=[{id:"stripe",name:"Card (Stripe)",subtitle:"Credit/Debit Card",icon:CreditCard,vatLabel:"+22% VAT",enabled:o.stripe},{id:"paypal",name:"PayPal",subtitle:"PayPal Balance",icon:Wallet,vatLabel:"+22% VAT",enabled:o.paypal},{id:"cryptomus",name:"Crypto",subtitle:"Automated via Cryptomus",icon:Bitcoin,vatLabel:"No VAT",enabled:o.cryptomus},{id:"manual",name:"Binance Pay",subtitle:"Manual Transfer",icon:Bitcoin,vatLabel:"No VAT",enabled:o.crypto}].filter(s=>s.enabled),K=B.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Account & Billing",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Account & Billing"}),e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(j,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Euro,{className:"h-5 w-5"})," Add Balance"]}),e.jsxs(Q,{children:["Minimum purchase: €",m,". 22% VAT applies to card & PayPal payments. Crypto is VAT-free."]})]}),e.jsxs(y,{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 max-w-lg",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Amount (€)"}),e.jsx(N,{type:"number",value:amount,onChange:s=>setAmount(s.target.value),min:m,step:"1",placeholder:`Min €${m}`}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["10","25","50","100"].map(s=>e.jsxs(n,{variant:"outline",size:"sm",className:`text-xs h-7 px-3 ${amount===s?"border-primary bg-primary/5 text-primary":""}`,onClick:()=>setAmount(s),children:["€",s]},s))}),C&&l>0&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(AlertCircle,{className:"h-3 w-3"})," Minimum purchase is €",m]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Promo Code (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{placeholder:"WELCOME20",value:R,onChange:s=>V(s.target.value)}),e.jsx(n,{variant:"outline",size:"sm",className:"shrink-0",onClick:()=>toast({title:"Coupon Applied",description:"Discount applied to your balance."}),children:"Apply"})]})]})]}),!K&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No payment methods are currently available. Please contact support."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:B.map(s=>{const t=o[s.id],a=r===s.id;return e.jsxs(n,{variant:a?"default":"outline",className:`h-auto py-4 flex-col gap-1 relative ${t?"":"opacity-40 cursor-not-allowed"}`,disabled:!t,onClick:()=>I(s.id),children:[e.jsx(s.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-[11px] font-normal opacity-80",children:s.subtitle}),e.jsx(w,{variant:s.id==="crypto"||s.id==="manual"?"default":"secondary",className:"text-[10px] mt-1",children:s.vatLabel}),!t&&e.jsx("span",{className:"text-[10px] font-normal",children:"Not available"})]},s.id)})}),r&&l>=m&&e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 max-w-sm space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["€",l.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["VAT (22%)",x&&e.jsx(Info,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("span",{className:x?"line-through text-muted-foreground":"",children:x?"€0.00 — exempt":`€${k.toFixed(2)}`})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["€",v.toFixed(2)]})]}),e.jsxs(n,{className:"w-full mt-2",onClick:G,disabled:C||u,children:[u?e.jsx(Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Pay €",v.toFixed(2)]})]})]})]}),F&&e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(j,{className:"flex items-center gap-2 text-lg",children:[e.jsx(RefreshCw,{className:"h-5 w-5"})," Auto Top-Up"]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically add balance when it drops below the threshold"})]}),e.jsx(ee,{checked:S,onCheckedChange:z})]}),S&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Min Balance Threshold (€)"}),e.jsx(N,{type:"number",value:D,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Top-Up Amount (€)"}),e.jsx(N,{type:"number",value:U,onChange:s=>_(s.target.value)})]})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:(H||[]).map(s=>{const t=s.id===A;return e.jsxs(h,{className:t?"border-primary ring-2 ring-primary/20":"",children:[e.jsx(p,{className:"pb-2",children:e.jsxs(j,{className:"flex items-center justify-between text-lg",children:[s.name,t&&e.jsx(w,{children:"Active"})]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("p",{className:"text-3xl font-bold",children:["€",(s.price_cents/100).toFixed(2),e.jsxs("span",{className:"text-base font-normal text-muted-foreground",children:["/",(s.id==="datacenter","GB")]})]}),e.jsx("ul",{className:"space-y-1.5",children:s.features.map(a=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(Check,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),a]},a))}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{variant:t?"outline":"default",className:"w-full",disabled:t,onClick:()=>q(s.id),children:t?"Active Product":"Select Product"}),!t&&e.jsxs("div",{className:"flex flex-col gap-2",children:[o.stripe&&e.jsxs(n,{variant:"secondary",className:"w-full gap-2",disabled:u,onClick:async()=>{i(!0);try{const{url:a}=await d.createProductCheckout(s.id,1);window.location.href=a}catch(a){toast({title:"Purchase Error",description:a.message,variant:"destructive"})}finally{i(!1)}},children:[e.jsx(CreditCard,{className:"h-4 w-4"})," Buy with Card"]}),o.cryptomus&&e.jsxs(n,{variant:"outline",className:"w-full gap-2 border-primary/20 hover:border-primary/50",disabled:u,onClick:async()=>{i(!0);try{const{url:a}=await d.createCryptomusProductCheckout(s.id,1);window.location.href=a}catch(a){toast({title:"Purchase Error",description:a.message,variant:"destructive"})}finally{i(!1)}},children:[e.jsx(Bitcoin,{className:"h-4 w-4 text-orange-500"})," Buy with Crypto"]})]})]})]})]},s.id)})}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(j,{className:"text-lg",children:"Recent Invoices"})}),e.jsx(y,{className:"p-0",children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(E,{children:[e.jsx(f,{children:"Period"}),e.jsx(f,{children:"Amount"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Date"})]})}),e.jsx(X,{children:(O||[]).map(s=>e.jsxs(E,{children:[e.jsx(g,{className:"font-medium",children:s.period}),e.jsxs(g,{children:["€",(s.amount_cents/100).toFixed(2)]}),e.jsx(g,{children:e.jsx(w,{variant:ae[s.status]??"secondary",children:s.status})}),e.jsxs(g,{className:"text-right text-sm text-muted-foreground space-x-2",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.pdf_url&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"Download PDF",children:e.jsx("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Download,{className:"h-3.5 w-3.5"})})})]})]},s.id))})]})})]})]}),e.jsx(se,{open:$,onOpenChange:P,defaultAmount:amount})]})}export{xe as default};
