import{c as $e,r as n,j as e,a5 as ee,i as Ge,am as Qe,al as Ve,S as Ue,B as A,t as L,f as Ke,I as we,s as ie}from"./index-WAZqrxeU.js";import{S as Ye}from"./SEOHead-BQbD0fka.js";import{C as X,a as oe,b as ce,d as Je,c as Z}from"./card-DA1uTK-7.js";import{B as Se}from"./badge-Dr0x0J-M.js";import{L as Ce}from"./label-Cv0_4Q_2.js";import{u as Ee}from"./useMutation-ZvIPFomk.js";import{S as Xe}from"./shield-check-DcBkAFI2.js";import{E as Ze}from"./eye-off-BAEWE_Bl.js";import{E as et}from"./eye-CieFdeDE.js";import{C as Ne}from"./copy-BRpcWagb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=$e("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);var nt=Object.defineProperty,at=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,ke=(t,r,s)=>r in t?nt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,st=(t,r)=>{for(var s in r||(r={}))Pe.call(r,s)&&ke(t,s,r[s]);if(te)for(var s of te(r))Te.call(r,s)&&ke(t,s,r[s]);return t},lt=(t,r)=>at(t,rt(r)),it=(t,r)=>{var s={};for(var o in t)Pe.call(t,o)&&r.indexOf(o)<0&&(s[o]=t[o]);if(t!=null&&te)for(var o of te(t))r.indexOf(o)<0&&Te.call(t,o)&&(s[o]=t[o]);return s};function ot(t){let r=setTimeout(t,0),s=setTimeout(t,10),o=setTimeout(t,50);return[r,s,o]}function ct(t){let r=n.useRef();return n.useEffect(()=>{r.current=t}),r.current}var ut=18,Ae=40,dt=`${Ae}px`,pt=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function mt({containerRef:t,inputRef:r,pushPasswordManagerStrategy:s,isFocused:o}){let[v,u]=n.useState(!1),[j,w]=n.useState(!1),[S,_]=n.useState(!1),f=n.useMemo(()=>s==="none"?!1:(s==="increase-width"||s==="experimental-no-flickering")&&v&&j,[v,j,s]),B=n.useCallback(()=>{let x=t.current,N=r.current;if(!x||!N||S||s==="none")return;let m=x,C=m.getBoundingClientRect().left+m.offsetWidth,M=m.getBoundingClientRect().top+m.offsetHeight/2,i=C-ut,k=M;document.querySelectorAll(pt).length===0&&document.elementFromPoint(i,k)===x||(u(!0),_(!0))},[t,r,S,s]);return n.useEffect(()=>{let x=t.current;if(!x||s==="none")return;function N(){let C=window.innerWidth-x.getBoundingClientRect().right;w(C>=Ae)}N();let m=setInterval(N,1e3);return()=>{clearInterval(m)}},[t,s]),n.useEffect(()=>{let x=o||document.activeElement===r.current;if(s==="none"||!x)return;let N=setTimeout(B,0),m=setTimeout(B,2e3),C=setTimeout(B,5e3),M=setTimeout(()=>{_(!0)},6e3);return()=>{clearTimeout(N),clearTimeout(m),clearTimeout(C),clearTimeout(M)}},[r,o,s,B]),{hasPWMBadge:v,willPushPWMBadge:f,PWM_BADGE_SPACE_WIDTH:dt}}var Me=n.createContext({}),Oe=n.forwardRef((t,r)=>{var s=t,{value:o,onChange:v,maxLength:u,textAlign:j="left",pattern:w,placeholder:S,inputMode:_="numeric",onComplete:f,pushPasswordManagerStrategy:B="increase-width",pasteTransformer:x,containerClassName:N,noScriptCSSFallback:m=ht,render:C,children:M}=s,i=it(s,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),k,ue,de,pe,me;let[Be,Fe]=n.useState(typeof i.defaultValue=="string"?i.defaultValue:""),d=o??Be,F=ct(d),G=n.useCallback(a=>{v==null||v(a),Fe(a)},[v]),P=n.useMemo(()=>w?typeof w=="string"?new RegExp(w):w:null,[w]),p=n.useRef(null),ne=n.useRef(null),ae=n.useRef({value:d,onChange:G,isIOS:typeof window<"u"&&((ue=(k=window==null?void 0:window.CSS)==null?void 0:k.supports)==null?void 0:ue.call(k,"-webkit-touch-callout","none"))}),Y=n.useRef({prev:[(de=p.current)==null?void 0:de.selectionStart,(pe=p.current)==null?void 0:pe.selectionEnd,(me=p.current)==null?void 0:me.selectionDirection]});n.useImperativeHandle(r,()=>p.current,[]),n.useEffect(()=>{let a=p.current,l=ne.current;if(!a||!l)return;ae.current.value!==a.value&&ae.current.onChange(a.value),Y.current.prev=[a.selectionStart,a.selectionEnd,a.selectionDirection];function h(){if(document.activeElement!==a){V(null),U(null);return}let c=a.selectionStart,g=a.selectionEnd,J=a.selectionDirection,E=a.maxLength,D=a.value,T=Y.current.prev,O=-1,R=-1,W;if(D.length!==0&&c!==null&&g!==null){let Le=c===g,qe=c===D.length&&D.length<E;if(Le&&!qe){let H=c;if(H===0)O=0,R=1,W="forward";else if(H===E)O=H-1,R=H,W="backward";else if(E>1&&D.length>1){let le=0;if(T[0]!==null&&T[1]!==null){W=H<T[1]?"backward":"forward";let ze=T[0]===T[1]&&T[0]<E;W==="backward"&&!ze&&(le=-1)}O=le+H,R=le+H+1}}O!==-1&&R!==-1&&O!==R&&p.current.setSelectionRange(O,R,W)}let be=O!==-1?O:c,ye=R!==-1?R:g,He=W??J;V(be),U(ye),Y.current.prev=[be,ye,He]}if(document.addEventListener("selectionchange",h,{capture:!0}),h(),document.activeElement===a&&re(!0),!document.getElementById("input-otp-style")){let c=document.createElement("style");if(c.id="input-otp-style",document.head.appendChild(c),c.sheet){let g="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";K(c.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),K(c.sheet,`[data-input-otp]:autofill { ${g} }`),K(c.sheet,`[data-input-otp]:-webkit-autofill { ${g} }`),K(c.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),K(c.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let b=()=>{l&&l.style.setProperty("--root-height",`${a.clientHeight}px`)};b();let y=new ResizeObserver(b);return y.observe(a),()=>{document.removeEventListener("selectionchange",h,{capture:!0}),y.disconnect()}},[]);let[he,fe]=n.useState(!1),[Q,re]=n.useState(!1),[I,V]=n.useState(null),[z,U]=n.useState(null);n.useEffect(()=>{ot(()=>{var a,l,h,b;(a=p.current)==null||a.dispatchEvent(new Event("input"));let y=(l=p.current)==null?void 0:l.selectionStart,c=(h=p.current)==null?void 0:h.selectionEnd,g=(b=p.current)==null?void 0:b.selectionDirection;y!==null&&c!==null&&(V(y),U(c),Y.current.prev=[y,c,g])})},[d,Q]),n.useEffect(()=>{F!==void 0&&d!==F&&F.length<u&&d.length===u&&(f==null||f(d))},[u,f,F,d]);let $=mt({containerRef:ne,inputRef:p,pushPasswordManagerStrategy:B,isFocused:Q}),xe=n.useCallback(a=>{let l=a.currentTarget.value.slice(0,u);if(l.length>0&&P&&!P.test(l)){a.preventDefault();return}typeof F=="string"&&l.length<F.length&&document.dispatchEvent(new Event("selectionchange")),G(l)},[u,G,F,P]),ve=n.useCallback(()=>{var a;if(p.current){let l=Math.min(p.current.value.length,u-1),h=p.current.value.length;(a=p.current)==null||a.setSelectionRange(l,h),V(l),U(h)}re(!0)},[u]),ge=n.useCallback(a=>{var l,h;let b=p.current;if(!x&&(!ae.current.isIOS||!a.clipboardData||!b))return;let y=a.clipboardData.getData("text/plain"),c=x?x(y):y;a.preventDefault();let g=(l=p.current)==null?void 0:l.selectionStart,J=(h=p.current)==null?void 0:h.selectionEnd,E=(g!==J?d.slice(0,g)+c+d.slice(J):d.slice(0,g)+c+d.slice(g)).slice(0,u);if(E.length>0&&P&&!P.test(E))return;b.value=E,G(E);let D=Math.min(E.length,u-1),T=E.length;b.setSelectionRange(D,T),V(D),U(T)},[u,G,P,d]),Ie=n.useMemo(()=>({position:"relative",cursor:i.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[i.disabled]),je=n.useMemo(()=>({position:"absolute",inset:0,width:$.willPushPWMBadge?`calc(100% + ${$.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:$.willPushPWMBadge?`inset(0 ${$.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:j,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[$.PWM_BADGE_SPACE_WIDTH,$.willPushPWMBadge,j]),De=n.useMemo(()=>n.createElement("input",lt(st({autoComplete:i.autoComplete||"one-time-code"},i),{"data-input-otp":!0,"data-input-otp-placeholder-shown":d.length===0||void 0,"data-input-otp-mss":I,"data-input-otp-mse":z,inputMode:_,pattern:P==null?void 0:P.source,"aria-placeholder":S,style:je,maxLength:u,value:d,ref:p,onPaste:a=>{var l;ge(a),(l=i.onPaste)==null||l.call(i,a)},onChange:xe,onMouseOver:a=>{var l;fe(!0),(l=i.onMouseOver)==null||l.call(i,a)},onMouseLeave:a=>{var l;fe(!1),(l=i.onMouseLeave)==null||l.call(i,a)},onFocus:a=>{var l;ve(),(l=i.onFocus)==null||l.call(i,a)},onBlur:a=>{var l;re(!1),(l=i.onBlur)==null||l.call(i,a)}})),[xe,ve,ge,_,je,u,z,I,i,P==null?void 0:P.source,d]),se=n.useMemo(()=>({slots:Array.from({length:u}).map((a,l)=>{var h;let b=Q&&I!==null&&z!==null&&(I===z&&l===I||l>=I&&l<z),y=d[l]!==void 0?d[l]:null,c=d[0]!==void 0?null:(h=S==null?void 0:S[l])!=null?h:null;return{char:y,placeholderChar:c,isActive:b,hasFakeCaret:b&&y===null}}),isFocused:Q,isHovering:!i.disabled&&he}),[Q,he,u,z,I,i.disabled,d]),We=n.useMemo(()=>C?C(se):n.createElement(Me.Provider,{value:se},M),[M,se,C]);return n.createElement(n.Fragment,null,m!==null&&n.createElement("noscript",null,n.createElement("style",null,m)),n.createElement("div",{ref:ne,"data-input-otp-container":!0,style:Ie,className:N},We,n.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},De)))});Oe.displayName="Input";function K(t,r){try{t.insertRule(r)}catch{console.error("input-otp could not insert CSS rule:",r)}}var ht=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const Re=n.forwardRef(({className:t,containerClassName:r,...s},o)=>e.jsx(Oe,{ref:o,containerClassName:ee("flex items-center gap-2 has-[:disabled]:opacity-50",r),className:ee("disabled:cursor-not-allowed",t),...s}));Re.displayName="InputOTP";const _e=n.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("flex items-center",t),...r}));_e.displayName="InputOTPGroup";const q=n.forwardRef(({index:t,className:r,...s},o)=>{const v=n.useContext(Me),{char:u,hasFakeCaret:j,isActive:w}=v.slots[t];return e.jsxs("div",{ref:o,className:ee("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",w&&"z-10 ring-2 ring-ring ring-offset-background",r),...s,children:[u,j&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});q.displayName="InputOTPSlot";const ft=n.forwardRef(({...t},r)=>e.jsx("div",{ref:r,role:"separator",...t,children:e.jsx(tt,{})}));ft.displayName="InputOTPSeparator";function Nt(){const{user:t}=Ge(),r=Qe(),[s,o]=n.useState("idle"),[v,u]=n.useState(""),[j,w]=n.useState(!1),[S]=n.useState("JBSWY3DPEHPK3PXP"),[_]=n.useState(["abc123","def456","ghi789","jkl012","mno345"]),{data:f,isLoading:B}=Ve({queryKey:["totp",t==null?void 0:t.id],enabled:!!(t!=null&&t.id),queryFn:async()=>{const{data:i,error:k}=await ie.from("user_totp_secrets").select("*").eq("user_id",t.id).maybeSingle();if(k)throw k;return i}}),x=Ee({mutationFn:async()=>{const{error:i}=await ie.from("user_totp_secrets").insert({user_id:t.id,encrypted_secret:S,is_enabled:!0,backup_codes:_,verified_at:new Date().toISOString()});if(i)throw i},onSuccess:()=>{r.invalidateQueries({queryKey:["totp"]}),o("idle"),L({title:"2FA Enabled",description:"Your account is now protected with two-factor authentication."})},onError:i=>L({title:"Error",description:i.message,variant:"destructive"})}),N=Ee({mutationFn:async()=>{const{error:i}=await ie.from("user_totp_secrets").delete().eq("user_id",t.id);if(i)throw i},onSuccess:()=>{r.invalidateQueries({queryKey:["totp"]}),L({title:"2FA Disabled"})}}),m=!!(f!=null&&f.is_enabled),C=()=>{if(v.length!==6){L({title:"Invalid code",description:"Enter a 6-digit code",variant:"destructive"});return}x.mutate()},M=`otpauth://totp/UpgradedProxy:${t==null?void 0:t.email}?secret=${S}&issuer=UpgradedProxy`;return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{title:"Security & 2FA",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Security & 2FA"}),e.jsxs(X,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[m?e.jsx(Xe,{className:"h-8 w-8 text-success"}):e.jsx(Ue,{className:"h-8 w-8 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(ce,{className:"text-lg",children:"Two-Factor Authentication (TOTP)"}),e.jsx(Je,{children:"Add an extra layer of security using an authenticator app like Google Authenticator or Authy."})]}),e.jsx(Se,{variant:m?"default":"secondary",className:"ml-auto",children:m?"Enabled":"Disabled"})]})}),e.jsxs(Z,{className:"space-y-4",children:[m&&s==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"✅ Two-factor authentication is active on your account."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>w(!j),children:[j?e.jsx(Ze,{className:"mr-1 h-4 w-4"}):e.jsx(et,{className:"mr-1 h-4 w-4"}),j?"Hide":"Show"," Backup Codes"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:()=>N.mutate(),children:"Disable 2FA"})]}),j&&(f==null?void 0:f.backup_codes)&&e.jsx(X,{className:"bg-muted",children:e.jsxs(Z,{className:"py-3",children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:"Save these backup codes in a safe place:"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:f.backup_codes.map((i,k)=>e.jsx("code",{className:"text-xs font-mono bg-background px-2 py-1 rounded",children:i},k))}),e.jsxs(A,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{navigator.clipboard.writeText(f.backup_codes.join(`
`)),L({title:"Copied"})},children:[e.jsx(Ne,{className:"mr-1 h-3 w-3"})," Copy All"]})]})})]}),!m&&s==="idle"&&e.jsxs(A,{onClick:()=>o("setup"),children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"})," Enable 2FA"]}),s==="setup"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"1. Scan this QR code with your authenticator app:"}),e.jsx("div",{className:"flex items-center justify-center rounded-lg border bg-white p-6",style:{maxWidth:240},children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(M)}`,alt:"2FA QR Code",className:"w-48 h-48"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Or enter this secret manually:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-muted px-3 py-1.5 rounded text-sm font-mono",children:S}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>{navigator.clipboard.writeText(S),L({title:"Copied"})},children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsx(A,{onClick:()=>o("verify"),children:"Next: Verify Code"})]}),s==="verify"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"2. Enter the 6-digit code from your authenticator app:"}),e.jsx(Re,{maxLength:6,value:v,onChange:u,children:e.jsxs(_e,{children:[e.jsx(q,{index:0}),e.jsx(q,{index:1}),e.jsx(q,{index:2}),e.jsx(q,{index:3}),e.jsx(q,{index:4}),e.jsx(q,{index:5})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",onClick:()=>{o("setup"),u("")},children:"Back"}),e.jsx(A,{onClick:C,disabled:v.length!==6,children:"Verify & Enable"})]})]})]})]}),e.jsxs(X,{children:[e.jsx(oe,{children:e.jsx(ce,{className:"text-lg",children:"Change Password"})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 max-w-sm",children:[e.jsx(Ce,{children:"New Password"}),e.jsx(we,{type:"password",placeholder:"••••••••"})]}),e.jsxs("div",{className:"space-y-2 max-w-sm",children:[e.jsx(Ce,{children:"Confirm New Password"}),e.jsx(we,{type:"password",placeholder:"••••••••"})]}),e.jsx(A,{onClick:()=>L({title:"Password updated"}),children:"Update Password"})]})]}),e.jsxs(X,{children:[e.jsx(oe,{children:e.jsx(ce,{className:"text-lg",children:"Active Sessions"})}),e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Session"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Browser • ",navigator.userAgent.split(" ").pop()]})]}),e.jsx(Se,{variant:"default",children:"Active"})]})})]})]})]})}export{Nt as default};
