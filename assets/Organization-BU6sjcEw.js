import{c as Y,n as Z,Y as $,r as m,Z as p,j as e,a as d,I,aL as G,k as v,a2 as W,z as X,E as ee,J as se,K as ae,N,aM as re,t as h}from"./index-BeYWUc0b.js";import{S as ie}from"./SEOHead-pmtGgQ8x.js";import{C as j,c as w,a as C,b,d as te}from"./card-B5UOakCf.js";import{L as _}from"./label-BtEyUhVW.js";import{T,a as k,b as u,c as n,d as L,e as l}from"./table-DgkavPbA.js";import{D as F,a as M,b as R,c as H,d as K,e as P,f as B}from"./dialog-Cffnlhjv.js";import{s as o}from"./client-DBtcxyoE.js";import{u as Q}from"./useMutation-BOgpOETL.js";import{P as ne}from"./plus-XGeDSIgw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Y("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function ye(){const{user:r}=Z(),S=$(),[x,z]=m.useState(""),[g,D]=m.useState(""),[E,A]=m.useState("member"),{data:c,isLoading:q}=p({queryKey:["orgs",r==null?void 0:r.id],enabled:!!(r!=null&&r.id),queryFn:async()=>{const{data:s,error:a}=await o.from("org_members").select("org_id, role, organizations(id, name, slug, owner_id, created_at)").eq("user_id",r.id);if(a)throw a;return s??[]}}),U=Q({mutationFn:async()=>{const s=x.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),{data:a,error:t}=await o.from("organizations").insert({name:x,slug:s,owner_id:r.id}).select().single();if(t)throw t;return await o.from("org_members").insert({org_id:a.id,user_id:r.id,role:"owner"}),a},onSuccess:()=>{S.invalidateQueries({queryKey:["orgs"]}),z(""),h({title:"Organization Created"})},onError:s=>h({title:"Error",description:s.message,variant:"destructive"})}),[i,V]=m.useState(null),{data:y}=p({queryKey:["org-members",i],enabled:!!i,queryFn:async()=>{const{data:s,error:a}=await o.from("org_members").select("*, profiles:user_id(full_name, email)").eq("org_id",i);if(a)throw a;return s??[]}}),{data:f}=p({queryKey:["org-invites",i],enabled:!!i,queryFn:async()=>{const{data:s,error:a}=await o.from("org_invites").select("*").eq("org_id",i).is("accepted_at",null);if(a)throw a;return s??[]}}),J=Q({mutationFn:async()=>{const{error:s}=await o.from("org_invites").insert({org_id:i,email:g,role:E,invited_by:r.id});if(s)throw s},onSuccess:()=>{S.invalidateQueries({queryKey:["org-invites"]}),D(""),h({title:"Invite Sent"})},onError:s=>h({title:"Error",description:s.message,variant:"destructive"})}),O={owner:"default",admin:"secondary",member:"outline",viewer:"outline"};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Organization",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Organizations"}),e.jsxs(F,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(d,{size:"sm",children:[e.jsx(ne,{className:"mr-1 h-4 w-4"})," Create Org"]})}),e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(K,{children:"Create Organization"})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Organization Name"}),e.jsx(I,{value:x,onChange:s=>z(s.target.value),placeholder:"Acme Corp"})]})}),e.jsxs(P,{children:[e.jsx(B,{asChild:!0,children:e.jsx(d,{variant:"outline",children:"Cancel"})}),e.jsx(d,{onClick:()=>U.mutate(),disabled:!x.trim(),children:"Create"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[q&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."}),(c==null?void 0:c.length)===0&&!q&&e.jsx(j,{className:"col-span-full",children:e.jsxs(w,{className:"py-8 text-center",children:[e.jsx(G,{className:"mx-auto h-10 w-10 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No organizations yet. Create one to get started."})]})}),c==null?void 0:c.map(s=>{var a,t;return e.jsx(j,{className:`cursor-pointer transition-colors ${i===s.org_id?"border-primary":""}`,onClick:()=>V(s.org_id),children:e.jsxs(C,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-base",children:(a=s.organizations)==null?void 0:a.name}),e.jsx(v,{variant:O[s.role]??"outline",children:s.role})]}),e.jsxs(te,{className:"text-xs",children:["Slug: ",(t=s.organizations)==null?void 0:t.slug]})]})},s.org_id)})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"})," Members"]}),e.jsxs(F,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(d,{size:"sm",children:[e.jsx(le,{className:"mr-1 h-4 w-4"})," Invite"]})}),e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(K,{children:"Invite Member"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Email"}),e.jsx(I,{value:g,onChange:s=>D(s.target.value),placeholder:"user@example.com",type:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Role"}),e.jsxs(X,{value:E,onValueChange:A,children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"admin",children:"Admin"}),e.jsx(N,{value:"member",children:"Member"}),e.jsx(N,{value:"viewer",children:"Viewer"})]})]})]})]}),e.jsxs(P,{children:[e.jsx(B,{asChild:!0,children:e.jsx(d,{variant:"outline",children:"Cancel"})}),e.jsx(d,{onClick:()=>J.mutate(),disabled:!g,children:"Send Invite"})]})]})]})]}),e.jsx(w,{className:"p-0",children:e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Department"}),e.jsx(n,{children:"Joined"})]})}),e.jsx(L,{children:y==null?void 0:y.map(s=>{var a,t;return e.jsxs(u,{children:[e.jsx(l,{className:"font-medium text-sm",children:((a=s.profiles)==null?void 0:a.full_name)||"—"}),e.jsx(l,{className:"text-sm",children:((t=s.profiles)==null?void 0:t.email)||"—"}),e.jsx(l,{children:e.jsx(v,{variant:O[s.role]??"outline",className:"text-xs",children:s.role})}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.department||"—"}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(s.joined_at).toLocaleDateString()})]},s.id)})})]})})]}),f&&f.length>0&&e.jsxs(j,{children:[e.jsx(C,{children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"})," Pending Invites"]})}),e.jsx(w,{className:"p-0",children:e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Expires"})]})}),e.jsx(L,{children:f.map(s=>e.jsxs(u,{children:[e.jsx(l,{className:"text-sm",children:s.email}),e.jsx(l,{children:e.jsx(v,{variant:"outline",className:"text-xs",children:s.role})}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(s.expires_at).toLocaleDateString()})]},s.id))})]})})]})]})]})]})}export{ye as default};
