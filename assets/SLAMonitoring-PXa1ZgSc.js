import{ab as k,r as L,j as e,A as B,B as m,I as p,t as h}from"./index-BS3MrMDR.js";import{u as b}from"./useQuery-D_JWgd3B.js";import{u as w}from"./useMutation-BUadc-Ou.js";import{C as c,a as z,b as P,c as o}from"./card-DayAM_BL.js";import{B as j}from"./badge-TlMpNj1c.js";import{L as y}from"./label-WpXwRrp2.js";import{T as g,a as f,b as l,c as a,d as _,e as t}from"./table-BLekKfgE.js";import{T as U,a as H,b as v,c as N}from"./tabs-B8_6dDWv.js";import{D as K,a as O,b as E,c as I,d as Q}from"./dialog-Du_uRE6n.js";import{P as G}from"./plus-DJNvFprH.js";import{C as $}from"./circle-check-big-CY2rk2f6.js";import{f as R}from"./format-sbWH3_uq.js";const V={up:"bg-green-500",degraded:"bg-yellow-500",down:"bg-destructive"};function W(){return b({queryKey:["sla-configs"],queryFn:async()=>[{id:"1",proxy_type:"residential",guaranteed_uptime:99.9,credit_per_percent:5,measurement_window:"monthly",is_active:!0},{id:"2",proxy_type:"mobile",guaranteed_uptime:99.5,credit_per_percent:10,measurement_window:"monthly",is_active:!0}]})}function J(){return b({queryKey:["uptime-records"],queryFn:async()=>[]})}function X(){return b({queryKey:["sla-credits"],queryFn:async()=>[]})}function oe(){const{data:i}=W(),{data:n}=J(),{data:d}=X(),C=k(),[D,S]=L.useState(!1),[x,u]=L.useState({proxy_type:"",guaranteed_uptime:"99.9",credit_per_percent:"5"}),A=w({mutationFn:async()=>{console.log("Mock create SLA config",x)},onSuccess:()=>{C.invalidateQueries({queryKey:["sla-configs"]}),h({title:"SLA config created"}),S(!1)},onError:s=>h({title:"Error",description:s.message,variant:"destructive"})}),q=w({mutationFn:async s=>{console.log("Mock approve SLA credit",s)},onSuccess:()=>{C.invalidateQueries({queryKey:["sla-credits"]}),h({title:"Credit approved"})}}),F=(n==null?void 0:n.reduce((s,r)=>(s[r.proxy_type]||(s[r.proxy_type]={total:0,up:0}),s[r.proxy_type].total++,r.status==="up"&&s[r.proxy_type].up++,s),{}))??{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(B,{className:"h-6 w-6"})," SLA Monitoring"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track uptime guarantees and manage credits"})]}),e.jsxs(K,{open:D,onOpenChange:S,children:[e.jsx(O,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add SLA Config"]})}),e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(Q,{children:"Create SLA Configuration"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Proxy Type"}),e.jsx(p,{placeholder:"e.g. residential",value:x.proxy_type,onChange:s=>u(r=>({...r,proxy_type:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Guaranteed Uptime (%)"}),e.jsx(p,{type:"number",step:"0.1",value:x.guaranteed_uptime,onChange:s=>u(r=>({...r,guaranteed_uptime:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Credit per % Downtime"}),e.jsx(p,{type:"number",value:x.credit_per_percent,onChange:s=>u(r=>({...r,credit_per_percent:s.target.value}))})]})]}),e.jsx(m,{onClick:()=>A.mutate(),disabled:A.isPending,className:"w-full",children:"Create"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[i==null?void 0:i.map(s=>{const r=F[s.proxy_type],M=r?(r.up/r.total*100).toFixed(2):"N/A",T=r?r.up/r.total*100>=Number(s.guaranteed_uptime):!0;return e.jsxs(c,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium capitalize",children:s.proxy_type})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[M,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["SLA: ",Number(s.guaranteed_uptime),"%"]}),e.jsx(j,{variant:T?"default":"destructive",className:"mt-2",children:T?"SLA Met":"SLA Breached"})]})]},s.id)}),!(i!=null&&i.length)&&e.jsx(c,{className:"md:col-span-4",children:e.jsx(o,{className:"py-8 text-center text-muted-foreground",children:"No SLA configs. Create one to start monitoring."})})]}),e.jsxs(U,{defaultValue:"uptime",children:[e.jsxs(H,{children:[e.jsx(v,{value:"uptime",children:"Uptime Records"}),e.jsx(v,{value:"credits",children:"SLA Credits"}),e.jsx(v,{value:"configs",children:"Configurations"})]}),e.jsx(N,{value:"uptime",children:e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(l,{children:[e.jsx(a,{children:"Proxy Type"}),e.jsx(a,{children:"Region"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Response Time"}),e.jsx(a,{children:"Checked At"})]})}),e.jsxs(_,{children:[n==null?void 0:n.slice(0,50).map(s=>e.jsxs(l,{children:[e.jsx(t,{className:"capitalize",children:s.proxy_type}),e.jsx(t,{children:s.region}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${V[s.status]??"bg-muted"}`}),e.jsx("span",{className:"capitalize",children:s.status})]})}),e.jsx(t,{children:s.response_time_ms?`${s.response_time_ms}ms`:"—"}),e.jsx(t,{className:"text-xs",children:R(new Date(s.checked_at),"MMM d, HH:mm:ss")})]},s.id)),!(n!=null&&n.length)&&e.jsx(l,{children:e.jsx(t,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No uptime records yet"})})]})]})})})}),e.jsx(N,{value:"credits",children:e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(l,{children:[e.jsx(a,{children:"User ID"}),e.jsx(a,{children:"Proxy Type"}),e.jsx(a,{children:"Actual Uptime"}),e.jsx(a,{children:"Guaranteed"}),e.jsx(a,{children:"Credit"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Actions"})]})}),e.jsxs(_,{children:[d==null?void 0:d.map(s=>e.jsxs(l,{children:[e.jsxs(t,{className:"font-mono text-xs",children:[s.user_id.slice(0,8),"…"]}),e.jsx(t,{className:"capitalize",children:s.proxy_type}),e.jsxs(t,{children:[Number(s.actual_uptime).toFixed(2),"%"]}),e.jsxs(t,{children:[Number(s.guaranteed_uptime),"%"]}),e.jsxs(t,{className:"font-semibold",children:["$",Number(s.credit_amount).toFixed(2)]}),e.jsx(t,{children:e.jsx(j,{variant:s.status==="approved"?"default":s.status==="applied"?"secondary":"outline",children:s.status})}),e.jsx(t,{children:s.status==="pending"&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>q.mutate(s.id),children:[e.jsx($,{className:"mr-1 h-3 w-3"})," Approve"]})})]},s.id)),!(d!=null&&d.length)&&e.jsx(l,{children:e.jsx(t,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No SLA credits issued"})})]})]})})})}),e.jsx(N,{value:"configs",children:e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(l,{children:[e.jsx(a,{children:"Proxy Type"}),e.jsx(a,{children:"Guaranteed Uptime"}),e.jsx(a,{children:"Credit / % Downtime"}),e.jsx(a,{children:"Window"}),e.jsx(a,{children:"Status"})]})}),e.jsx(_,{children:i==null?void 0:i.map(s=>e.jsxs(l,{children:[e.jsx(t,{className:"capitalize font-medium",children:s.proxy_type}),e.jsxs(t,{children:[Number(s.guaranteed_uptime),"%"]}),e.jsxs(t,{children:[Number(s.credit_per_percent),"%"]}),e.jsx(t,{className:"capitalize",children:s.measurement_window}),e.jsx(t,{children:e.jsx(j,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})})]},s.id))})]})})})})]})]})}export{oe as default};
