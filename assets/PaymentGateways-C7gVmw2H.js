import{c as A,U as M,Y as B,r as o,K as q,q as F,V as K,j as e,a as b,I as W,t as v,ae as j,af as z,aU as O,s as H}from"./index-D3Cf-E6J.js";import{S as Q}from"./SEOHead-pYmUcRRy.js";import{C as N,a as R,b as U,c as k}from"./card-D4sq_HMW.js";import{L as C}from"./label-pmD4J6dX.js";import{S as V}from"./switch-BaqFbqbU.js";import{B as m}from"./badge-DIybAy6F.js";import{u as Y}from"./useMutation-DYGAJV9S.js";import{x as D}from"./use-backend-CHjyxXkZ.js";import{B as J}from"./bitcoin-Ctjw9QUe.js";import{L as w}from"./loader-circle-U7QiCFSq.js";import{C as p}from"./circle-alert-BGPE_RLe.js";import{E as X}from"./eye-off-BEvmmv6Y.js";import{E as Z}from"./eye-Bujak09G.js";import{S as ee}from"./save-CfepRY2d.js";import{C as se}from"./circle-check-BV63Kmwd.js";import"./dashboard-DOh7lAUH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=A("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),te=[{id:"stripe",name:"Stripe",icon:q,fields:[{key:"stripe_publishable_key",label:"Publishable Key",placeholder:"pk_live_...",value:"",secret:!1},{key:"stripe_secret_key",label:"Secret Key",placeholder:"sk_live_...",value:"",secret:!0},{key:"stripe_webhook_secret",label:"Webhook Secret",placeholder:"whsec_...",value:"",secret:!0}]},{id:"paypal",name:"PayPal",icon:F,fields:[{key:"paypal_client_id",label:"Client ID",placeholder:"AV...",value:""},{key:"paypal_client_secret",label:"Client Secret",placeholder:"EL...",value:""},{key:"paypal_mode",label:"Mode (sandbox/live)",placeholder:"sandbox",value:""}]},{id:"crypto",name:"Crypto (USDT/BTC/ETH)",icon:J,fields:[{key:"crypto_wallet_address",label:"Wallet Address",placeholder:"0x...",value:""},{key:"crypto_provider",label:"Provider (e.g. NOWPayments)",placeholder:"nowpayments",value:""},{key:"crypto_api_key",label:"API Key",placeholder:"Your API key",value:""}]}];function ve(){const S=M(),{gateways:_,toggleGateway:E}=B(),[u,h]=o.useState(te),[x,L]=o.useState({}),{data:d={},isLoading:P}=K({queryKey:["admin","settings"],queryFn:()=>j.get("/admin/settings",O(H()))}),{data:l,isLoading:y,refetch:f}=D(),c=Y({mutationFn:s=>j.post("/admin/settings",z,s),onSuccess:()=>{S.invalidateQueries({queryKey:["admin","settings"]}),f(),v({title:"Configuration Saved",description:"Gateway settings have been updated and verified."})},onError:()=>v({title:"Save Failed",description:"Could not save settings to backend.",variant:"destructive"})}),[g,$]=o.useState(!1);o.useEffect(()=>{d&&Object.keys(d).length>0&&!g&&(h(s=>s.map(a=>({...a,fields:a.fields.map(r=>({...r,value:d[r.key]||""}))}))),$(!0))},[d,g]);const G=(s,a,r)=>{h(i=>i.map(t=>t.id===s?{...t,fields:t.fields.map(n=>n.key===a?{...n,value:r}:n)}:t))},I=s=>{const a=u.find(i=>i.id===s);if(!a)return;const r={};a.fields.forEach(i=>{r[i.key]=i.value}),c.mutate(r)},T=s=>{var r;const a=(r=l==null?void 0:l.gateways)==null?void 0:r.find(i=>i.id===s);return a?a.status==="connected"?e.jsxs(m,{variant:"default",className:"bg-success text-success-foreground hover:bg-success/90 gap-1",children:[e.jsx(se,{className:"h-3 w-3"})," Connected"]}):a.status==="error"?e.jsxs(m,{variant:"destructive",className:"gap-1",children:[e.jsx(p,{className:"h-3 w-3"})," Config Error"]}):e.jsx(m,{variant:"secondary",children:"Not Configured"}):null};return P?e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Payment Gateways",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Payment Gateways"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure and enable payment methods for clients."})]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>f(),disabled:y,className:"gap-2",children:[e.jsx(ae,{className:`h-4 w-4 ${y?"animate-spin":""}`})," Verify Status"]})]}),e.jsx("div",{className:"grid gap-6",children:u.map(s=>{var r,i;const a=_[s.id];return e.jsxs(N,{className:a?"border-primary/30 ring-1 ring-primary/10 shadow-sm":"opacity-70",children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:`rounded-lg p-2 ${a?"bg-primary/10":"bg-muted"}`,children:e.jsx(s.icon,{className:`h-5 w-5 ${a?"text-primary":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s.name,T(s.id)]}),a&&((i=(r=l==null?void 0:l.gateways)==null?void 0:r.find(t=>t.id===s.id))==null?void 0:i.webhook_health)==="missing"&&e.jsxs("span",{className:"text-[10px] text-destructive flex items-center gap-1 font-normal mt-1",children:[e.jsx(p,{className:"h-2.5 w-2.5"})," Webhook secret missing - payments won't auto-credit"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-muted/50 py-1 px-3 rounded-full",children:[e.jsx(C,{htmlFor:`toggle-${s.id}`,className:"text-xs font-medium cursor-pointer",children:a?"Live for Clients":"Disabled"}),e.jsx(V,{id:`toggle-${s.id}`,checked:a,onCheckedChange:()=>{E(s.id),c.mutate({[`gateway_${s.id}_enabled`]:a?"0":"1"})}})]})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.fields.map(t=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{className:"text-[11px] uppercase tracking-wider text-muted-foreground font-semibold",children:t.label}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{type:t.secret?x[`${s.id}-${t.key}`]?"text":"password":"text",placeholder:t.placeholder,value:t.value,onChange:n=>G(s.id,t.key,n.target.value),className:"bg-muted/30 focus-visible:ring-primary/20",autoComplete:"new-password"}),t.secret&&e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>L(n=>({...n,[`${s.id}-${t.key}`]:!n[`${s.id}-${t.key}`]})),children:x[`${s.id}-${t.key}`]?e.jsx(X,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})})]})]},t.key))}),e.jsxs("div",{className:"pt-2 flex items-center justify-between border-t border-muted",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Changes take effect immediately across the platform."}),e.jsxs(b,{onClick:()=>I(s.id),className:"gap-2",size:"sm",disabled:c.isPending,children:[c.isPending?e.jsx(w,{className:"h-4 w-4 animate-spin"}):e.jsx(ee,{className:"h-4 w-4"}),"Save ",s.name," Config"]})]})]})]},s.id)})}),e.jsx(N,{className:"border-dashed bg-muted/20",children:e.jsxs(k,{className:"pt-6 text-center text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center justify-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-warning"})," Security Implementation"]}),e.jsx("p",{className:"max-w-md mx-auto",children:"These keys are stored in the system database. Ensure your backend environment is secured and database is properly firewalled."})]})})]})]})}export{ve as default};
