import{j as e,y as I,K as T,x as o,z as F,A as L,E as B,H as R,L as H}from"./ui-DhchgSRK.js";import{r as m,aB as $,B as G,U as W,aO as X,j as Y}from"./vendor-Dios4bpT.js";import{S as Z}from"./SEOHead-DJa-f5cs.js";import{C as h,c as v,a as N,b as y,d as ee}from"./card-ClKFnvWz.js";import{a as se,j as ae,k as w,I as K,B as C,e as re,f as ie,g as te,h as ne,i as b,t as j}from"./index-DkAt6S1n.js";import{L as _}from"./label-CHENNY20.js";import{T as M,a as k,b as u,c as n,d as A,e as l}from"./table-BODbY_8L.js";import{s as d}from"./client-DBtcxyoE.js";import{u as Q}from"./useMutation-qM6qjmgK.js";function ge(){const{user:r}=se(),S=ae(),[x,z]=m.useState(""),[g,E]=m.useState(""),[O,P]=m.useState("member"),{data:c,isLoading:D}=w({queryKey:["orgs",r==null?void 0:r.id],enabled:!!(r!=null&&r.id),queryFn:async()=>{const{data:s,error:a}=await d.from("org_members").select("org_id, role, organizations(id, name, slug, owner_id, created_at)").eq("user_id",r.id);if(a)throw a;return s??[]}}),U=Q({mutationFn:async()=>{const s=x.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),{data:a,error:t}=await d.from("organizations").insert({name:x,slug:s,owner_id:r.id}).select().single();if(t)throw t;return await d.from("org_members").insert({org_id:a.id,user_id:r.id,role:"owner"}),a},onSuccess:()=>{S.invalidateQueries({queryKey:["orgs"]}),z(""),j({title:"Organization Created"})},onError:s=>j({title:"Error",description:s.message,variant:"destructive"})}),[i,V]=m.useState(null),{data:f}=w({queryKey:["org-members",i],enabled:!!i,queryFn:async()=>{const{data:s,error:a}=await d.from("org_members").select("*, profiles:user_id(full_name, email)").eq("org_id",i);if(a)throw a;return s??[]}}),{data:p}=w({queryKey:["org-invites",i],enabled:!!i,queryFn:async()=>{const{data:s,error:a}=await d.from("org_invites").select("*").eq("org_id",i).is("accepted_at",null);if(a)throw a;return s??[]}}),J=Q({mutationFn:async()=>{const{error:s}=await d.from("org_invites").insert({org_id:i,email:g,role:O,invited_by:r.id});if(s)throw s},onSuccess:()=>{S.invalidateQueries({queryKey:["org-invites"]}),E(""),j({title:"Invite Sent"})},onError:s=>j({title:"Error",description:s.message,variant:"destructive"})}),q={owner:"default",admin:"secondary",member:"outline",viewer:"outline"};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Organization",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Organizations"}),e.jsxs(I,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(o,{size:"sm",children:[e.jsx($,{className:"mr-1 h-4 w-4"})," Create Org"]})}),e.jsxs(F,{children:[e.jsx(L,{children:e.jsx(B,{children:"Create Organization"})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Organization Name"}),e.jsx(K,{value:x,onChange:s=>z(s.target.value),placeholder:"Acme Corp"})]})}),e.jsxs(R,{children:[e.jsx(H,{asChild:!0,children:e.jsx(o,{variant:"outline",children:"Cancel"})}),e.jsx(o,{onClick:()=>U.mutate(),disabled:!x.trim(),children:"Create"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[D&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."}),(c==null?void 0:c.length)===0&&!D&&e.jsx(h,{className:"col-span-full",children:e.jsxs(v,{className:"py-8 text-center",children:[e.jsx(G,{className:"mx-auto h-10 w-10 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No organizations yet. Create one to get started."})]})}),c==null?void 0:c.map(s=>{var a,t;return e.jsx(h,{className:`cursor-pointer transition-colors ${i===s.org_id?"border-primary":""}`,onClick:()=>V(s.org_id),children:e.jsxs(N,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-base",children:(a=s.organizations)==null?void 0:a.name}),e.jsx(C,{variant:q[s.role]??"outline",children:s.role})]}),e.jsxs(ee,{className:"text-xs",children:["Slug: ",(t=s.organizations)==null?void 0:t.slug]})]})},s.org_id)})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsxs(y,{className:"text-lg flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"})," Members"]}),e.jsxs(I,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(o,{size:"sm",children:[e.jsx(X,{className:"mr-1 h-4 w-4"})," Invite"]})}),e.jsxs(F,{children:[e.jsx(L,{children:e.jsx(B,{children:"Invite Member"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Email"}),e.jsx(K,{value:g,onChange:s=>E(s.target.value),placeholder:"user@example.com",type:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Role"}),e.jsxs(re,{value:O,onValueChange:P,children:[e.jsx(ie,{children:e.jsx(te,{})}),e.jsxs(ne,{children:[e.jsx(b,{value:"admin",children:"Admin"}),e.jsx(b,{value:"member",children:"Member"}),e.jsx(b,{value:"viewer",children:"Viewer"})]})]})]})]}),e.jsxs(R,{children:[e.jsx(H,{asChild:!0,children:e.jsx(o,{variant:"outline",children:"Cancel"})}),e.jsx(o,{onClick:()=>J.mutate(),disabled:!g,children:"Send Invite"})]})]})]})]}),e.jsx(v,{className:"p-0",children:e.jsxs(M,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Department"}),e.jsx(n,{children:"Joined"})]})}),e.jsx(A,{children:f==null?void 0:f.map(s=>{var a,t;return e.jsxs(u,{children:[e.jsx(l,{className:"font-medium text-sm",children:((a=s.profiles)==null?void 0:a.full_name)||"—"}),e.jsx(l,{className:"text-sm",children:((t=s.profiles)==null?void 0:t.email)||"—"}),e.jsx(l,{children:e.jsx(C,{variant:q[s.role]??"outline",className:"text-xs",children:s.role})}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.department||"—"}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(s.joined_at).toLocaleDateString()})]},s.id)})})]})})]}),p&&p.length>0&&e.jsxs(h,{children:[e.jsx(N,{children:e.jsxs(y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"})," Pending Invites"]})}),e.jsx(v,{className:"p-0",children:e.jsxs(M,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Expires"})]})}),e.jsx(A,{children:p.map(s=>e.jsxs(u,{children:[e.jsx(l,{className:"text-sm",children:s.email}),e.jsx(l,{children:e.jsx(C,{variant:"outline",className:"text-xs",children:s.role})}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(s.expires_at).toLocaleDateString()})]},s.id))})]})})]})]})]})]})}export{ge as default};
