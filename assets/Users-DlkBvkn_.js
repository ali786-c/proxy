import{c as S,r as j,j as e,P as z,I as b,aK as O,aL as $,aM as E,aN as H,aO as I,D as Q,aP as J,B as y,S as V,t as m,ab as Z}from"./index-_ey3Iekf.js";import{S as G}from"./SEOHead-CCnnM028.js";import{C as p,c as f}from"./card-BNdgq2vt.js";import{B as F}from"./badge-C9auvP86.js";import{L}from"./label-ByExGtF8.js";import{T as W,a as X,b as _,c as u,d as Y,e as o}from"./table-Bz80cuOd.js";import{u as P}from"./useQuery--ax0JknR.js";import{u as ee}from"./useMutation-dWnXvasO.js";import{a as w}from"./api-BTF2QDx4.js";import{S as se}from"./search-C7EaSMyy.js";import{K as ae}from"./key-CpDp5Zgp.js";import{P as te}from"./plus-uG3TWuId.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=S("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=S("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=S("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);function de(){return P({queryKey:["admin-users"],queryFn:async()=>{const{data:l}=await w.get("/admin/users");return l}})}function ie(){const l=Z();return ee({mutationFn:async n=>{let d="/admin/users",i=n;n.action==="adjust_balance"?(d="/admin/users/balance",i={user_id:n.user_id,amount:n.amount,reason:n.reason}):(n.action==="ban_user"||n.action==="unban_user")&&(d="/admin/users/ban",i={user_id:n.user_id,is_banned:n.action==="ban_user",reason:n.ban_reason});const{data:g}=await w.post(d,i);return g},onSuccess:()=>l.invalidateQueries({queryKey:["admin-users"]})})}function ce(){return P({queryKey:["admin-stats"],queryFn:async()=>{const{data:l}=await w.get("/admin/stats");return l}})}function ye(){var B,U,M;const{data:l,isLoading:n}=de(),d=ie(),[i,g]=j.useState(""),[a,x]=j.useState(null),[h,N]=j.useState(""),[C,v]=j.useState(""),{data:c}=ce((a==null?void 0:a.user_id)??null);if(n)return e.jsx(z,{});const k=(l??[]).filter(s=>{var t,r;return!(i&&!((t=s.email)!=null&&t.toLowerCase().includes(i.toLowerCase()))&&!((r=s.name)!=null&&r.toLowerCase().includes(i.toLowerCase())))}),D=async(s,t)=>{try{await d.mutateAsync({action:t?"unban_user":"ban_user",user_id:s,ban_reason:t?void 0:"Violated terms of service"}),x(null),m({title:t?"User unbanned":"User banned"})}catch(r){m({title:"Error",description:r.message,variant:"destructive"})}},A=async s=>{const t=parseFloat(h);if(!t||t<=0){m({title:"Invalid amount",variant:"destructive"});return}try{const r=await d.mutateAsync({action:"adjust_balance",user_id:a.user_id,amount:s?t:-t,reason:C||(s?"Admin top-up":"Admin deduction")});N(""),v(""),x(T=>T?{...T,balance:r.new_balance}:null),m({title:`Balance ${s?"topped up":"deducted"} successfully`})}catch(r){m({title:"Error",description:r.message,variant:"destructive"})}},q=(l??[]).length,K=(l??[]).filter(s=>s.is_banned).length,R=(l??[]).reduce((s,t)=>s+Number(t.balance??0),0);return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Admin — Users",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all registered users, balances, and access."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(p,{children:e.jsxs(f,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:q})]})}),e.jsx(p,{children:e.jsxs(f,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Banned Users"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:K})]})}),e.jsx(p,{children:e.jsxs(f,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total User Balances"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",R.toFixed(2)]})]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(se,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(b,{placeholder:"Search by name or email…",value:i,onChange:s=>g(s.target.value),className:"pl-9"})]})}),e.jsx(p,{children:e.jsx(f,{className:"p-0",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(_,{children:[e.jsx(u,{children:"User"}),e.jsx(u,{children:"Role"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Balance"}),e.jsx(u,{children:"Joined"})]})}),e.jsxs(Y,{children:[k.map(s=>{var t,r;return e.jsxs(_,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>x(s),children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(o,{className:"capitalize",children:((r=(t=s.user_roles)==null?void 0:t[0])==null?void 0:r.role)??"client"}),e.jsx(o,{children:e.jsx(F,{variant:s.is_banned?"destructive":"default",children:s.is_banned?"Banned":"Active"})}),e.jsxs(o,{children:["$",Number(s.balance??0).toFixed(2)]}),e.jsx(o,{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()})]},s.id)}),k.length===0&&e.jsx(_,{children:e.jsx(o,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No users found."})})]})]})})})]}),e.jsx(O,{open:!!a,onOpenChange:()=>{x(null),N(""),v("")},children:e.jsx($,{className:"sm:max-w-lg overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx(H,{children:a.full_name||"User"}),e.jsx(I,{children:a.email})]}),e.jsxs("div",{className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:((U=(B=a.user_roles)==null?void 0:B[0])==null?void 0:U.role)??"client"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx(F,{variant:a.is_banned?"destructive":"default",children:a.is_banned?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:"font-medium text-lg",children:["$",Number(a.balance??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString()})]})]}),c&&e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"User Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"font-medium",children:["$",((M=c.total_spent)==null?void 0:M.toFixed(2))??"0.00"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsxs("p",{className:"font-medium",children:[c.active_orders??0," active / ",c.total_orders??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"API Keys"}),e.jsxs("p",{className:"font-medium",children:[c.active_keys??0," active / ",c.total_keys??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tickets"}),e.jsxs("p",{className:"font-medium",children:[c.open_tickets??0," open / ",c.total_tickets??0," total"]})]})]})]})]}),a.ban_reason&&e.jsxs("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx("strong",{children:"Ban reason:"})," ",a.ban_reason]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Adjust Balance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(b,{id:"amount",type:"number",min:"0.01",step:"0.01",placeholder:"e.g. 50.00",value:h,onChange:s=>N(s.target.value)}),e.jsx(L,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(b,{id:"reason",placeholder:"e.g. Manual credit for support case",value:C,onChange:s=>v(s.target.value)}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(y,{size:"sm",onClick:()=>A(!0),disabled:d.isPending||!h,className:"flex-1",children:[e.jsx(te,{className:"mr-1 h-4 w-4"})," Top Up"]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>A(!1),disabled:d.isPending||!h,className:"flex-1",children:[e.jsx(ne,{className:"mr-1 h-4 w-4"})," Deduct"]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Access Control"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(y,{variant:a.is_banned?"default":"destructive",size:"sm",onClick:()=>D(a.user_id,a.is_banned),disabled:d.isPending,children:[a.is_banned?e.jsx(V,{className:"mr-2 h-4 w-4"}):e.jsx(re,{className:"mr-2 h-4 w-4"}),a.is_banned?"Unban User":"Ban User"]})})]})]})]})})})]})}export{ye as default};
