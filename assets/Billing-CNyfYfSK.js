import{j as e,x as d}from"./ui-Db55-w3B.js";import{r as l,t as O,H as oe,aA as B,aE as de,a3 as ue,aw as G,ay as me,a5 as xe,d as he,D as pe}from"./vendor-CgSstL__.js";import{S as je}from"./SEOHead-cgJ2NLCH.js";import{C as v,a as N,b,d as fe,c as C}from"./card-CKaggAyA.js";import{T as ye,a as ge,b as K,c as w,d as ve,e as A}from"./table-DCfFUwfR.js";import{l as Ne,b as be,u as Ce,d as we,k as W,I as S,B as U,m as Ae,c as x}from"./index-BqYHc14a.js";import{L as T}from"./label-Ck9hvDyF.js";import{S as Se}from"./switch-BcxWQJqc.js";import{M as Te}from"./ManualCryptoDialog-Bh2uaLCm.js";const Pe=.22,u=5,ke={paid:"default",pending:"secondary",failed:"destructive"};function Le(){const{toast:n}=Ne(),{format:a}=be(),{t:h}=Ce(),[$]=l.useState("residential"),[j,D]=l.useState("50"),{gateways:p,autoTopUpEnabled:Y}=we(),[_,I]=l.useState(!1),[Q,J]=l.useState("50"),[X,Z]=l.useState("5"),[c,ee]=l.useState(null),[f,V]=l.useState(""),[y,m]=l.useState(!1),[se,L]=l.useState(!1),[t,P]=l.useState(null),[R,H]=l.useState(!1),{data:te}=W({queryKey:["plans"],queryFn:()=>x.getPlans()}),{data:ae}=W({queryKey:["invoices"],queryFn:()=>x.getInvoices()}),o=parseFloat(j)||0,k=t?t.discount:0,F=Math.max(0,o-k),g=c==="cryptomus"||c==="manual",q=g?0:F*Pe,E=F+q,M=o<u,ne=async()=>{if(f.trim()){if(o<u){n({title:"Error",description:`Please enter an amount of at least ${a(u)} first.`,variant:"destructive"});return}H(!0);try{const s=await x.validateCoupon(f.toUpperCase(),o);s.valid&&(P({code:s.code,discount:s.discount,type:s.type,value:s.value}),n({title:"Coupon Applied",description:`You saved ${a(s.discount)}!`}))}catch(s){P(null),n({title:"Invalid Coupon",description:s.message||"This code is not valid.",variant:"destructive"})}finally{H(!1)}}},ie=s=>{n({title:"Product Selected",description:`Switching to ${s}.`})},re=async s=>{if(I(s),s)try{const{client_secret:i}=await x.createSetupIntent();n({title:"Card setup started",description:"Please follow the instructions to save your card for auto top-up."})}catch(i){n({title:"Setup Error",description:i.message,variant:"destructive"}),I(!1)}},le=async()=>{if(M){n({title:"Minimum not met",description:`Minimum purchase is ${a(u)}.`,variant:"destructive"});return}if(!c){n({title:"Select a payment method",description:"Please choose how you'd like to pay.",variant:"destructive"});return}if(c==="cryptomus"){m(!0);try{const{url:s}=await x.createCryptomusCheckout(o,t==null?void 0:t.code);window.location.href=s}catch(s){n({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{m(!1)}}else if(c==="stripe"){m(!0);try{const{url:s}=await x.createCheckout($,o,t==null?void 0:t.code);window.location.href=s}catch(s){n({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{m(!1)}}else c==="manual"?L(!0):n({title:`Pay with ${c}`,description:`Redirecting to ${c} checkout for ${a(E)}...`})},z=[{id:"stripe",name:"Card (Stripe)",subtitle:"Credit/Debit Card",icon:O,vatLabel:"+22% VAT",enabled:p.stripe},{id:"paypal",name:"PayPal",subtitle:"PayPal Balance",icon:oe,vatLabel:"+22% VAT",enabled:p.paypal},{id:"cryptomus",name:"Crypto",subtitle:"Automated via Cryptomus",icon:B,vatLabel:"No VAT",enabled:p.cryptomus},{id:"manual",name:"Binance Pay",subtitle:"Manual Transfer",icon:B,vatLabel:"No VAT",enabled:p.crypto}],ce=z.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:"Account & Billing",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Account & Billing"}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center gap-2 text-lg",children:[e.jsx(de,{className:"h-5 w-5"})," ",h("billing.topUp")]}),e.jsxs(fe,{children:[h("billing.minPurchaseTitle"),": ",a(u),". 22% VAT applies to card & PayPal payments. Crypto is VAT-free."]})]}),e.jsxs(C,{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 max-w-lg",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(T,{children:"Amount"}),e.jsx(S,{type:"number",value:j,onChange:s=>D(s.target.value),min:u,step:"1",placeholder:`Min ${a(u)}`}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["10","25","50","100"].map(s=>e.jsx(d,{variant:"outline",size:"sm",className:`text-xs h-7 px-3 ${j===s?"border-primary bg-primary/5 text-primary":""}`,onClick:()=>D(s),children:a(Number(s))},s))}),M&&o>0&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"})," Minimum purchase is ",a(u)]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(T,{children:"Promo Code (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{placeholder:"WELCOME20",value:f,onChange:s=>V(s.target.value),className:t?"border-green-500 bg-green-500/5":"",disabled:!!t}),t?e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{P(null),V("")},children:"Remove"}):e.jsx(d,{variant:"outline",size:"sm",className:"shrink-0",onClick:ne,disabled:R||!f.trim(),children:R?e.jsx(G,{className:"h-4 w-4 animate-spin"}):"Apply"})]}),t&&e.jsxs("p",{className:"text-[11px] text-green-600 font-medium",children:[" Coupon applied: ",t.type==="percentage"?`${t.value}%`:`${a(t.value)}`," off"]})]})]}),!ce&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No payment methods are currently available. Please contact support."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:z.map(s=>{const i=s.enabled,r=c===s.id;return e.jsxs(d,{variant:r?"default":"outline",className:`h-auto py-4 flex-col gap-1 relative ${i?"":"opacity-40 cursor-not-allowed"}`,disabled:!i,onClick:()=>ee(s.id),children:[e.jsx(s.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-[11px] font-normal opacity-80",children:s.subtitle}),e.jsx(U,{variant:s.id==="crypto"||s.id==="manual"?"default":"secondary",className:"text-[10px] mt-1",children:s.vatLabel}),!i&&e.jsx("span",{className:"text-[10px] font-normal",children:"Not available"})]},s.id)})}),c&&o>=u&&e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 max-w-sm space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:h("billing.orderSummary")}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:h("billing.subtotal")}),e.jsx("span",{children:a(o)})]}),k>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 font-medium font-mono",children:[e.jsxs("span",{children:["Discount (",t==null?void 0:t.code,")"]}),e.jsxs("span",{children:["-",a(k)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["VAT (22%)",g&&e.jsx(me,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("span",{className:g?"line-through text-muted-foreground":"",children:g?`${a(0)} â€” exempt`:`${a(q)}`})]}),e.jsx(Ae,{}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{children:h("common.total")}),e.jsx("span",{children:a(E)})]}),e.jsxs(d,{className:"w-full mt-2",onClick:le,disabled:M||y,children:[y?e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}):null,h("common.pay")," ",a(E)]})]})]})]}),Y&&e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(b,{className:"flex items-center gap-2 text-lg",children:[e.jsx(xe,{className:"h-5 w-5"})," Auto Top-Up"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically add balance when it drops below the threshold"})]}),e.jsx(Se,{checked:_,onCheckedChange:re})]}),_&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(T,{children:"Min Balance Threshold"}),e.jsx(S,{type:"number",value:X,onChange:s=>Z(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(T,{children:"Top-Up Amount"}),e.jsx(S,{type:"number",value:Q,onChange:s=>J(s.target.value)})]})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:(te||[]).map(s=>{const i=s.id===$;return e.jsxs(v,{className:i?"border-primary ring-2 ring-primary/20":"",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(b,{className:"flex items-center justify-between text-lg",children:[s.name,i&&e.jsx(U,{children:"Active"})]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("p",{className:"text-3xl font-bold",children:[a(s.price_cents/100),e.jsxs("span",{className:"text-base font-normal text-muted-foreground",children:["/",(s.id==="datacenter","GB")]})]}),e.jsx("ul",{className:"space-y-1.5",children:s.features.map(r=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(he,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),r]},r))}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{variant:i?"outline":"default",className:"w-full",disabled:i,onClick:()=>ie(s.id),children:i?"Active Product":"Select Product"}),!i&&e.jsxs("div",{className:"flex flex-col gap-2",children:[p.stripe&&e.jsxs(d,{variant:"secondary",className:"w-full gap-2",disabled:y,onClick:async()=>{m(!0);try{const{url:r}=await x.createProductCheckout(s.id,1);window.location.href=r}catch(r){n({title:"Purchase Error",description:r.message,variant:"destructive"})}finally{m(!1)}},children:[e.jsx(O,{className:"h-4 w-4"})," Buy with Card"]}),p.cryptomus&&e.jsxs(d,{variant:"outline",className:"w-full gap-2 border-primary/20 hover:border-primary/50",disabled:y,onClick:async()=>{m(!0);try{const{url:r}=await x.createCryptomusProductCheckout(s.id,1);window.location.href=r}catch(r){n({title:"Purchase Error",description:r.message,variant:"destructive"})}finally{m(!1)}},children:[e.jsx(B,{className:"h-4 w-4 text-orange-500"})," Buy with Crypto"]})]})]})]})]},s.id)})}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(b,{className:"text-lg",children:h("nav.invoices")})}),e.jsx(C,{className:"p-0",children:e.jsxs(ye,{children:[e.jsx(ge,{children:e.jsxs(K,{children:[e.jsx(w,{children:"Period"}),e.jsx(w,{children:"Amount"}),e.jsx(w,{children:"Status"}),e.jsx(w,{className:"text-right",children:"Date"})]})}),e.jsx(ve,{children:(ae||[]).map(s=>e.jsxs(K,{children:[e.jsx(A,{className:"font-medium",children:s.period}),e.jsx(A,{children:a(s.amount_cents/100)}),e.jsx(A,{children:e.jsx(U,{variant:ke[s.status]??"secondary",children:s.status})}),e.jsxs(A,{className:"text-right text-sm text-muted-foreground space-x-2",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.pdf_url&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"Download PDF",children:e.jsx("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(pe,{className:"h-3.5 w-3.5"})})})]})]},s.id))})]})})]})]}),e.jsx(Te,{open:se,onOpenChange:L,defaultAmount:j})]})}export{Le as default};
