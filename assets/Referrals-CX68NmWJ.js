import{j as e,x as I}from"./ui-BkJV2AdO.js";import{r as f,U as H,as as Q,I as z,a5 as G,aF as K}from"./vendor-BJanyxg7.js";import{j as O,b as V,k as J,B as W,I as L,y as F,M as X,t as M,z as Y}from"./index-CmkPm4ZO.js";import{E as Z,F as $,G as ee}from"./use-backend-vi0wKCdu.js";import{C as n,c as i,a as u,b as j,d as p}from"./card-l-SRMqus.js";import{T as k,a as A,b as o,c as t,d as D,e as l}from"./table-8_4vQSbC.js";import{T as se,a as re,b as g,c as v}from"./tabs-CfhMkzxn.js";import{S as ae}from"./switch-BUiAWSVm.js";import{L as y}from"./label-BFQ1M4xB.js";import{f as le}from"./format-sbWH3_uq.js";import"./useMutation-zVhomvj5.js";function ge(){var w,S,C;const N=O(),{format:h}=V(),{data:a,isLoading:P}=Z(),[U,te]=f.useState(""),{data:d,isLoading:ne}=$(U),q=ee(),[r,m]=f.useState(null),[_,b]=f.useState(!1),{data:x}=J({queryKey:["admin","settings","referral"],queryFn:async()=>F.get("/admin/settings",Y())});x&&!r&&m({referral_system_enabled:x.referral_system_enabled==="1",referral_commission_percentage:x.referral_commission_percentage||"10",referral_hold_days:x.referral_hold_days||"14"});const B=async()=>{b(!0);try{await F.post("/admin/settings",X,{referral_system_enabled:r.referral_system_enabled?"1":"0",referral_commission_percentage:r.referral_commission_percentage,referral_hold_days:r.referral_hold_days}),M({title:"Settings Saved",description:"Referral configuration updated successfully."}),N.invalidateQueries({queryKey:["admin","settings"]})}catch{M({title:"Error",description:"Failed to save settings.",variant:"destructive"})}finally{b(!1)}};return P?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Referral Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor and configure the platform referral program."})]})}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:e.jsx(H,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Referrals"}),e.jsx("p",{className:"text-2xl font-bold",children:a==null?void 0:a.total_referrals})]})]})})}),e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-warning/10 rounded-full",children:e.jsx(Q,{className:"h-6 w-6 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Payouts"}),e.jsx("p",{className:"text-2xl font-bold",children:h((a==null?void 0:a.total_pending)||0)})]})]})})}),e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-success/10 rounded-full",children:e.jsx(z,{className:"h-6 w-6 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Paid Out"}),e.jsx("p",{className:"text-2xl font-bold",children:h((a==null?void 0:a.total_completed)||0)})]})]})})})]}),e.jsxs(se,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(re,{children:[e.jsx(g,{value:"overview",children:"Earnings Overview"}),e.jsx(g,{value:"influencers",children:"Influencers"}),e.jsx(g,{value:"settings",children:"Global Settings"})]}),e.jsx(v,{value:"overview",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Recent Earning Records"}),e.jsx(p,{children:"View all referral commissions across the platform."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(G,{className:"h-4 w-4 cursor-pointer text-muted-foreground hover:text-foreground",onClick:()=>N.invalidateQueries({queryKey:["admin","referrals","earnings"]})})})]}),e.jsx(i,{children:e.jsxs(k,{children:[e.jsx(A,{children:e.jsxs(o,{children:[e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Referrer"}),e.jsx(t,{children:"Referred User"}),e.jsx(t,{children:"Amount"}),e.jsx(t,{children:"Status"})]})}),e.jsxs(D,{children:[(w=d==null?void 0:d.data)==null?void 0:w.map(s=>{var c,R,T,E;return e.jsxs(o,{children:[e.jsx(l,{className:"text-xs",children:le(new Date(s.created_at),"MMM dd, yyyy")}),e.jsxs(l,{children:[e.jsx("div",{className:"text-sm font-medium",children:(c=s.referrer)==null?void 0:c.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(R=s.referrer)==null?void 0:R.email})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-sm",children:(T=s.referred)==null?void 0:T.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(E=s.referred)==null?void 0:E.email})]}),e.jsx(l,{className:"font-bold",children:h(s.amount)}),e.jsx(l,{children:e.jsx(W,{variant:s.status==="completed"?"success":"warning",className:"capitalize",children:s.status})})]},s.id)}),(!d||((S=d.data)==null?void 0:S.length)===0)&&e.jsx(o,{children:e.jsx(l,{colSpan:5,className:"text-center py-10 text-muted-foreground",children:"No earning records found."})})]})]})})]})}),e.jsx(v,{value:"influencers",children:e.jsxs(n,{children:[e.jsxs(u,{children:[e.jsx(j,{children:"Top Referrers & Influencers"}),e.jsx(p,{children:"Set custom commission rates for high-performing partners."})]}),e.jsx(i,{children:e.jsxs(k,{children:[e.jsx(A,{children:e.jsxs(o,{children:[e.jsx(t,{children:"User"}),e.jsx(t,{className:"text-center",children:"Total Referrals"}),e.jsx(t,{className:"text-right",children:"Action"})]})}),e.jsx(D,{children:(C=a==null?void 0:a.top_referrers)==null?void 0:C.map(s=>e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx(l,{className:"text-center",children:s.referrals_count}),e.jsx(l,{className:"text-right",children:e.jsx(I,{variant:"outline",size:"sm",onClick:()=>{const c=prompt("Enter custom commission rate (%) for this user:","15");c!==null&&q.mutate({user_id:s.id,custom_rate:parseFloat(c)})},children:"Set Custom Rate"})})]},s.id))})]})})]})}),e.jsx(v,{value:"settings",children:e.jsxs(n,{children:[e.jsxs(u,{children:[e.jsx(j,{children:"Global Referral Settings"}),e.jsx(p,{children:"Configure how commissions are handled sitewide."})]}),e.jsxs(i,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{children:"Enable Referral Program"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Allow users to invite users and earn commissions."})]}),e.jsx(ae,{checked:r==null?void 0:r.referral_system_enabled,onCheckedChange:s=>m({...r,referral_system_enabled:s})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Default Commission Rate (%)"}),e.jsx(L,{type:"number",value:r==null?void 0:r.referral_commission_percentage,onChange:s=>m({...r,referral_commission_percentage:s.target.value})}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Standard percentage new referrers receive."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Escrow (Hold) Period (Days)"}),e.jsx(L,{type:"number",value:r==null?void 0:r.referral_hold_days,onChange:s=>m({...r,referral_hold_days:s.target.value})}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Days to hold funds before releasing to wallet."})]})]}),e.jsxs(I,{onClick:B,disabled:_,className:"w-full gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),_?"Saving...":"Save Configuration"]})]})]})})]})]})}export{ge as default};
