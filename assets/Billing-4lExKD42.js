import{j as e,x as o}from"./ui-A4Mg_2PO.js";import{r as l,K as _,W as Z,aA as S,aE as ee,a3 as se,ay as ae,aw as te,a5 as re,d as ie,V as le}from"./vendor-B1YgQW9R.js";import{S as ne}from"./SEOHead-bySEXYeq.js";import{C as j,a as y,b as f,d as ce,c as g}from"./card-CGPo2FAR.js";import{T as oe,a as de,b as D,c as N,d as me,e as b}from"./table-BKfF2Z1b.js";import{k as ue,b as xe,j as L,I as v,B as T,l as he,c as d}from"./index-CA3Sp4x6.js";import{L as C}from"./label-7BY5oMnS.js";import{S as pe}from"./switch-C8gezRi1.js";import{M as je}from"./ManualCryptoDialog-CTI8uMb_.js";const ye=.22,m=5,fe={paid:"default",pending:"secondary",failed:"destructive"};function Pe(){const{toast:r}=ue(),[P]=l.useState("residential"),[x,k]=l.useState("50"),{gateways:u,autoTopUpEnabled:V}=xe(),[E,M]=l.useState(!1),[I,R]=l.useState("50"),[$,H]=l.useState("5"),[i,O]=l.useState(null),[q,z]=l.useState(""),[h,n]=l.useState(!1),[G,B]=l.useState(!1),{data:K}=L({queryKey:["plans"],queryFn:()=>d.getPlans()}),{data:W}=L({queryKey:["invoices"],queryFn:()=>d.getInvoices()}),c=parseFloat(x)||0,p=i==="cryptomus"||i==="manual",F=p?0:c*ye,w=c+F,A=c<m,Q=s=>{r({title:"Product Selected",description:`Switching to ${s}.`})},Y=async s=>{if(M(s),s)try{const{client_secret:a}=await d.createSetupIntent();r({title:"Card setup started",description:"Please follow the instructions to save your card for auto top-up."})}catch(a){r({title:"Setup Error",description:a.message,variant:"destructive"}),M(!1)}},J=async()=>{if(A){r({title:"Minimum not met",description:`Minimum purchase is €${m}.`,variant:"destructive"});return}if(!i){r({title:"Select a payment method",description:"Please choose how you'd like to pay.",variant:"destructive"});return}if(i==="cryptomus"){n(!0);try{const{url:s}=await d.createCryptomusCheckout(c);window.location.href=s}catch(s){r({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{n(!1)}}else if(i==="stripe"){n(!0);try{const{url:s}=await d.createCheckout(P,c);window.location.href=s}catch(s){r({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{n(!1)}}else i==="manual"?B(!0):r({title:`Pay with ${i}`,description:`Redirecting to ${i} checkout for €${w.toFixed(2)}...`})},U=[{id:"stripe",name:"Card (Stripe)",subtitle:"Credit/Debit Card",icon:_,vatLabel:"+22% VAT",enabled:u.stripe},{id:"paypal",name:"PayPal",subtitle:"PayPal Balance",icon:Z,vatLabel:"+22% VAT",enabled:u.paypal},{id:"cryptomus",name:"Crypto",subtitle:"Automated via Cryptomus",icon:S,vatLabel:"No VAT",enabled:u.cryptomus},{id:"manual",name:"Binance Pay",subtitle:"Manual Transfer",icon:S,vatLabel:"No VAT",enabled:u.crypto}],X=U.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:"Account & Billing",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Account & Billing"}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(f,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ee,{className:"h-5 w-5"})," Add Balance"]}),e.jsxs(ce,{children:["Minimum purchase: €",m,". 22% VAT applies to card & PayPal payments. Crypto is VAT-free."]})]}),e.jsxs(g,{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 max-w-lg",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{children:"Amount (€)"}),e.jsx(v,{type:"number",value:x,onChange:s=>k(s.target.value),min:m,step:"1",placeholder:`Min €${m}`}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["10","25","50","100"].map(s=>e.jsxs(o,{variant:"outline",size:"sm",className:`text-xs h-7 px-3 ${x===s?"border-primary bg-primary/5 text-primary":""}`,onClick:()=>k(s),children:["€",s]},s))}),A&&c>0&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"})," Minimum purchase is €",m]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{children:"Promo Code (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{placeholder:"WELCOME20",value:q,onChange:s=>z(s.target.value)}),e.jsx(o,{variant:"outline",size:"sm",className:"shrink-0",onClick:()=>r({title:"Coupon Applied",description:"Discount applied to your balance."}),children:"Apply"})]})]})]}),!X&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No payment methods are currently available. Please contact support."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:U.map(s=>{const a=s.enabled,t=i===s.id;return e.jsxs(o,{variant:t?"default":"outline",className:`h-auto py-4 flex-col gap-1 relative ${a?"":"opacity-40 cursor-not-allowed"}`,disabled:!a,onClick:()=>O(s.id),children:[e.jsx(s.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-[11px] font-normal opacity-80",children:s.subtitle}),e.jsx(T,{variant:s.id==="crypto"||s.id==="manual"?"default":"secondary",className:"text-[10px] mt-1",children:s.vatLabel}),!a&&e.jsx("span",{className:"text-[10px] font-normal",children:"Not available"})]},s.id)})}),i&&c>=m&&e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 max-w-sm space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["€",c.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["VAT (22%)",p&&e.jsx(ae,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("span",{className:p?"line-through text-muted-foreground":"",children:p?"€0.00 — exempt":`€${F.toFixed(2)}`})]}),e.jsx(he,{}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["€",w.toFixed(2)]})]}),e.jsxs(o,{className:"w-full mt-2",onClick:J,disabled:A||h,children:[h?e.jsx(te,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Pay €",w.toFixed(2)]})]})]})]}),V&&e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(f,{className:"flex items-center gap-2 text-lg",children:[e.jsx(re,{className:"h-5 w-5"})," Auto Top-Up"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically add balance when it drops below the threshold"})]}),e.jsx(pe,{checked:E,onCheckedChange:Y})]}),E&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{children:"Min Balance Threshold (€)"}),e.jsx(v,{type:"number",value:$,onChange:s=>H(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{children:"Top-Up Amount (€)"}),e.jsx(v,{type:"number",value:I,onChange:s=>R(s.target.value)})]})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:(K||[]).map(s=>{const a=s.id===P;return e.jsxs(j,{className:a?"border-primary ring-2 ring-primary/20":"",children:[e.jsx(y,{className:"pb-2",children:e.jsxs(f,{className:"flex items-center justify-between text-lg",children:[s.name,a&&e.jsx(T,{children:"Active"})]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("p",{className:"text-3xl font-bold",children:["€",(s.price_cents/100).toFixed(2),e.jsxs("span",{className:"text-base font-normal text-muted-foreground",children:["/",(s.id==="datacenter","GB")]})]}),e.jsx("ul",{className:"space-y-1.5",children:s.features.map(t=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(ie,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),t]},t))}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{variant:a?"outline":"default",className:"w-full",disabled:a,onClick:()=>Q(s.id),children:a?"Active Product":"Select Product"}),!a&&e.jsxs("div",{className:"flex flex-col gap-2",children:[u.stripe&&e.jsxs(o,{variant:"secondary",className:"w-full gap-2",disabled:h,onClick:async()=>{n(!0);try{const{url:t}=await d.createProductCheckout(s.id,1);window.location.href=t}catch(t){r({title:"Purchase Error",description:t.message,variant:"destructive"})}finally{n(!1)}},children:[e.jsx(_,{className:"h-4 w-4"})," Buy with Card"]}),u.cryptomus&&e.jsxs(o,{variant:"outline",className:"w-full gap-2 border-primary/20 hover:border-primary/50",disabled:h,onClick:async()=>{n(!0);try{const{url:t}=await d.createCryptomusProductCheckout(s.id,1);window.location.href=t}catch(t){r({title:"Purchase Error",description:t.message,variant:"destructive"})}finally{n(!1)}},children:[e.jsx(S,{className:"h-4 w-4 text-orange-500"})," Buy with Crypto"]})]})]})]})]},s.id)})}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsx(f,{className:"text-lg",children:"Recent Invoices"})}),e.jsx(g,{className:"p-0",children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(D,{children:[e.jsx(N,{children:"Period"}),e.jsx(N,{children:"Amount"}),e.jsx(N,{children:"Status"}),e.jsx(N,{className:"text-right",children:"Date"})]})}),e.jsx(me,{children:(W||[]).map(s=>e.jsxs(D,{children:[e.jsx(b,{className:"font-medium",children:s.period}),e.jsxs(b,{children:["€",(s.amount_cents/100).toFixed(2)]}),e.jsx(b,{children:e.jsx(T,{variant:fe[s.status]??"secondary",children:s.status})}),e.jsxs(b,{className:"text-right text-sm text-muted-foreground space-x-2",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.pdf_url&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"Download PDF",children:e.jsx("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(le,{className:"h-3.5 w-3.5"})})})]})]},s.id))})]})})]})]}),e.jsx(je,{open:G,onOpenChange:B,defaultAmount:x})]})}export{Pe as default};
