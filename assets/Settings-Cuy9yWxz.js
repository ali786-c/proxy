import{j as e,U,S as k,r as i,N as g,I as p,b as B,B as m,t as N}from"./index-Bx9E3-uY.js";import{S as $}from"./SEOHead-DBJMFxMn.js";import{E as q}from"./ErrorBanner-CWhE8ULd.js";import{E}from"./EmptyState-CLjhbmGu.js";import{L as C}from"./label-BQaxNn-t.js";import{C as f,c as y,a as A,b as S}from"./card-Dx3x6St9.js";import{T as K,a as L,b as I,c as h,d as R,e as u}from"./table-B9wxOtWo.js";import{T as M,a as O,b as D,c as T}from"./tabs-Dg13YBeN.js";import{D as V,a as Y,b as Z,c as G,d as J,e as Q,f as W}from"./dialog-VzmFoCg0.js";import{e as X,f as ee,g as se,h as ae}from"./use-backend-BnAaTMwo.js";import{K as F}from"./key-DndAVLAE.js";import{P as _}from"./plus-Bqjrl23s.js";import{T as z}from"./trash-2-S4XuEBFy.js";import{C as te}from"./copy-DyKcXlmj.js";import"./circle-alert-7422hRij.js";import"./useQuery-ChZ6uqLZ.js";import"./useMutation-CN0GH49C.js";import"./api-BTF2QDx4.js";function Ce(){return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Settings",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"}),e.jsxs(M,{defaultValue:"allowlist",children:[e.jsxs(O,{children:[e.jsxs(D,{value:"profile",children:[e.jsx(U,{className:"mr-1 h-3.5 w-3.5"})," Profile"]}),e.jsxs(D,{value:"allowlist",children:[e.jsx(k,{className:"mr-1 h-3.5 w-3.5"})," IP Allowlist"]}),e.jsxs(D,{value:"api-keys",children:[e.jsx(F,{className:"mr-1 h-3.5 w-3.5"})," API Keys"]})]}),e.jsx(T,{value:"profile",className:"mt-4",children:e.jsx(ie,{})}),e.jsx(T,{value:"allowlist",className:"mt-4",children:e.jsx(le,{})}),e.jsx(T,{value:"api-keys",className:"mt-4",children:e.jsx(re,{})})]})]})]})}function le(){const{data:a,isLoading:w,addEntry:n,removeEntry:x}=se(),[d,c]=i.useState(""),[l,o]=i.useState(""),[j,s]=i.useState(null),b=async()=>{var r,v;s(null);const t=d.trim();if(!t){s("IP address is required.");return}if(!/^\d{1,3}(\.\d{1,3}){3}(\/\d{1,2})?$/.test(t)){s("Enter a valid IPv4 address or CIDR range.");return}try{await n.mutateAsync({ip:t,label:l.trim()||void 0}),c(""),o(""),N({title:"IP Added",description:`${t} added to allowlist.`})}catch(P){s(((v=(r=P.response)==null?void 0:r.data)==null?void 0:v.message)||"Failed to add IP.")}};return w?e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx(g,{className:"h-20 w-full"}),e.jsx(g,{className:"h-40 w-full"})]}):e.jsxs(f,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"IP Allowlist"})}),e.jsxs(y,{className:"space-y-4",children:[j&&e.jsx(q,{message:j,onDismiss:()=>s(null)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"203.0.113.0/24",value:d,onChange:t=>c(t.target.value),className:"max-w-xs"}),e.jsx(p,{placeholder:"Label (optional)",value:l,onChange:t=>o(t.target.value),className:"max-w-xs"}),e.jsx(m,{onClick:b,disabled:n.isPending,children:n.isPending?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-1 h-4 w-4"})," Add"]})})]}),!a||a.length===0?e.jsx(E,{icon:k,title:"No IPs allowlisted",description:"Add your server IPs to authenticate without credentials."}):e.jsxs(K,{children:[e.jsx(L,{children:e.jsxs(I,{children:[e.jsx(h,{children:"IP Address"}),e.jsx(h,{children:"Label"}),e.jsx(h,{children:"Added"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(R,{children:a.map(t=>e.jsxs(I,{children:[e.jsx(u,{className:"font-mono text-sm",children:t.ip}),e.jsx(u,{className:"text-sm text-muted-foreground",children:t.label??"—"}),e.jsx(u,{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString()}),e.jsx(u,{children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>x.mutate(t.id),disabled:x.isPending,"aria-label":"Remove",children:e.jsx(z,{className:"h-4 w-4 text-destructive"})})})]},t.id))})]})]})]})}function re(){const{data:a,isLoading:w,createKey:n,revokeKey:x}=ae(),[d,c]=i.useState(null),[l,o]=i.useState(""),j=async()=>{if(l.trim())try{const s=await n.mutateAsync(l.trim());c(s.api_key),o(""),N({title:"API Key Created",description:"Copy it now — it won't be shown again."})}catch{N({title:"Error",description:"Failed to create API key.",variant:"destructive"})}};return w?e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx(g,{className:"h-20 w-full"}),e.jsx(g,{className:"h-40 w-full"})]}):e.jsxs("div",{className:"space-y-4",children:[d&&e.jsx(f,{className:"border-primary",children:e.jsxs(y,{className:"flex items-center justify-between gap-4 py-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Your new API key (copy now — shown once):"}),e.jsx("code",{className:"mt-1 block text-xs font-mono text-primary break-all bg-muted p-2 rounded",children:d})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(d||""),N({title:"Copied"})},children:[e.jsx(te,{className:"mr-1 h-3.5 w-3.5"})," Copy"]})]})}),e.jsxs(f,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsx(S,{className:"text-lg",children:"API Keys"}),e.jsxs(V,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(m,{size:"sm",children:[e.jsx(_,{className:"mr-1 h-4 w-4"})," Create Key"]})}),e.jsxs(Z,{children:[e.jsx(G,{children:e.jsx(J,{children:"Create API Key"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Key Name"}),e.jsx(p,{value:l,onChange:s=>o(s.target.value),placeholder:"Production"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"API keys allow you to generate proxies and check usage via our REST API."})]}),e.jsxs(Q,{children:[e.jsx(W,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"Cancel"})}),e.jsx(m,{onClick:j,disabled:!l.trim()||n.isPending,children:n.isPending?"Creating...":"Create"})]})]})]})]}),e.jsx(y,{className:"p-0",children:!a||a.length===0?e.jsx("div",{className:"p-6",children:e.jsx(E,{icon:F,title:"No API keys",description:"Create a key to access the UpgradedProxy API programmatically."})}):e.jsxs(K,{children:[e.jsx(L,{children:e.jsxs(I,{children:[e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Key Prefix"}),e.jsx(h,{children:"Added"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(R,{children:a.map(s=>e.jsxs(I,{children:[e.jsx(u,{className:"font-medium text-sm",children:s.key_name}),e.jsxs(u,{className:"font-mono text-xs",children:[s.api_key.substring(0,12),"****"]}),e.jsx(u,{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(u,{children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>x.mutate(s.id),disabled:x.isPending,"aria-label":"Revoke",children:e.jsx(z,{className:"h-4 w-4 text-destructive"})})})]},s.id))})]})})]})]})}function ie(){const{data:a,isLoading:w}=X(),n=ee(),[x,d]=i.useState(""),[c,l]=i.useState(""),[o,j]=i.useState(""),[s,b]=i.useState(!1);i.useState(()=>{a!=null&&a.name&&d(a.name)});const t=async r=>{var v,P;if(r.preventDefault(),c&&c!==o){N({title:"Error",description:"Passwords do not match.",variant:"destructive"});return}b(!0);try{await n.mutateAsync({name:x||void 0,password:c||void 0,password_confirmation:o||void 0}),N({title:"Success",description:"Profile updated successfully."}),l(""),j("")}catch(H){N({title:"Error",description:((P=(v=H.response)==null?void 0:v.data)==null?void 0:P.message)||"Failed to update profile.",variant:"destructive"})}finally{b(!1)}};return w?e.jsx(f,{children:e.jsxs(y,{className:"pt-6 space-y-4",children:[e.jsx(g,{className:"h-10 w-full"}),e.jsx(g,{className:"h-10 w-full"}),e.jsx(g,{className:"h-10 w-24"})]})}):e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(f,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"Account Details"})}),e.jsx(y,{children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Email Address"}),e.jsx(p,{value:a==null?void 0:a.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Email cannot be changed manually. Contact support for assistance."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Display Name"}),e.jsx(p,{value:x||(a==null?void 0:a.name)||"",onChange:r=>d(r.target.value),placeholder:"Full Name"})]}),e.jsx("hr",{className:"my-6 border-border"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(C,{children:"Change Password"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"password",placeholder:"New Password",value:c,onChange:r=>l(r.target.value)}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center",children:"Minimum 8 characters"})]}),e.jsx(p,{type:"password",placeholder:"Confirm New Password",value:o,onChange:r=>j(r.target.value)})]})]}),e.jsx(m,{type:"submit",disabled:s,children:s?"Saving...":"Save Changes"})]})})]}),e.jsxs(f,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"Danger Zone"})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Delete Account"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permanently delete your account and all associated data."})]}),e.jsx(m,{variant:"destructive",size:"sm",children:"Delete Account"})]})})]})]})}export{Ce as default};
