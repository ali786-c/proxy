import{j as e,x,y as W,J as X,z as Z,A as ee,E as se,H as ae,K as te}from"./ui-CeaNA1b8.js";import{w as k,al as R,r as t,aw as P,aC as B,aD as H,am as le}from"./vendor-CSZBJNtL.js";import{S as ie}from"./SEOHead-CNdL5gGP.js";import{E as re}from"./ErrorBanner-6851Kifd.js";import{E as Q}from"./EmptyState-DwcTWrzq.js";import{j as z,k as U,I as j,t as d,B as T,c as p}from"./index-un0RGWJf.js";import{L as w}from"./label-5YbheAOU.js";import{C as I,a as F,b as $,c as _}from"./card-clxFFivi.js";import{T as G,a as O,b as S,c as i,d as J,e as r}from"./table-D3uMK-0w.js";import{T as ne,a as ce,b as D,c as L}from"./tabs-DZHU84ea.js";function fe(){return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Settings",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"}),e.jsxs(ne,{defaultValue:"allowlist",children:[e.jsxs(ce,{children:[e.jsxs(D,{value:"allowlist",children:[e.jsx(k,{className:"mr-1 h-3.5 w-3.5"})," IP Allowlist"]}),e.jsxs(D,{value:"api-keys",children:[e.jsx(R,{className:"mr-1 h-3.5 w-3.5"})," API Keys"]})]}),e.jsx(L,{value:"allowlist",className:"mt-4",children:e.jsx(de,{})}),e.jsx(L,{value:"api-keys",className:"mt-4",children:e.jsx(xe,{})})]})]})]})}function de(){const y=z(),{data:n,isLoading:A}=U({queryKey:["allowlist"],queryFn:()=>p.getAllowlist()}),[m,f]=t.useState(""),[K,g]=t.useState(""),[o,c]=t.useState(null),[u,v]=t.useState(!1),N=async()=>{c(null);const a=m.trim();if(!a){c("IP address is required.");return}if(!/^\d{1,3}(\.\d{1,3}){3}(\/\d{1,2})?$/.test(a)){c("Enter a valid IPv4 address or CIDR range.");return}v(!0);try{await p.addAllowlistEntry(a,K.trim()||void 0),y.invalidateQueries({queryKey:["allowlist"]}),f(""),g(""),d({title:"IP Added",description:`${a} added to allowlist.`})}catch(h){c(h.message)}finally{v(!0)}},C=async a=>{try{await p.removeAllowlistEntry(a),y.invalidateQueries({queryKey:["allowlist"]}),d({title:"Removed",description:"IP removed from allowlist."})}catch(h){d({title:"Error",description:h.message,variant:"destructive"})}};return e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{className:"text-lg",children:"IP Allowlist"})}),e.jsxs(_,{className:"space-y-4",children:[o&&e.jsx(re,{message:o,onDismiss:()=>c(null)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{placeholder:"203.0.113.0/24",value:m,onChange:a=>f(a.target.value),className:"max-w-xs"}),e.jsx(j,{placeholder:"Label (optional)",value:K,onChange:a=>g(a.target.value),className:"max-w-xs"}),e.jsxs(x,{onClick:N,disabled:u,children:[u?e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(B,{className:"mr-1 h-4 w-4"}),"Add"]})]}),A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(n==null?void 0:n.length)===0?e.jsx(Q,{icon:k,title:"No IPs allowlisted",description:"Add your server IPs to authenticate without credentials."}):e.jsxs(G,{children:[e.jsx(O,{children:e.jsxs(S,{children:[e.jsx(i,{children:"IP Address"}),e.jsx(i,{children:"Label"}),e.jsx(i,{children:"Added"}),e.jsx(i,{className:"w-12"})]})}),e.jsx(J,{children:(n||[]).map(a=>e.jsxs(S,{children:[e.jsx(r,{className:"font-mono text-sm",children:a.ip}),e.jsx(r,{className:"text-sm text-muted-foreground",children:a.label??"—"}),e.jsx(r,{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),e.jsx(r,{children:e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>C(a.id),"aria-label":"Remove",children:e.jsx(H,{className:"h-4 w-4 text-destructive"})})})]},a.id))})]})]})]})}const oe=["proxy:generate","usage:read","allowlist:manage","keys:manage"];function xe(){const y=z(),{data:n,isLoading:A}=U({queryKey:["api-keys"],queryFn:()=>p.getApiKeys()}),[m,f]=t.useState(null),[K,g]=t.useState(!1),[o,c]=t.useState(""),[u,v]=t.useState(""),[N,C]=t.useState(""),[a,h]=t.useState(""),[E,q]=t.useState(["proxy:generate"]),V=s=>{q(l=>l.includes(s)?l.filter(b=>b!==s):[...l,s])},Y=async()=>{if(o.trim()){g(!0);try{const s=await p.createApiKey({name:o.trim(),allowed_countries:u?u.split(",").map(l=>l.trim().toUpperCase()):[],daily_gb_cap:N?Number(N):void 0,daily_request_cap:a?Number(a):void 0,allowed_scopes:E});y.invalidateQueries({queryKey:["api-keys"]}),f(s.key),c(""),v(""),C(""),h(""),q(["proxy:generate"]),d({title:"API Key Created",description:"Copy it now — it won't be shown again."})}catch(s){d({title:"Error",description:s.message,variant:"destructive"})}finally{g(!1)}}},M=async s=>{try{await p.revokeApiKey(s),y.invalidateQueries({queryKey:["api-keys"]}),d({title:"Revoked",description:"API key has been revoked."})}catch(l){d({title:"Error",description:l.message,variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4",children:[m&&e.jsx(I,{className:"border-primary",children:e.jsxs(_,{className:"flex items-center justify-between gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Your new API key (copy now — shown once):"}),e.jsx("code",{className:"mt-1 block text-xs font-mono text-primary",children:m})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(m),d({title:"Copied"})},children:[e.jsx(le,{className:"mr-1 h-3.5 w-3.5"})," Copy"]})]})}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between",children:[e.jsx($,{className:"text-lg",children:"API Keys"}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(x,{size:"sm",children:[e.jsx(B,{className:"mr-1 h-4 w-4"})," Create Key"]})}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Create API Key"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Key Name"}),e.jsx(j,{value:o,onChange:s=>c(s.target.value),placeholder:"Production"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Allowed Countries (comma-separated, optional)"}),e.jsx(j,{value:u,onChange:s=>v(s.target.value),placeholder:"US, UK, DE"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Daily GB Cap"}),e.jsx(j,{type:"number",value:N,onChange:s=>C(s.target.value),placeholder:"No limit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Daily Request Cap"}),e.jsx(j,{type:"number",value:a,onChange:s=>h(s.target.value),placeholder:"No limit"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Scopes"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map(s=>e.jsx(T,{variant:E.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>V(s),children:s},s))})]})]}),e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsx(x,{variant:"outline",children:"Cancel"})}),e.jsx(x,{onClick:Y,disabled:!o.trim(),children:"Create"})]})]})]})]}),e.jsx(_,{className:"p-0",children:A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(n==null?void 0:n.length)===0?e.jsx("div",{className:"p-6",children:e.jsx(Q,{icon:R,title:"No API keys",description:"Create a key to access the UpgradedProxy API programmatically."})}):e.jsxs(G,{children:[e.jsx(O,{children:e.jsxs(S,{children:[e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Key"}),e.jsx(i,{children:"Scopes"}),e.jsx(i,{children:"Limits"}),e.jsx(i,{children:"Last Used"}),e.jsx(i,{className:"w-12"})]})}),e.jsx(J,{children:(n||[]).map(s=>{var l;return e.jsxs(S,{children:[e.jsx(r,{className:"font-medium text-sm",children:s.name}),e.jsx(r,{className:"font-mono text-xs",children:s.key_prefix}),e.jsx(r,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(l=s.allowed_scopes)==null?void 0:l.map(b=>e.jsx(T,{variant:"secondary",className:"text-[10px]",children:b},b))})}),e.jsxs(r,{className:"text-xs text-muted-foreground",children:[s.daily_gb_cap?`${s.daily_gb_cap} GB/d`:"—",s.daily_request_cap?` / ${s.daily_request_cap.toLocaleString()} req/d`:""]}),e.jsx(r,{className:"text-xs text-muted-foreground",children:s.last_used_at?new Date(s.last_used_at).toLocaleDateString():"Never"}),e.jsx(r,{children:e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>M(s.id),"aria-label":"Revoke",children:e.jsx(H,{className:"h-4 w-4 text-destructive"})})})]},s.id)})})]})})]})]})}export{fe as default};
