import{c as D,r as f,j as e,_ as Q,I as _,aK as J,aL as V,aM as G,aN as W,aO as X,D as Y,aP as Z,a as y,S as ee,t as x,V as P,U as se,ae as u,ah as K,af as ae,o as R,aj as w,s as m,ag as q}from"./index-CcDiZfit.js";import{S as te}from"./SEOHead-B4f5Sefz.js";import{C as g,c as b}from"./card-DN0qsfCY.js";import{B as F}from"./badge-CzJPljEI.js";import{L as M}from"./label-DK_BhmV_.js";import{T as ne,a as re,b as S,c as h,d as le,e as o}from"./table-Br2AV7tZ.js";import{u as de}from"./useMutation-DlIq6RiF.js";import{S as ie}from"./search-BM2cUVAk.js";import{K as ce}from"./key-bQtuoFXj.js";import{T as oe}from"./ticket-DKHoenDP.js";import{P as me}from"./plus-DnD0gHS2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=D("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=D("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]),E=R({id:w(),name:m().nullable(),email:m(),role:m(),balance:w().or(m()),created_at:m()});function he(){return P({queryKey:["admin-users"],queryFn:async()=>(await u.get("/admin/users",K(E))).map(i=>({...i,full_name:i.name,user_id:i.id,is_banned:i.role==="banned",user_roles:[{role:i.role}]}))})}function je(){const r=se();return de({mutationFn:async i=>{const{action:n,...d}=i;if(n==="list_users")return u.get("/admin/users",K(E));if(n==="ban_user"||n==="unban_user")return u.post("/admin/users/ban",ae,{user_id:d.user_id,reason:d.ban_reason||(n==="ban_user"?"Banned by admin":"Unbanned by admin")});if(n==="adjust_balance")return u.post("/admin/users/balance",R({message:m(),new_balance:w()}),{user_id:d.user_id,amount:d.amount,reason:d.reason||"Admin adjustment"});if(n==="get_user_stats")return u.get("/admin/stats",q());throw new Error("Action not supported in Laravel bridge")},onSuccess:()=>r.invalidateQueries({queryKey:["admin-users"]})})}function pe(r){return P({queryKey:["admin-user-stats",r],enabled:!!r,queryFn:async()=>u.get(`/admin/users/${r}/stats`,q())})}function Ue(){var B,T,k;const{data:r,isLoading:i}=he(),n=je(),[d,O]=f.useState(""),[a,j]=f.useState(null),[p,N]=f.useState(""),[C,v]=f.useState(""),{data:c}=pe((a==null?void 0:a.user_id)??null);if(i)return e.jsx(Q,{});const A=(r??[]).filter(s=>{var t,l;return!(d&&!((t=s.email)!=null&&t.toLowerCase().includes(d.toLowerCase()))&&!((l=s.full_name)!=null&&l.toLowerCase().includes(d.toLowerCase())))}),$=async(s,t)=>{try{await n.mutateAsync({action:t?"unban_user":"ban_user",user_id:s,ban_reason:t?void 0:"Violated terms of service"}),j(null),x({title:t?"User unbanned":"User banned"})}catch(l){x({title:"Error",description:l.message,variant:"destructive"})}},U=async s=>{const t=parseFloat(p);if(!t||t<=0){x({title:"Invalid amount",variant:"destructive"});return}try{const l=await n.mutateAsync({action:"adjust_balance",user_id:a.user_id,amount:s?t:-t,reason:C||(s?"Admin top-up":"Admin deduction")});N(""),v(""),j(L=>L?{...L,balance:l.new_balance}:null),x({title:`Balance ${s?"topped up":"deducted"} successfully`})}catch(l){x({title:"Error",description:l.message,variant:"destructive"})}},z=(r??[]).length,H=(r??[]).filter(s=>s.is_banned).length,I=(r??[]).reduce((s,t)=>s+Number(t.balance??0),0);return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Admin — Users",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all registered users, balances, and access."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:z})]})}),e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Banned Users"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:H})]})}),e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total User Balances"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",I.toFixed(2)]})]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(_,{placeholder:"Search by name or email…",value:d,onChange:s=>O(s.target.value),className:"pl-9"})]})}),e.jsx(g,{children:e.jsx(b,{className:"p-0",children:e.jsxs(ne,{children:[e.jsx(re,{children:e.jsxs(S,{children:[e.jsx(h,{children:"User"}),e.jsx(h,{children:"Role"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Balance"}),e.jsx(h,{children:"Joined"})]})}),e.jsxs(le,{children:[A.map(s=>{var t,l;return e.jsxs(S,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>j(s),children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(o,{className:"capitalize",children:((l=(t=s.user_roles)==null?void 0:t[0])==null?void 0:l.role)??"client"}),e.jsx(o,{children:e.jsx(F,{variant:s.is_banned?"destructive":"default",children:s.is_banned?"Banned":"Active"})}),e.jsxs(o,{children:["$",Number(s.balance??0).toFixed(2)]}),e.jsx(o,{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()})]},s.id)}),A.length===0&&e.jsx(S,{children:e.jsx(o,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No users found."})})]})]})})})]}),e.jsx(J,{open:!!a,onOpenChange:()=>{j(null),N(""),v("")},children:e.jsx(V,{className:"sm:max-w-lg overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(W,{children:a.full_name||"User"}),e.jsx(X,{children:a.email})]}),e.jsxs("div",{className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:((T=(B=a.user_roles)==null?void 0:B[0])==null?void 0:T.role)??"client"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx(F,{variant:a.is_banned?"destructive":"default",children:a.is_banned?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:"font-medium text-lg",children:["$",Number(a.balance??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString()})]})]}),c&&e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"User Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"font-medium",children:["€",((k=c.total_spent)==null?void 0:k.toFixed(2))??"0.00"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsxs("p",{className:"font-medium",children:[c.active_orders??0," active / ",c.total_orders??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"API Keys"}),e.jsxs("p",{className:"font-medium",children:[c.active_keys??0," active / ",c.total_keys??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tickets"}),e.jsxs("p",{className:"font-medium",children:[c.open_tickets??0," open / ",c.total_tickets??0," total"]})]})]})]})]}),a.ban_reason&&e.jsxs("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx("strong",{children:"Ban reason:"})," ",a.ban_reason]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Adjust Balance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(_,{id:"amount",type:"number",min:"0.01",step:"0.01",placeholder:"e.g. 50.00",value:p,onChange:s=>N(s.target.value)}),e.jsx(M,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(_,{id:"reason",placeholder:"e.g. Manual credit for support case",value:C,onChange:s=>v(s.target.value)}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(y,{size:"sm",onClick:()=>U(!0),disabled:n.isPending||!p,className:"flex-1",children:[e.jsx(me,{className:"mr-1 h-4 w-4"})," Top Up"]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>U(!1),disabled:n.isPending||!p,className:"flex-1",children:[e.jsx(ue,{className:"mr-1 h-4 w-4"})," Deduct"]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Access Control"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(y,{variant:a.is_banned?"default":"destructive",size:"sm",onClick:()=>$(a.user_id,a.is_banned),disabled:n.isPending,children:[a.is_banned?e.jsx(ee,{className:"mr-2 h-4 w-4"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),a.is_banned?"Unban User":"Ban User"]})})]})]})]})})})]})}export{Ue as default};
