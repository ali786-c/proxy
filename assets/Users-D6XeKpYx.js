import{j as e,x as _}from"./ui-BvSIVwgG.js";import{r as f,ae as O,I,E as J,al as V,aN as W,aC as X,aQ as Y,w as G,aR as Z}from"./vendor-co0Zkaum.js";import{S as ee}from"./SEOHead-DYU_qHlr.js";import{C as g,c as b}from"./card-0KzbiLUl.js";import{L as se,I as y,B as L,T as ae,V as te,W as ne,X as re,Y as le,t as x,k as D,j as de,v as u,x as E,M as ie,o as q,Q as w,s as m,w as M}from"./index-Do4Gql9_.js";import{L as R}from"./label-D7lsv8RO.js";import{T as ce,a as oe,b as S,c as h,d as me,e as o}from"./table-gVuxc4b7.js";import{u as ue}from"./useMutation-CurcCUL0.js";const P=q({id:w(),name:m().nullable(),email:m(),role:m(),balance:w().or(m()),created_at:m()});function xe(){return D({queryKey:["admin-users"],queryFn:async()=>(await u.get("/admin/users",E(P))).map(i=>({...i,full_name:i.name,user_id:i.id,is_banned:i.role==="banned",user_roles:[{role:i.role}]}))})}function he(){const r=de();return ue({mutationFn:async i=>{const{action:n,...d}=i;if(n==="list_users")return u.get("/admin/users",E(P));if(n==="ban_user"||n==="unban_user")return u.post("/admin/users/ban",ie,{user_id:d.user_id,reason:d.ban_reason||(n==="ban_user"?"Banned by admin":"Unbanned by admin")});if(n==="adjust_balance")return u.post("/admin/users/balance",q({message:m(),new_balance:w()}),{user_id:d.user_id,amount:d.amount,reason:d.reason||"Admin adjustment"});if(n==="get_user_stats")return u.get("/admin/stats",M());throw new Error("Action not supported in Laravel bridge")},onSuccess:()=>r.invalidateQueries({queryKey:["admin-users"]})})}function je(r){return D({queryKey:["admin-user-stats",r],enabled:!!r,queryFn:async()=>u.get(`/admin/users/${r}/stats`,M())})}function Se(){var T,U,k;const{data:r,isLoading:i}=xe(),n=he(),[d,$]=f.useState(""),[a,j]=f.useState(null),[p,N]=f.useState(""),[C,v]=f.useState(""),{data:c}=je((a==null?void 0:a.user_id)??null);if(i)return e.jsx(se,{});const A=(r??[]).filter(s=>{var t,l;return!(d&&!((t=s.email)!=null&&t.toLowerCase().includes(d.toLowerCase()))&&!((l=s.full_name)!=null&&l.toLowerCase().includes(d.toLowerCase())))}),z=async(s,t)=>{try{await n.mutateAsync({action:t?"unban_user":"ban_user",user_id:s,ban_reason:t?void 0:"Violated terms of service"}),j(null),x({title:t?"User unbanned":"User banned"})}catch(l){x({title:"Error",description:l.message,variant:"destructive"})}},B=async s=>{const t=parseFloat(p);if(!t||t<=0){x({title:"Invalid amount",variant:"destructive"});return}try{const l=await n.mutateAsync({action:"adjust_balance",user_id:a.user_id,amount:s?t:-t,reason:C||(s?"Admin top-up":"Admin deduction")});N(""),v(""),j(F=>F?{...F,balance:l.new_balance}:null),x({title:`Balance ${s?"topped up":"deducted"} successfully`})}catch(l){x({title:"Error",description:l.message,variant:"destructive"})}},K=(r??[]).length,Q=(r??[]).filter(s=>s.is_banned).length,H=(r??[]).reduce((s,t)=>s+Number(t.balance??0),0);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Admin — Users",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all registered users, balances, and access."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})}),e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Banned Users"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:Q})]})}),e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total User Balances"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",H.toFixed(2)]})]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(O,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(y,{placeholder:"Search by name or email…",value:d,onChange:s=>$(s.target.value),className:"pl-9"})]})}),e.jsx(g,{children:e.jsx(b,{className:"p-0",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(S,{children:[e.jsx(h,{children:"User"}),e.jsx(h,{children:"Role"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Balance"}),e.jsx(h,{children:"Joined"})]})}),e.jsxs(me,{children:[A.map(s=>{var t,l;return e.jsxs(S,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>j(s),children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(o,{className:"capitalize",children:((l=(t=s.user_roles)==null?void 0:t[0])==null?void 0:l.role)??"client"}),e.jsx(o,{children:e.jsx(L,{variant:s.is_banned?"destructive":"default",children:s.is_banned?"Banned":"Active"})}),e.jsxs(o,{children:["$",Number(s.balance??0).toFixed(2)]}),e.jsx(o,{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()})]},s.id)}),A.length===0&&e.jsx(S,{children:e.jsx(o,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No users found."})})]})]})})})]}),e.jsx(ae,{open:!!a,onOpenChange:()=>{j(null),N(""),v("")},children:e.jsx(te,{className:"sm:max-w-lg overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{children:[e.jsx(re,{children:a.full_name||"User"}),e.jsx(le,{children:a.email})]}),e.jsxs("div",{className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:((U=(T=a.user_roles)==null?void 0:T[0])==null?void 0:U.role)??"client"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx(L,{variant:a.is_banned?"destructive":"default",children:a.is_banned?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:"font-medium text-lg",children:["$",Number(a.balance??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString()})]})]}),c&&e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"User Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"font-medium",children:["€",((k=c.total_spent)==null?void 0:k.toFixed(2))??"0.00"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsxs("p",{className:"font-medium",children:[c.active_orders??0," active / ",c.total_orders??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"API Keys"}),e.jsxs("p",{className:"font-medium",children:[c.active_keys??0," active / ",c.total_keys??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tickets"}),e.jsxs("p",{className:"font-medium",children:[c.open_tickets??0," open / ",c.total_tickets??0," total"]})]})]})]})]}),a.ban_reason&&e.jsxs("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx("strong",{children:"Ban reason:"})," ",a.ban_reason]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Adjust Balance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(y,{id:"amount",type:"number",min:"0.01",step:"0.01",placeholder:"e.g. 50.00",value:p,onChange:s=>N(s.target.value)}),e.jsx(R,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(y,{id:"reason",placeholder:"e.g. Manual credit for support case",value:C,onChange:s=>v(s.target.value)}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(_,{size:"sm",onClick:()=>B(!0),disabled:n.isPending||!p,className:"flex-1",children:[e.jsx(X,{className:"mr-1 h-4 w-4"})," Top Up"]}),e.jsxs(_,{size:"sm",variant:"destructive",onClick:()=>B(!1),disabled:n.isPending||!p,className:"flex-1",children:[e.jsx(Y,{className:"mr-1 h-4 w-4"})," Deduct"]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Access Control"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(_,{variant:a.is_banned?"default":"destructive",size:"sm",onClick:()=>z(a.user_id,a.is_banned),disabled:n.isPending,children:[a.is_banned?e.jsx(G,{className:"mr-2 h-4 w-4"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),a.is_banned?"Unban User":"Ban User"]})})]})]})]})})})]})}export{Se as default};
