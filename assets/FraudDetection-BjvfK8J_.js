import{r as j,j as e,aT as n}from"./index-C-hQHNw1.js";import{s as u,t as b,v as g,w as T}from"./use-backend-C7XQrfOz.js";import{f as t}from"./format-sbWH3_uq.js";import"./useMutation-DR2AoCow.js";import"./dashboard-DCiUPAM5.js";const i={low:"bg-blue-500/10 text-blue-500",medium:"bg-yellow-500/10 text-yellow-500",high:"bg-orange-500/10 text-orange-500",critical:"bg-destructive/10 text-destructive"},v={login_anomaly:"Login Anomaly",usage_spike:"Usage Spike",impossible_travel:"Impossible Travel",rapid_auth:"Rapid Auth Attempts"};function R(){const[r,c]=j.useState("unresolved"),{data:l,isLoading:C}=u(r==="all"?void 0:r==="resolved"),{data:a,isLoading:p}=b(),{data:d,isLoading:f}=g(),o=T(),x=async s=>{try{await o.mutateAsync(s),n.success("Signal resolved successfully")}catch{n.error("Failed to resolve signal")}},h=(l==null?void 0:l.filter(s=>s.severity==="critical"&&!s.is_resolved).length)??0,m=(a==null?void 0:a.filter(s=>s.risk_score>=70).length)??0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ShieldAlert,{className:"h-6 w-6"})," Fraud Detection"]}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor login anomalies, usage abuse, and risk scores"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(Card,{children:[e.jsx(CardHeader,{className:"pb-2",children:e.jsx(CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Active Signals"})}),e.jsx(CardContent,{children:e.jsx("div",{className:"text-2xl font-bold",children:(l==null?void 0:l.filter(s=>!s.is_resolved).length)??0})})]}),e.jsxs(Card,{children:[e.jsx(CardHeader,{className:"pb-2",children:e.jsx(CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Critical Alerts"})}),e.jsx(CardContent,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:h})})]}),e.jsxs(Card,{children:[e.jsx(CardHeader,{className:"pb-2",children:e.jsx(CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"High-Risk Users"})}),e.jsx(CardContent,{children:e.jsx("div",{className:"text-2xl font-bold text-warning",children:m})})]}),e.jsxs(Card,{children:[e.jsx(CardHeader,{className:"pb-2",children:e.jsx(CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Login Events (24h)"})}),e.jsx(CardContent,{children:e.jsx("div",{className:"text-2xl font-bold",children:(d==null?void 0:d.length)??0})})]})]}),e.jsxs(Tabs,{defaultValue:"signals",children:[e.jsxs(TabsList,{children:[e.jsx(TabsTrigger,{value:"signals",children:"Fraud Signals"}),e.jsx(TabsTrigger,{value:"risk",children:"Risk Scores"}),e.jsx(TabsTrigger,{value:"logins",children:"Login History"})]}),e.jsxs(TabsContent,{value:"signals",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Select,{value:r,onValueChange:c,children:[e.jsx(SelectTrigger,{className:"w-[180px]",children:e.jsx(SelectValue,{})}),e.jsxs(SelectContent,{children:[e.jsx(SelectItem,{value:"all",children:"All Signals"}),e.jsx(SelectItem,{value:"unresolved",children:"Unresolved"}),e.jsx(SelectItem,{value:"resolved",children:"Resolved"})]})]})}),e.jsx(Card,{children:e.jsx(CardContent,{className:"pt-6",children:e.jsxs(Table,{children:[e.jsx(TableHeader,{children:e.jsxs(TableRow,{children:[e.jsx(TableHead,{children:"Type"}),e.jsx(TableHead,{children:"Severity"}),e.jsx(TableHead,{children:"Description"}),e.jsx(TableHead,{children:"Location"}),e.jsx(TableHead,{children:"IP"}),e.jsx(TableHead,{children:"Time"}),e.jsx(TableHead,{children:"Actions"})]})}),e.jsxs(TableBody,{children:[l==null?void 0:l.map(s=>e.jsxs(TableRow,{children:[e.jsx(TableCell,{children:e.jsx(Badge,{variant:"outline",children:v[s.signal_type]??s.signal_type})}),e.jsx(TableCell,{children:e.jsx("span",{className:`rounded px-2 py-0.5 text-xs font-semibold ${i[s.severity]??""}`,children:s.severity})}),e.jsxs(TableCell,{className:"max-w-[200px] truncate",children:[s.description,s.user&&e.jsxs("div",{className:"text-[10px] text-muted-foreground mt-0.5",children:["User: ",s.user.name||s.user.email]})]}),e.jsx(TableCell,{children:s.geo_city?`${s.geo_city}, ${s.geo_country}`:s.geo_country??"—"}),e.jsx(TableCell,{className:"font-mono text-xs",children:s.ip_address??"—"}),e.jsx(TableCell,{className:"text-xs",children:t(new Date(s.created_at),"MMM d, HH:mm")}),e.jsx(TableCell,{children:s.is_resolved?e.jsx(Badge,{variant:"secondary",children:"Resolved"}):e.jsxs(Button,{size:"sm",variant:"outline",onClick:()=>x(s.id),children:[e.jsx(CheckCircle,{className:"mr-1 h-3 w-3"})," Resolve"]})})]},s.id)),!(l!=null&&l.length)&&e.jsx(TableRow,{children:e.jsx(TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No fraud signals detected"})})]})]})})})]}),e.jsx(TabsContent,{value:"risk",children:e.jsx(Card,{children:e.jsx(CardContent,{className:"pt-6",children:e.jsxs(Table,{children:[e.jsx(TableHeader,{children:e.jsxs(TableRow,{children:[e.jsx(TableHead,{children:"User ID"}),e.jsx(TableHead,{children:"Risk Score"}),e.jsx(TableHead,{children:"Level"}),e.jsx(TableHead,{children:"Factors"}),e.jsx(TableHead,{children:"Last Calculated"})]})}),e.jsxs(TableBody,{children:[a==null?void 0:a.map(s=>e.jsxs(TableRow,{children:[e.jsx(TableCell,{className:"font-mono text-xs",children:s.user?s.user.name||s.user.email:s.user_id}),e.jsx(TableCell,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-16 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.risk_score>=70?"bg-destructive":s.risk_score>=40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${s.risk_score}%`}})}),e.jsx("span",{className:"text-sm font-semibold",children:s.risk_score})]})}),e.jsx(TableCell,{children:e.jsx("span",{className:`rounded px-2 py-0.5 text-xs font-semibold ${i[s.risk_level]??""}`,children:s.risk_level})}),e.jsx(TableCell,{className:"text-xs",children:Array.isArray(s.factors)?s.factors.join(", "):"—"}),e.jsx(TableCell,{className:"text-xs",children:t(new Date(s.last_calculated_at),"MMM d, HH:mm")})]},s.id)),!(a!=null&&a.length)&&e.jsx(TableRow,{children:e.jsx(TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No risk scores calculated yet"})})]})]})})})}),e.jsx(TabsContent,{value:"logins",children:e.jsx(Card,{children:e.jsx(CardContent,{className:"pt-6",children:e.jsxs(Table,{children:[e.jsx(TableHeader,{children:e.jsxs(TableRow,{children:[e.jsx(TableHead,{children:"User"}),e.jsx(TableHead,{children:"Status"}),e.jsx(TableHead,{children:"IP"}),e.jsx(TableHead,{children:"Location"}),e.jsx(TableHead,{children:"User Agent"}),e.jsx(TableHead,{children:"Time"})]})}),e.jsxs(TableBody,{children:[d==null?void 0:d.map(s=>e.jsxs(TableRow,{children:[e.jsx(TableCell,{className:"font-mono text-xs",children:s.user?s.user.name||s.user.email:s.user_id}),e.jsx(TableCell,{children:e.jsx(Badge,{variant:s.success?"default":"destructive",children:s.success?"Success":"Failed"})}),e.jsx(TableCell,{className:"font-mono text-xs",children:s.ip_address??"—"}),e.jsx(TableCell,{children:s.geo_city?`${s.geo_city}, ${s.geo_country}`:s.geo_country??"—"}),e.jsx(TableCell,{className:"max-w-[150px] truncate text-xs",children:s.user_agent??"—"}),e.jsx(TableCell,{className:"text-xs",children:t(new Date(s.created_at),"MMM d, HH:mm")})]},s.id)),!(d!=null&&d.length)&&e.jsx(TableRow,{children:e.jsx(TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No login events recorded"})})]})]})})})})]})]})}export{R as default};
