import{j as e,x as n}from"./ui-BpDXiumg.js";import{r as o,aE as J,a3 as X,K as M,W as Z,aA as F,ay as ee,aw as se,a5 as te,d as ae,V as re}from"./vendor-CXoGxISd.js";import{S as ie}from"./SEOHead-CruxSZC3.js";import{C as p,a as j,b as y,d as le,c as f}from"./card-NvV88nEZ.js";import{T as ce,a as ne,b as U,c as g,d as oe,e as N}from"./table-N-EE5-8s.js";import{b as de,j as _,I as v,t as r,B as S,k as me,c as d}from"./index-JwncgfEP.js";import{L as b}from"./label-BO-7FaBh.js";import{S as ue}from"./switch-BWknNSRF.js";const xe=.22,m=5,he={paid:"default",pending:"secondary",failed:"destructive"};function we(){const[T]=o.useState("residential"),{gateways:u,autoTopUpEnabled:D}=de(),[P,k]=o.useState(!1),[I,L]=o.useState("50"),[R,V]=o.useState("5"),[i,$]=o.useState(null),[w,E]=o.useState("10"),[H,q]=o.useState(""),[x,l]=o.useState(!1),{data:O}=_({queryKey:["plans"],queryFn:()=>d.getPlans()}),{data:z}=_({queryKey:["invoices"],queryFn:()=>d.getInvoices()}),c=parseFloat(w)||0,h=i==="cryptomus",B=h?0:c*xe,C=c+B,A=c<m,G=s=>{r({title:"Product Selected",description:`Switching to ${s}.`})},K=async s=>{if(k(s),s)try{const{client_secret:t}=await d.createSetupIntent();r({title:"Card setup started",description:"Please follow the instructions to save your card for auto top-up."})}catch(t){r({title:"Setup Error",description:t.message,variant:"destructive"}),k(!1)}},W=async()=>{if(A){r({title:"Minimum not met",description:`Minimum purchase is €${m}.`,variant:"destructive"});return}if(!i){r({title:"Select a payment method",description:"Please choose how you'd like to pay.",variant:"destructive"});return}if(i==="cryptomus"){l(!0);try{const{url:s}=await d.createCryptomusCheckout(c);window.location.href=s}catch(s){r({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{l(!1)}}else if(i==="stripe"){l(!0);try{const{url:s}=await d.createCheckout(T,c);window.location.href=s}catch(s){r({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{l(!1)}}else r({title:`Pay with ${i}`,description:`Redirecting to ${i} checkout for €${C.toFixed(2)}...`})},Q=[{id:"stripe",name:"Card (Stripe)",subtitle:"Credit/Debit Card",icon:M,vatLabel:"+22% VAT"},{id:"paypal",name:"PayPal",subtitle:"PayPal Balance",icon:Z,vatLabel:"+22% VAT"},{id:"cryptomus",name:"Crypto",subtitle:"Automated via Cryptomus",icon:F,vatLabel:"No VAT"}],Y=u.stripe||u.paypal||u.cryptomus;return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Account & Billing",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Account & Billing"}),e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(J,{className:"h-5 w-5"})," Add Balance"]}),e.jsxs(le,{children:["Minimum purchase: €",m,". 22% VAT applies to card & PayPal payments. Crypto is VAT-free."]})]}),e.jsxs(f,{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 max-w-lg",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Amount (€)"}),e.jsx(v,{type:"number",value:w,onChange:s=>E(s.target.value),min:m,step:"1",placeholder:`Min €${m}`}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["10","25","50","100"].map(s=>e.jsxs(n,{variant:"outline",size:"sm",className:`text-xs h-7 px-3 ${w===s?"border-primary bg-primary/5 text-primary":""}`,onClick:()=>E(s),children:["€",s]},s))}),A&&c>0&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"})," Minimum purchase is €",m]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Promo Code (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{placeholder:"WELCOME20",value:H,onChange:s=>q(s.target.value)}),e.jsx(n,{variant:"outline",size:"sm",className:"shrink-0",onClick:()=>r({title:"Coupon Applied",description:"Discount applied to your balance."}),children:"Apply"})]})]})]}),!Y&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No payment methods are currently available. Please contact support."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:Q.map(s=>{const t=u[s.id],a=i===s.id;return e.jsxs(n,{variant:a?"default":"outline",className:`h-auto py-4 flex-col gap-1 relative ${t?"":"opacity-40 cursor-not-allowed"}`,disabled:!t,onClick:()=>$(s.id),children:[e.jsx(s.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-[11px] font-normal opacity-80",children:s.subtitle}),e.jsx(S,{variant:s.id==="crypto"?"default":"secondary",className:"text-[10px] mt-1",children:s.vatLabel}),!t&&e.jsx("span",{className:"text-[10px] font-normal",children:"Not available"})]},s.id)})}),i&&c>=m&&e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 max-w-sm space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["€",c.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["VAT (22%)",h&&e.jsx(ee,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("span",{className:h?"line-through text-muted-foreground":"",children:h?"€0.00 — exempt":`€${B.toFixed(2)}`})]}),e.jsx(me,{}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["€",C.toFixed(2)]})]}),e.jsxs(n,{className:"w-full mt-2",onClick:W,disabled:A||x,children:[x?e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Pay €",C.toFixed(2)]})]})]})]}),D&&e.jsxs(p,{children:[e.jsx(j,{children:e.jsxs(y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(te,{className:"h-5 w-5"})," Auto Top-Up"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically add balance when it drops below the threshold"})]}),e.jsx(ue,{checked:P,onCheckedChange:K})]}),P&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Min Balance Threshold (€)"}),e.jsx(v,{type:"number",value:R,onChange:s=>V(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(b,{children:"Top-Up Amount (€)"}),e.jsx(v,{type:"number",value:I,onChange:s=>L(s.target.value)})]})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:(O||[]).map(s=>{const t=s.id===T;return e.jsxs(p,{className:t?"border-primary ring-2 ring-primary/20":"",children:[e.jsx(j,{className:"pb-2",children:e.jsxs(y,{className:"flex items-center justify-between text-lg",children:[s.name,t&&e.jsx(S,{children:"Active"})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("p",{className:"text-3xl font-bold",children:["€",(s.price_cents/100).toFixed(2),e.jsxs("span",{className:"text-base font-normal text-muted-foreground",children:["/",(s.id==="datacenter","GB")]})]}),e.jsx("ul",{className:"space-y-1.5",children:s.features.map(a=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(ae,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),a]},a))}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{variant:t?"outline":"default",className:"w-full",disabled:t,onClick:()=>G(s.id),children:t?"Active Product":"Select Product"}),!t&&e.jsxs("div",{className:"flex flex-col gap-2",children:[u.stripe&&e.jsxs(n,{variant:"secondary",className:"w-full gap-2",disabled:x,onClick:async()=>{l(!0);try{const{url:a}=await d.createProductCheckout(s.id,1);window.location.href=a}catch(a){r({title:"Purchase Error",description:a.message,variant:"destructive"})}finally{l(!1)}},children:[e.jsx(M,{className:"h-4 w-4"})," Buy with Card"]}),u.cryptomus&&e.jsxs(n,{variant:"outline",className:"w-full gap-2 border-primary/20 hover:border-primary/50",disabled:x,onClick:async()=>{l(!0);try{const{url:a}=await d.createCryptomusProductCheckout(s.id,1);window.location.href=a}catch(a){r({title:"Purchase Error",description:a.message,variant:"destructive"})}finally{l(!1)}},children:[e.jsx(F,{className:"h-4 w-4 text-orange-500"})," Buy with Crypto"]})]})]})]})]},s.id)})}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(y,{className:"text-lg",children:"Recent Invoices"})}),e.jsx(f,{className:"p-0",children:e.jsxs(ce,{children:[e.jsx(ne,{children:e.jsxs(U,{children:[e.jsx(g,{children:"Period"}),e.jsx(g,{children:"Amount"}),e.jsx(g,{children:"Status"}),e.jsx(g,{className:"text-right",children:"Date"})]})}),e.jsx(oe,{children:(z||[]).map(s=>e.jsxs(U,{children:[e.jsx(N,{className:"font-medium",children:s.period}),e.jsxs(N,{children:["€",(s.amount_cents/100).toFixed(2)]}),e.jsx(N,{children:e.jsx(S,{variant:he[s.status]??"secondary",children:s.status})}),e.jsxs(N,{className:"text-right text-sm text-muted-foreground space-x-2",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.pdf_url&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"Download PDF",children:e.jsx("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(re,{className:"h-3.5 w-3.5"})})})]})]},s.id))})]})})]})]})]})}export{we as default};
