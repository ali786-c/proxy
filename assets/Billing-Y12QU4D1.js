import{j as e,x as d}from"./ui-A4Mg_2PO.js";import{r as l,K as q,W as ce,aA as M,aE as oe,a3 as de,aw as z,ay as ue,a5 as me,d as xe,V as he}from"./vendor-B1YgQW9R.js";import{S as pe}from"./SEOHead-BN_0WzU2.js";import{C as g,a as v,b as N,d as je,c as b}from"./card-CGPo2FAR.js";import{T as fe,a as ye,b as G,c as C,d as ge,e as w}from"./table-BKfF2Z1b.js";import{l as ve,b as Ne,d as be,k as K,I as A,B,m as Ce,c as x}from"./index-DrohO6Nn.js";import{L as S}from"./label-7BY5oMnS.js";import{S as we}from"./switch-BP4Fabla.js";import{M as Ae}from"./ManualCryptoDialog-CduajCFS.js";const Se=.22,u=5,Te={paid:"default",pending:"secondary",failed:"destructive"};function De(){const{toast:r}=ve(),{format:a}=Ne(),[$]=l.useState("residential"),[p,U]=l.useState("50"),{gateways:h,autoTopUpEnabled:W}=be(),[V,_]=l.useState(!1),[Y,Q]=l.useState("50"),[J,X]=l.useState("5"),[c,Z]=l.useState(null),[j,D]=l.useState(""),[f,m]=l.useState(!1),[ee,I]=l.useState(!1),[t,T]=l.useState(null),[L,R]=l.useState(!1),{data:se}=K({queryKey:["plans"],queryFn:()=>x.getPlans()}),{data:te}=K({queryKey:["invoices"],queryFn:()=>x.getInvoices()}),o=parseFloat(p)||0,P=t?t.discount:0,H=Math.max(0,o-P),y=c==="cryptomus"||c==="manual",F=y?0:H*Se,k=H+F,E=o<u,ae=async()=>{if(j.trim()){if(o<u){r({title:"Error",description:`Please enter an amount of at least ${a(u)} first.`,variant:"destructive"});return}R(!0);try{const s=await x.validateCoupon(j.toUpperCase(),o);s.valid&&(T({code:s.code,discount:s.discount,type:s.type,value:s.value}),r({title:"Coupon Applied",description:`You saved ${a(s.discount)}!`}))}catch(s){T(null),r({title:"Invalid Coupon",description:s.message||"This code is not valid.",variant:"destructive"})}finally{R(!1)}}},re=s=>{r({title:"Product Selected",description:`Switching to ${s}.`})},ne=async s=>{if(_(s),s)try{const{client_secret:n}=await x.createSetupIntent();r({title:"Card setup started",description:"Please follow the instructions to save your card for auto top-up."})}catch(n){r({title:"Setup Error",description:n.message,variant:"destructive"}),_(!1)}},ie=async()=>{if(E){r({title:"Minimum not met",description:`Minimum purchase is ${a(u)}.`,variant:"destructive"});return}if(!c){r({title:"Select a payment method",description:"Please choose how you'd like to pay.",variant:"destructive"});return}if(c==="cryptomus"){m(!0);try{const{url:s}=await x.createCryptomusCheckout(o,t==null?void 0:t.code);window.location.href=s}catch(s){r({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{m(!1)}}else if(c==="stripe"){m(!0);try{const{url:s}=await x.createCheckout($,o,t==null?void 0:t.code);window.location.href=s}catch(s){r({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{m(!1)}}else c==="manual"?I(!0):r({title:`Pay with ${c}`,description:`Redirecting to ${c} checkout for ${a(k)}...`})},O=[{id:"stripe",name:"Card (Stripe)",subtitle:"Credit/Debit Card",icon:q,vatLabel:"+22% VAT",enabled:h.stripe},{id:"paypal",name:"PayPal",subtitle:"PayPal Balance",icon:ce,vatLabel:"+22% VAT",enabled:h.paypal},{id:"cryptomus",name:"Crypto",subtitle:"Automated via Cryptomus",icon:M,vatLabel:"No VAT",enabled:h.cryptomus},{id:"manual",name:"Binance Pay",subtitle:"Manual Transfer",icon:M,vatLabel:"No VAT",enabled:h.crypto}],le=O.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(pe,{title:"Account & Billing",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Account & Billing"}),e.jsxs(g,{children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-lg",children:[e.jsx(oe,{className:"h-5 w-5"})," Add Balance"]}),e.jsxs(je,{children:["Minimum purchase: ",a(u),". 22% VAT applies to card & PayPal payments. Crypto is VAT-free."]})]}),e.jsxs(b,{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 max-w-lg",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(S,{children:"Amount"}),e.jsx(A,{type:"number",value:p,onChange:s=>U(s.target.value),min:u,step:"1",placeholder:`Min ${a(u)}`}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["10","25","50","100"].map(s=>e.jsx(d,{variant:"outline",size:"sm",className:`text-xs h-7 px-3 ${p===s?"border-primary bg-primary/5 text-primary":""}`,onClick:()=>U(s),children:a(Number(s))},s))}),E&&o>0&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"})," Minimum purchase is ",a(u)]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(S,{children:"Promo Code (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{placeholder:"WELCOME20",value:j,onChange:s=>D(s.target.value),className:t?"border-green-500 bg-green-500/5":"",disabled:!!t}),t?e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{T(null),D("")},children:"Remove"}):e.jsx(d,{variant:"outline",size:"sm",className:"shrink-0",onClick:ae,disabled:L||!j.trim(),children:L?e.jsx(z,{className:"h-4 w-4 animate-spin"}):"Apply"})]}),t&&e.jsxs("p",{className:"text-[11px] text-green-600 font-medium",children:[" Coupon applied: ",t.type==="percentage"?`${t.value}%`:`${a(t.value)}`," off"]})]})]}),!le&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No payment methods are currently available. Please contact support."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:O.map(s=>{const n=s.enabled,i=c===s.id;return e.jsxs(d,{variant:i?"default":"outline",className:`h-auto py-4 flex-col gap-1 relative ${n?"":"opacity-40 cursor-not-allowed"}`,disabled:!n,onClick:()=>Z(s.id),children:[e.jsx(s.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-[11px] font-normal opacity-80",children:s.subtitle}),e.jsx(B,{variant:s.id==="crypto"||s.id==="manual"?"default":"secondary",className:"text-[10px] mt-1",children:s.vatLabel}),!n&&e.jsx("span",{className:"text-[10px] font-normal",children:"Not available"})]},s.id)})}),c&&o>=u&&e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 max-w-sm space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:a(o)})]}),P>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 font-medium font-mono",children:[e.jsxs("span",{children:["Discount (",t==null?void 0:t.code,")"]}),e.jsxs("span",{children:["-",a(P)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["VAT (22%)",y&&e.jsx(ue,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("span",{className:y?"line-through text-muted-foreground":"",children:y?`${a(0)} â€” exempt`:`${a(F)}`})]}),e.jsx(Ce,{}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:a(k)})]}),e.jsxs(d,{className:"w-full mt-2",onClick:ie,disabled:E||f,children:[f?e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Pay ",a(k)]})]})]})]}),W&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(N,{className:"flex items-center gap-2 text-lg",children:[e.jsx(me,{className:"h-5 w-5"})," Auto Top-Up"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically add balance when it drops below the threshold"})]}),e.jsx(we,{checked:V,onCheckedChange:ne})]}),V&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(S,{children:"Min Balance Threshold"}),e.jsx(A,{type:"number",value:J,onChange:s=>X(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(S,{children:"Top-Up Amount"}),e.jsx(A,{type:"number",value:Y,onChange:s=>Q(s.target.value)})]})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:(se||[]).map(s=>{const n=s.id===$;return e.jsxs(g,{className:n?"border-primary ring-2 ring-primary/20":"",children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"flex items-center justify-between text-lg",children:[s.name,n&&e.jsx(B,{children:"Active"})]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("p",{className:"text-3xl font-bold",children:[a(s.price_cents/100),e.jsxs("span",{className:"text-base font-normal text-muted-foreground",children:["/",(s.id==="datacenter","GB")]})]}),e.jsx("ul",{className:"space-y-1.5",children:s.features.map(i=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(xe,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),i]},i))}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{variant:n?"outline":"default",className:"w-full",disabled:n,onClick:()=>re(s.id),children:n?"Active Product":"Select Product"}),!n&&e.jsxs("div",{className:"flex flex-col gap-2",children:[h.stripe&&e.jsxs(d,{variant:"secondary",className:"w-full gap-2",disabled:f,onClick:async()=>{m(!0);try{const{url:i}=await x.createProductCheckout(s.id,1);window.location.href=i}catch(i){r({title:"Purchase Error",description:i.message,variant:"destructive"})}finally{m(!1)}},children:[e.jsx(q,{className:"h-4 w-4"})," Buy with Card"]}),h.cryptomus&&e.jsxs(d,{variant:"outline",className:"w-full gap-2 border-primary/20 hover:border-primary/50",disabled:f,onClick:async()=>{m(!0);try{const{url:i}=await x.createCryptomusProductCheckout(s.id,1);window.location.href=i}catch(i){r({title:"Purchase Error",description:i.message,variant:"destructive"})}finally{m(!1)}},children:[e.jsx(M,{className:"h-4 w-4 text-orange-500"})," Buy with Crypto"]})]})]})]})]},s.id)})}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(N,{className:"text-lg",children:"Recent Invoices"})}),e.jsx(b,{className:"p-0",children:e.jsxs(fe,{children:[e.jsx(ye,{children:e.jsxs(G,{children:[e.jsx(C,{children:"Period"}),e.jsx(C,{children:"Amount"}),e.jsx(C,{children:"Status"}),e.jsx(C,{className:"text-right",children:"Date"})]})}),e.jsx(ge,{children:(te||[]).map(s=>e.jsxs(G,{children:[e.jsx(w,{className:"font-medium",children:s.period}),e.jsx(w,{children:a(s.amount_cents/100)}),e.jsx(w,{children:e.jsx(B,{variant:Te[s.status]??"secondary",children:s.status})}),e.jsxs(w,{className:"text-right text-sm text-muted-foreground space-x-2",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.pdf_url&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"Download PDF",children:e.jsx("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(he,{className:"h-3.5 w-3.5"})})})]})]},s.id))})]})})]})]}),e.jsx(Ae,{open:ee,onOpenChange:I,defaultAmount:p})]})}export{De as default};
