import{c as je,r as m,a4 as ve,j as e,a7 as R,a5 as K,aa as P,ac as Se,ad as we,aY as te,aJ as ye,a9 as Ne,aI as _e,ae as Ce,a as ke,k as Re,T as Pe,aN as De,D as Ee,I as J,G as Ae,B as Z,aZ as Q}from"./index-Cl2slAZZ.js";import{S as Me}from"./SEOHead-DgXLMDjT.js";import{C as T,a as I,b as B,d as L,c as V}from"./card-B8OYlSOh.js";import{L as Te}from"./label-BrxkBhDm.js";import{S as ee}from"./switch-C1RdS9Aw.js";import{v as Ie,w as Be}from"./use-backend-B75OJwKu.js";import{S as Ve}from"./save-TDyYtM1A.js";import"./useMutation-C3uQ2xJQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=je("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);var se=["PageUp","PageDown"],ne=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],re={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},D="Slider",[Y,Le,He]=Se(D),[oe]=Ne(D,[He]),[Ue,U]=oe(D),ae=m.forwardRef((t,s)=>{const{name:o,min:r=0,max:l=100,step:d=1,orientation:a="horizontal",disabled:n=!1,minStepsBetweenThumbs:u=0,defaultValue:x=[r],value:c,onValueChange:i=()=>{},onValueCommit:f=()=>{},inverted:j=!1,form:w,...b}=t,p=m.useRef(new Set),h=m.useRef(0),v=a==="horizontal"?ze:Oe,[g=[],E]=ve({prop:c,defaultProp:x,onChange:S=>{var C;(C=[...p.current][h.current])==null||C.focus(),i(S)}}),z=m.useRef(g);function O(S){const y=$e(g,S);A(S,y)}function ge(S){A(S,h.current)}function be(){const S=z.current[h.current];g[h.current]!==S&&f(g)}function A(S,y,{commit:C}={commit:!1}){const X=Ze(d),F=Qe(Math.round((S-r)/d)*d+r,X),M=te(F,[r,l]);E((k=[])=>{const N=We(k,M,y);if(Je(N,u*d)){h.current=N.indexOf(M);const q=String(N)!==String(k);return q&&C&&f(N),q?N:k}else return k})}return e.jsx(Ue,{scope:t.__scopeSlider,name:o,disabled:n,min:r,max:l,valueIndexToChangeRef:h,thumbs:p.current,values:g,orientation:a,form:w,children:e.jsx(Y.Provider,{scope:t.__scopeSlider,children:e.jsx(Y.Slot,{scope:t.__scopeSlider,children:e.jsx(v,{"aria-disabled":n,"data-disabled":n?"":void 0,...b,ref:s,onPointerDown:R(b.onPointerDown,()=>{n||(z.current=g)}),min:r,max:l,inverted:j,onSlideStart:n?void 0:O,onSlideMove:n?void 0:ge,onSlideEnd:n?void 0:be,onHomeKeyDown:()=>!n&&A(r,0,{commit:!0}),onEndKeyDown:()=>!n&&A(l,g.length-1,{commit:!0}),onStepKeyDown:({event:S,direction:y})=>{if(!n){const F=se.includes(S.key)||S.shiftKey&&ne.includes(S.key)?10:1,M=h.current,k=g[M],N=d*F*y;A(k+N,M,{commit:!0})}}})})})})});ae.displayName=D;var[ie,le]=oe(D,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ze=m.forwardRef((t,s)=>{const{min:o,max:r,dir:l,inverted:d,onSlideStart:a,onSlideMove:n,onSlideEnd:u,onStepKeyDown:x,...c}=t,[i,f]=m.useState(null),j=P(s,v=>f(v)),w=m.useRef(void 0),b=we(l),p=b==="ltr",h=p&&!d||!p&&d;function _(v){const g=w.current||i.getBoundingClientRect(),E=[0,g.width],O=$(E,h?[o,r]:[r,o]);return w.current=g,O(v-g.left)}return e.jsx(ie,{scope:t.__scopeSlider,startEdge:h?"left":"right",endEdge:h?"right":"left",direction:h?1:-1,size:"width",children:e.jsx(ce,{dir:b,"data-orientation":"horizontal",...c,ref:j,style:{...c.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const g=_(v.clientX);a==null||a(g)},onSlideMove:v=>{const g=_(v.clientX);n==null||n(g)},onSlideEnd:()=>{w.current=void 0,u==null||u()},onStepKeyDown:v=>{const E=re[h?"from-left":"from-right"].includes(v.key);x==null||x({event:v,direction:E?-1:1})}})})}),Oe=m.forwardRef((t,s)=>{const{min:o,max:r,inverted:l,onSlideStart:d,onSlideMove:a,onSlideEnd:n,onStepKeyDown:u,...x}=t,c=m.useRef(null),i=P(s,c),f=m.useRef(void 0),j=!l;function w(b){const p=f.current||c.current.getBoundingClientRect(),h=[0,p.height],v=$(h,j?[r,o]:[o,r]);return f.current=p,v(b-p.top)}return e.jsx(ie,{scope:t.__scopeSlider,startEdge:j?"bottom":"top",endEdge:j?"top":"bottom",size:"height",direction:j?1:-1,children:e.jsx(ce,{"data-orientation":"vertical",...x,ref:i,style:{...x.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const p=w(b.clientY);d==null||d(p)},onSlideMove:b=>{const p=w(b.clientY);a==null||a(p)},onSlideEnd:()=>{f.current=void 0,n==null||n()},onStepKeyDown:b=>{const h=re[j?"from-bottom":"from-top"].includes(b.key);u==null||u({event:b,direction:h?-1:1})}})})}),ce=m.forwardRef((t,s)=>{const{__scopeSlider:o,onSlideStart:r,onSlideMove:l,onSlideEnd:d,onHomeKeyDown:a,onEndKeyDown:n,onStepKeyDown:u,...x}=t,c=U(D,o);return e.jsx(K.span,{...x,ref:s,onKeyDown:R(t.onKeyDown,i=>{i.key==="Home"?(a(i),i.preventDefault()):i.key==="End"?(n(i),i.preventDefault()):se.concat(ne).includes(i.key)&&(u(i),i.preventDefault())}),onPointerDown:R(t.onPointerDown,i=>{const f=i.target;f.setPointerCapture(i.pointerId),i.preventDefault(),c.thumbs.has(f)?f.focus():r(i)}),onPointerMove:R(t.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&l(i)}),onPointerUp:R(t.onPointerUp,i=>{const f=i.target;f.hasPointerCapture(i.pointerId)&&(f.releasePointerCapture(i.pointerId),d(i))})})}),de="SliderTrack",ue=m.forwardRef((t,s)=>{const{__scopeSlider:o,...r}=t,l=U(de,o);return e.jsx(K.span,{"data-disabled":l.disabled?"":void 0,"data-orientation":l.orientation,...r,ref:s})});ue.displayName=de;var W="SliderRange",me=m.forwardRef((t,s)=>{const{__scopeSlider:o,...r}=t,l=U(W,o),d=le(W,o),a=m.useRef(null),n=P(s,a),u=l.values.length,x=l.values.map(f=>xe(f,l.min,l.max)),c=u>1?Math.min(...x):0,i=100-Math.max(...x);return e.jsx(K.span,{"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,...r,ref:n,style:{...t.style,[d.startEdge]:c+"%",[d.endEdge]:i+"%"}})});me.displayName=W;var G="SliderThumb",fe=m.forwardRef((t,s)=>{const o=Le(t.__scopeSlider),[r,l]=m.useState(null),d=P(s,n=>l(n)),a=m.useMemo(()=>r?o().findIndex(n=>n.ref.current===r):-1,[o,r]);return e.jsx(Fe,{...t,ref:d,index:a})}),Fe=m.forwardRef((t,s)=>{const{__scopeSlider:o,index:r,name:l,...d}=t,a=U(G,o),n=le(G,o),[u,x]=m.useState(null),c=P(s,_=>x(_)),i=u?a.form||!!u.closest("form"):!0,f=ye(u),j=a.values[r],w=j===void 0?0:xe(j,a.min,a.max),b=Ge(r,a.values.length),p=f==null?void 0:f[n.size],h=p?Xe(p,w,n.direction):0;return m.useEffect(()=>{if(u)return a.thumbs.add(u),()=>{a.thumbs.delete(u)}},[u,a.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[n.startEdge]:`calc(${w}% + ${h}px)`},children:[e.jsx(Y.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(K.span,{role:"slider","aria-label":t["aria-label"]||b,"aria-valuemin":a.min,"aria-valuenow":j,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...d,ref:c,style:j===void 0?{display:"none"}:t.style,onFocus:R(t.onFocus,()=>{a.valueIndexToChangeRef.current=r})})}),i&&e.jsx(he,{name:l??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:j},r)]})});fe.displayName=G;var Ye="RadioBubbleInput",he=m.forwardRef(({__scopeSlider:t,value:s,...o},r)=>{const l=m.useRef(null),d=P(l,r),a=_e(s);return m.useEffect(()=>{const n=l.current;if(!n)return;const u=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(u,"value").set;if(a!==s&&c){const i=new Event("input",{bubbles:!0});c.call(n,s),n.dispatchEvent(i)}},[a,s]),e.jsx(K.input,{style:{display:"none"},...o,ref:d,defaultValue:s})});he.displayName=Ye;function We(t=[],s,o){const r=[...t];return r[o]=s,r.sort((l,d)=>l-d)}function xe(t,s,o){const d=100/(o-s)*(t-s);return te(d,[0,100])}function Ge(t,s){return s>2?`Value ${t+1} of ${s}`:s===2?["Minimum","Maximum"][t]:void 0}function $e(t,s){if(t.length===1)return 0;const o=t.map(l=>Math.abs(l-s)),r=Math.min(...o);return o.indexOf(r)}function Xe(t,s,o){const r=t/2,d=$([0,50],[0,r]);return(r-d(s)*o)*o}function qe(t){return t.slice(0,-1).map((s,o)=>t[o+1]-s)}function Je(t,s){if(s>0){const o=qe(t);return Math.min(...o)>=s}return!0}function $(t,s){return o=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const r=(s[1]-s[0])/(t[1]-t[0]);return s[0]+r*(o-t[0])}}function Ze(t){return(String(t).split(".")[1]||"").length}function Qe(t,s){const o=Math.pow(10,s);return Math.round(t*o)/o}var pe=ae,et=ue,tt=me,st=fe;const H=m.forwardRef(({className:t,...s},o)=>e.jsxs(pe,{ref:o,className:Ce("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(et,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(tt,{className:"absolute h-full bg-primary"})}),e.jsx(st,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));H.displayName=pe.displayName;function ut(){const{data:t,isLoading:s}=Ie(),o=Be(),[r,l]=m.useState(null),[d,a]=m.useState(!1);t&&!r&&!s&&l(t);const n=r||t||{error_spike_pct:5,ban_spike_pct:8,spend_cap_usd:5e3,unusual_geo_threshold:3,notify_email:!0,notify_webhook:!1,webhook_url:""},u=(c,i)=>{l(f=>({...f||n,[c]:i})),a(!0)},x=async()=>{try{await o.mutateAsync(r),Q.success("Alert thresholds saved successfully"),a(!1)}catch{Q.error("Failed to save configuration")}};return s?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading config..."}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{title:"Admin — Alerts",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Alert Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure operational thresholds and notification channels."})]}),e.jsxs(ke,{onClick:x,disabled:!d,children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Save Changes",d&&e.jsx(Re,{variant:"secondary",className:"ml-2 text-xs",children:"unsaved"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs(T,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base",children:[e.jsx(Pe,{className:"h-4 w-4 text-destructive"}),"Error Spike Threshold"]}),e.jsx(L,{children:"Trigger alert when error rate exceeds this percentage."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-2xl font-bold",children:[n.error_spike_pct,"%"]})}),e.jsx(H,{value:[n.error_spike_pct],onValueChange:([c])=>u("error_spike_pct",c),min:1,max:25,step:.5}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: alerts if error rate ",">"," ",n.error_spike_pct,"%"]})]})]}),e.jsxs(T,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base",children:[e.jsx(De,{className:"h-4 w-4 text-yellow-600"}),"Ban Spike Threshold"]}),e.jsx(L,{children:"Trigger alert when proxy block/ban rate exceeds this percentage."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-2xl font-bold",children:[n.ban_spike_pct,"%"]})}),e.jsx(H,{value:[n.ban_spike_pct],onValueChange:([c])=>u("ban_spike_pct",c),min:1,max:30,step:.5}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: alerts if ban rate ",">"," ",n.ban_spike_pct,"%"]})]})]}),e.jsxs(T,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ee,{className:"h-4 w-4 text-primary"}),"Spend Cap"]}),e.jsx(L,{children:"Alert when total platform spend exceeds this daily threshold (EUR)."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold",children:"€"}),e.jsx(J,{type:"number",value:n.spend_cap_usd,onChange:c=>u("spend_cap_usd",Number(c.target.value)),className:"max-w-[150px]"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily platform-wide spend alert in EUR."})]})]}),e.jsxs(T,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ae,{className:"h-4 w-4 text-primary"}),"Unusual Geo Usage"]}),e.jsx(L,{children:"Alert when a single user connects from more than N countries in 1 hour."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-2xl font-bold",children:[n.unusual_geo_threshold," countries"]})}),e.jsx(H,{value:[n.unusual_geo_threshold],onValueChange:([c])=>u("unusual_geo_threshold",c),min:2,max:15,step:1}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Flags potential credential sharing or abuse."})]})]})]}),e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"})," Notification Channels"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Send alerts to admin email addresses."})]})]}),e.jsx(ee,{checked:n.notify_email,onCheckedChange:c=>u("notify_email",c)})]}),e.jsxs("div",{className:"space-y-3 rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Webhook"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"POST alert payloads to a custom endpoint."})]})]}),e.jsx(ee,{checked:n.notify_webhook,onCheckedChange:c=>u("notify_webhook",c)})]}),n.notify_webhook&&e.jsxs("div",{className:"space-y-1 pl-7",children:[e.jsx(Te,{className:"text-xs",children:"Webhook URL"}),e.jsx(J,{placeholder:"https://your-service.com/webhook",value:n.webhook_url,onChange:c=>u("webhook_url",c.target.value)})]})]})]})]})]})]})}export{ut as default};
