import{j as e,y as M,J as z,x as i,z as U,A as V,E as $,H as q,K as G}from"./ui-DC8iaVTx.js";import{r,aC as J,a4 as _,an as K,a3 as Q,Y as W}from"./vendor-4c0ygcws.js";import{S as X}from"./SEOHead-DYPNnLAR.js";import{C as D,a as Z,b as ee,c as L}from"./card-Dh3ArVV7.js";import{L as se,I as ae,e as te,f as ie,g as re,h as le,i as g,B as x,t as c}from"./index-CcHejEN1.js";import{L as u}from"./label-BsBlhyYN.js";import{T as P}from"./textarea-CQC14rsn.js";import{T as ce,a as ne,b as E,c as h,d as oe,e as p}from"./table-CkxPTGa1.js";import{E as de}from"./EmptyState-C4pg9dCt.js";import{i as xe}from"./use-backend-DftHbBc9.js";import"./useMutation-BY8wya_5.js";const R={open:{color:"secondary",icon:Q},in_progress:{color:"default",icon:K},resolved:{color:"outline",icon:_},closed:{color:"outline",icon:_}},I={low:"secondary",normal:"default",high:"destructive"};function Ne(){var T,w;const{data:t,isLoading:O,createTicket:m,replyTicket:j,updateStatus:y}=xe(),[l,f]=r.useState(null),[n,v]=r.useState(""),[S,A]=r.useState("normal"),[o,C]=r.useState(""),[d,N]=r.useState(""),[H,b]=r.useState(!1),a=t==null?void 0:t.find(s=>s.id===l),B=async()=>{if(!(!n.trim()||!o.trim()))try{await m.mutateAsync({subject:n,message:o,priority:S}),v(""),C(""),b(!1),c({title:"Ticket Created",description:"Your support ticket has been submitted."})}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}},Y=async()=>{if(!(!d.trim()||!l))try{await j.mutateAsync({id:l,message:d}),N("")}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}},F=async()=>{if(l)try{await y.mutateAsync({id:l,status:"closed"}),c({title:"Ticket Closed",description:"Your ticket has been marked as closed."})}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}};return O?e.jsx(se,{}):e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Support",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Support Tickets"}),!a&&e.jsxs(M,{open:H,onOpenChange:b,children:[e.jsx(z,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(J,{className:"mr-1 h-4 w-4"})," New Ticket"]})}),e.jsxs(U,{children:[e.jsx(V,{children:e.jsx($,{children:"Create Support Ticket"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Subject"}),e.jsx(ae,{value:n,onChange:s=>v(s.target.value),placeholder:"Brief description of your issue"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Priority"}),e.jsxs(te,{value:S,onValueChange:A,children:[e.jsx(ie,{children:e.jsx(re,{})}),e.jsxs(le,{children:[e.jsx(g,{value:"low",children:"Low"}),e.jsx(g,{value:"normal",children:"Normal"}),e.jsx(g,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Message"}),e.jsx(P,{value:o,onChange:s=>C(s.target.value),placeholder:"Describe your issue in detail...",rows:4})]})]}),e.jsxs(q,{children:[e.jsx(G,{asChild:!0,children:e.jsx(i,{variant:"outline",children:"Cancel"})}),e.jsx(i,{onClick:B,disabled:!n.trim()||!o.trim()||m.isPending,children:m.isPending?"Submitting…":"Submit Ticket"})]})]})]})]}),a?e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(null),children:"← Back to List"}),e.jsxs(D,{children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-lg",children:a.subject}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(x,{variant:I[a.priority]??"secondary",children:a.priority}),e.jsx(x,{variant:((T=R[a.status])==null?void 0:T.color)??"secondary",children:a.status.replace("_"," ")})]})]}),a.status!=="closed"&&e.jsx(i,{variant:"outline",size:"sm",onClick:F,disabled:y.isPending,children:"Close Ticket"})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto px-1",children:(w=a.messages)==null?void 0:w.map(s=>e.jsx("div",{className:`flex flex-col ${s.is_admin_reply?"items-start":"items-end"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${s.is_admin_reply?"bg-muted text-foreground":"bg-primary text-primary-foreground"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-1",children:[e.jsx("span",{className:"font-bold text-[10px] uppercase opacity-70",children:s.is_admin_reply?"Support Agent":"You"}),e.jsx("span",{className:"text-[10px] opacity-70",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.message})]})},s.id))}),a.status!=="closed"&&e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsx(u,{children:"Reply to Ticket"}),e.jsx(P,{value:d,onChange:s=>N(s.target.value),placeholder:"Type your message here...",rows:3}),e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{onClick:Y,disabled:!d.trim()||j.isPending,children:j.isPending?"Sending...":"Send Reply"})})]})]})]})]}):e.jsx(e.Fragment,{children:t!=null&&t.length?e.jsx(D,{children:e.jsx(L,{className:"p-0",children:e.jsxs(ce,{children:[e.jsx(ne,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Subject"}),e.jsx(h,{children:"Priority"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Last Updated"})]})}),e.jsx(oe,{children:t.map(s=>{var k;return e.jsxs(E,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>f(s.id),children:[e.jsx(p,{className:"font-medium",children:s.subject}),e.jsx(p,{children:e.jsx(x,{variant:I[s.priority]??"secondary",className:"text-xs",children:s.priority})}),e.jsx(p,{children:e.jsx(x,{variant:((k=R[s.status])==null?void 0:k.color)??"secondary",className:"text-xs",children:s.status.replace("_"," ")})}),e.jsx(p,{className:"text-right text-xs text-muted-foreground",children:new Date(s.updated_at).toLocaleDateString()})]},s.id)})})]})})}):e.jsx(de,{icon:W,title:"No tickets",description:"You haven't created any support tickets yet."})})]})]})}export{Ne as default};
