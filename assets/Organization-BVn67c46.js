import{c as $,l as G,Q as W,r as m,U as p,j as e,a as o,I as O,aH as X,a0 as Y,x as Z,y as ee,z as se,E as ae,J as v,aI as re,t as h}from"./index-DLv-_11A.js";import{S as ie}from"./SEOHead-D5fuhoMQ.js";import{C as j,c as N,a as w,b as C,d as te}from"./card-a0hC1Dpt.js";import{L as b}from"./label-xrehxqYh.js";import{B as _}from"./badge-CxiN3S2c.js";import{T,a as k,b as u,c as n,d as F,e as l}from"./table-Ja4-_zyu.js";import{D as L,a as H,b as R,c as M,d as B,e as K,f as P}from"./dialog-CYzTROGt.js";import{s as d}from"./client-DBtcxyoE.js";import{u as Q}from"./useMutation-BxYmRP84.js";import{P as ne}from"./plus-DkTm-BK9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=$("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function fe(){const{user:r}=G(),S=W(),[x,z]=m.useState(""),[g,D]=m.useState(""),[E,U]=m.useState("member"),{data:c,isLoading:q}=p({queryKey:["orgs",r==null?void 0:r.id],enabled:!!(r!=null&&r.id),queryFn:async()=>{const{data:s,error:a}=await d.from("org_members").select("org_id, role, organizations(id, name, slug, owner_id, created_at)").eq("user_id",r.id);if(a)throw a;return s??[]}}),A=Q({mutationFn:async()=>{const s=x.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),{data:a,error:t}=await d.from("organizations").insert({name:x,slug:s,owner_id:r.id}).select().single();if(t)throw t;return await d.from("org_members").insert({org_id:a.id,user_id:r.id,role:"owner"}),a},onSuccess:()=>{S.invalidateQueries({queryKey:["orgs"]}),z(""),h({title:"Organization Created"})},onError:s=>h({title:"Error",description:s.message,variant:"destructive"})}),[i,V]=m.useState(null),{data:y}=p({queryKey:["org-members",i],enabled:!!i,queryFn:async()=>{const{data:s,error:a}=await d.from("org_members").select("*, profiles:user_id(full_name, email)").eq("org_id",i);if(a)throw a;return s??[]}}),{data:f}=p({queryKey:["org-invites",i],enabled:!!i,queryFn:async()=>{const{data:s,error:a}=await d.from("org_invites").select("*").eq("org_id",i).is("accepted_at",null);if(a)throw a;return s??[]}}),J=Q({mutationFn:async()=>{const{error:s}=await d.from("org_invites").insert({org_id:i,email:g,role:E,invited_by:r.id});if(s)throw s},onSuccess:()=>{S.invalidateQueries({queryKey:["org-invites"]}),D(""),h({title:"Invite Sent"})},onError:s=>h({title:"Error",description:s.message,variant:"destructive"})}),I={owner:"default",admin:"secondary",member:"outline",viewer:"outline"};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Organization",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Organizations"}),e.jsxs(L,{children:[e.jsx(H,{asChild:!0,children:e.jsxs(o,{size:"sm",children:[e.jsx(ne,{className:"mr-1 h-4 w-4"})," Create Org"]})}),e.jsxs(R,{children:[e.jsx(M,{children:e.jsx(B,{children:"Create Organization"})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Organization Name"}),e.jsx(O,{value:x,onChange:s=>z(s.target.value),placeholder:"Acme Corp"})]})}),e.jsxs(K,{children:[e.jsx(P,{asChild:!0,children:e.jsx(o,{variant:"outline",children:"Cancel"})}),e.jsx(o,{onClick:()=>A.mutate(),disabled:!x.trim(),children:"Create"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[q&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."}),(c==null?void 0:c.length)===0&&!q&&e.jsx(j,{className:"col-span-full",children:e.jsxs(N,{className:"py-8 text-center",children:[e.jsx(X,{className:"mx-auto h-10 w-10 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No organizations yet. Create one to get started."})]})}),c==null?void 0:c.map(s=>{var a,t;return e.jsx(j,{className:`cursor-pointer transition-colors ${i===s.org_id?"border-primary":""}`,onClick:()=>V(s.org_id),children:e.jsxs(w,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{className:"text-base",children:(a=s.organizations)==null?void 0:a.name}),e.jsx(_,{variant:I[s.role]??"outline",children:s.role})]}),e.jsxs(te,{className:"text-xs",children:["Slug: ",(t=s.organizations)==null?void 0:t.slug]})]})},s.org_id)})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"})," Members"]}),e.jsxs(L,{children:[e.jsx(H,{asChild:!0,children:e.jsxs(o,{size:"sm",children:[e.jsx(le,{className:"mr-1 h-4 w-4"})," Invite"]})}),e.jsxs(R,{children:[e.jsx(M,{children:e.jsx(B,{children:"Invite Member"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Email"}),e.jsx(O,{value:g,onChange:s=>D(s.target.value),placeholder:"user@example.com",type:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Role"}),e.jsxs(Z,{value:E,onValueChange:U,children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(ae,{children:[e.jsx(v,{value:"admin",children:"Admin"}),e.jsx(v,{value:"member",children:"Member"}),e.jsx(v,{value:"viewer",children:"Viewer"})]})]})]})]}),e.jsxs(K,{children:[e.jsx(P,{asChild:!0,children:e.jsx(o,{variant:"outline",children:"Cancel"})}),e.jsx(o,{onClick:()=>J.mutate(),disabled:!g,children:"Send Invite"})]})]})]})]}),e.jsx(N,{className:"p-0",children:e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Department"}),e.jsx(n,{children:"Joined"})]})}),e.jsx(F,{children:y==null?void 0:y.map(s=>{var a,t;return e.jsxs(u,{children:[e.jsx(l,{className:"font-medium text-sm",children:((a=s.profiles)==null?void 0:a.full_name)||"—"}),e.jsx(l,{className:"text-sm",children:((t=s.profiles)==null?void 0:t.email)||"—"}),e.jsx(l,{children:e.jsx(_,{variant:I[s.role]??"outline",className:"text-xs",children:s.role})}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.department||"—"}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(s.joined_at).toLocaleDateString()})]},s.id)})})]})})]}),f&&f.length>0&&e.jsxs(j,{children:[e.jsx(w,{children:e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"})," Pending Invites"]})}),e.jsx(N,{className:"p-0",children:e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Expires"})]})}),e.jsx(F,{children:f.map(s=>e.jsxs(u,{children:[e.jsx(l,{className:"text-sm",children:s.email}),e.jsx(l,{children:e.jsx(_,{variant:"outline",className:"text-xs",children:s.role})}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(s.expires_at).toLocaleDateString()})]},s.id))})]})})]})]})]})]})}export{fe as default};
