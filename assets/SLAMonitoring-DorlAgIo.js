import{j as e,y as Q,J as $,x as f,z as I,A as R,E as G}from"./ui-CeaNA1b8.js";import{r as z,A as J,aC as V,aO as W}from"./vendor-CSZBJNtL.js";import{j as Y,I as v,B as N,t as b,y as m,k as F,o as h,Y as n,a3 as X,s as i,C as j}from"./index-DRUejFCs.js";import{u as U}from"./useMutation-BqtTCqNZ.js";import{C as p,a as Z,b as ee,c as x}from"./card-clxFFivi.js";import{L as C}from"./label-5YbheAOU.js";import{T as S,a as T,b as d,c as r,d as A,e as a}from"./table-D3uMK-0w.js";import{T as se,a as te,b as L,c as w}from"./tabs-DQPOW2GU.js";import{f as ae}from"./format-sbWH3_uq.js";const q=h({id:n(),proxy_type:i(),guaranteed_uptime:i().or(n()),credit_per_percent:i().or(n()),measurement_window:i(),is_active:n().or(X())}),re=h({id:n(),proxy_type:i(),status:i(),response_time_ms:n().nullable(),region:i().nullable(),checked_at:i()}),B=h({id:n(),user_id:n(),proxy_type:i(),guaranteed_uptime:i().or(n()),actual_uptime:i().or(n()),credit_amount:i().or(n()),status:i(),reason:i().nullable(),created_at:i(),user:h({id:n(),email:i()}).optional()}),ie=h({records:j(re),configs:j(q)}),ne={up:"bg-green-500",degraded:"bg-yellow-500",down:"bg-destructive"};function de(){return F({queryKey:["sla-configs"],queryFn:()=>m.get("/admin/sla/configs",j(q))})}function le(){return F({queryKey:["sla-monitoring"],queryFn:()=>m.get("/admin/sla",ie)})}function ce(){return F({queryKey:["sla-credits"],queryFn:()=>m.get("/admin/sla/credits",j(B))})}function _e(){const{data:c}=le(),{data:H}=de(),{data:o}=ce(),l=(c==null?void 0:c.records)??[],g=H??(c==null?void 0:c.configs)??[],y=Y(),[K,D]=z.useState(!1),[u,_]=z.useState({proxy_type:"",guaranteed_uptime:"99.9",credit_per_percent:"5"}),M=U({mutationFn:()=>m.post("/admin/sla/configs",q,{proxy_type:u.proxy_type,guaranteed_uptime:parseFloat(u.guaranteed_uptime),credit_per_percent:parseFloat(u.credit_per_percent),is_active:!0}),onSuccess:()=>{y.invalidateQueries({queryKey:["sla-configs"]}),y.invalidateQueries({queryKey:["sla-monitoring"]}),b({title:"SLA config created"}),D(!1)},onError:s=>b({title:"Error",description:s.message,variant:"destructive"})}),O=U({mutationFn:s=>m.post(`/admin/sla/credits/${s}/approve`,B),onSuccess:()=>{y.invalidateQueries({queryKey:["sla-credits"]}),b({title:"Credit approved"})}}),P=l.reduce((s,t)=>(s[t.proxy_type]||(s[t.proxy_type]={total:0,up:0}),s[t.proxy_type].total++,t.status==="up"&&s[t.proxy_type].up++,s),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(J,{className:"h-6 w-6"})," SLA Monitoring"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track uptime guarantees and manage credits"})]}),e.jsxs(Q,{open:K,onOpenChange:D,children:[e.jsx($,{asChild:!0,children:e.jsxs(f,{children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Add SLA Config"]})}),e.jsxs(I,{children:[e.jsx(R,{children:e.jsx(G,{children:"Create SLA Configuration"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Proxy Type"}),e.jsx(v,{placeholder:"e.g. residential",value:u.proxy_type,onChange:s=>_(t=>({...t,proxy_type:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Guaranteed Uptime (%)"}),e.jsx(v,{type:"number",step:"0.1",value:u.guaranteed_uptime,onChange:s=>_(t=>({...t,guaranteed_uptime:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Credit per % Downtime"}),e.jsx(v,{type:"number",value:u.credit_per_percent,onChange:s=>_(t=>({...t,credit_per_percent:s.target.value}))})]})]}),e.jsx(f,{onClick:()=>M.mutate(),disabled:M.isPending,className:"w-full",children:"Create"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[g.map(s=>{const t=P[s.proxy_type],E=t?(t.up/t.total*100).toFixed(2):"N/A",k=t?t.up/t.total*100>=Number(s.guaranteed_uptime):!0;return e.jsxs(p,{children:[e.jsx(Z,{className:"pb-2",children:e.jsx(ee,{className:"text-sm font-medium capitalize",children:s.proxy_type})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[E,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["SLA: ",Number(s.guaranteed_uptime),"%"]}),e.jsx(N,{variant:k?"default":"destructive",className:"mt-2",children:k?"SLA Met":"SLA Breached"})]})]},s.id)}),g.length===0&&e.jsx(p,{className:"md:col-span-4",children:e.jsx(x,{className:"py-8 text-center text-muted-foreground",children:"No SLA configs. Create one to start monitoring."})})]}),e.jsxs(se,{defaultValue:"uptime",children:[e.jsxs(te,{children:[e.jsx(L,{value:"uptime",children:"Uptime Records"}),e.jsx(L,{value:"credits",children:"SLA Credits"}),e.jsx(L,{value:"configs",children:"Configurations"})]}),e.jsx(w,{value:"uptime",children:e.jsx(p,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(S,{children:[e.jsx(T,{children:e.jsxs(d,{children:[e.jsx(r,{children:"Proxy Type"}),e.jsx(r,{children:"Region"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Response Time"}),e.jsx(r,{children:"Checked At"})]})}),e.jsxs(A,{children:[l==null?void 0:l.slice(0,50).map(s=>e.jsxs(d,{children:[e.jsx(a,{className:"capitalize",children:s.proxy_type}),e.jsx(a,{children:s.region}),e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${ne[s.status]??"bg-muted"}`}),e.jsx("span",{className:"capitalize",children:s.status})]})}),e.jsx(a,{children:s.response_time_ms?`${s.response_time_ms}ms`:"â€”"}),e.jsx(a,{className:"text-xs",children:ae(new Date(s.checked_at),"MMM d, HH:mm:ss")})]},s.id)),!(l!=null&&l.length)&&e.jsx(d,{children:e.jsx(a,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No uptime records yet"})})]})]})})})}),e.jsx(w,{value:"credits",children:e.jsx(p,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(S,{children:[e.jsx(T,{children:e.jsxs(d,{children:[e.jsx(r,{children:"User ID"}),e.jsx(r,{children:"Proxy Type"}),e.jsx(r,{children:"Actual Uptime"}),e.jsx(r,{children:"Guaranteed"}),e.jsx(r,{children:"Credit"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsxs(A,{children:[o==null?void 0:o.map(s=>{var t;return e.jsxs(d,{children:[e.jsx(a,{className:"font-medium text-xs",children:((t=s.user)==null?void 0:t.email)??`User #${s.user_id}`}),e.jsx(a,{className:"capitalize",children:s.proxy_type}),e.jsxs(a,{children:[Number(s.actual_uptime).toFixed(2),"%"]}),e.jsxs(a,{children:[Number(s.guaranteed_uptime),"%"]}),e.jsxs(a,{className:"font-semibold",children:["$",Number(s.credit_amount).toFixed(2)]}),e.jsx(a,{children:e.jsx(N,{variant:s.status==="approved"?"default":s.status==="applied"?"secondary":"outline",children:s.status})}),e.jsx(a,{children:s.status==="pending"&&e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>O.mutate(s.id),children:[e.jsx(W,{className:"mr-1 h-3 w-3"})," Approve"]})})]},s.id)}),!(o!=null&&o.length)&&e.jsx(d,{children:e.jsx(a,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No SLA credits issued"})})]})]})})})}),e.jsx(w,{value:"configs",children:e.jsx(p,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(S,{children:[e.jsx(T,{children:e.jsxs(d,{children:[e.jsx(r,{children:"Proxy Type"}),e.jsx(r,{children:"Guaranteed Uptime"}),e.jsx(r,{children:"Credit / % Downtime"}),e.jsx(r,{children:"Window"}),e.jsx(r,{children:"Status"})]})}),e.jsx(A,{children:g.map(s=>e.jsxs(d,{children:[e.jsx(a,{className:"capitalize font-medium",children:s.proxy_type}),e.jsxs(a,{children:[Number(s.guaranteed_uptime),"%"]}),e.jsxs(a,{children:[Number(s.credit_per_percent),"%"]}),e.jsx(a,{className:"capitalize",children:s.measurement_window}),e.jsx(a,{children:e.jsx(N,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})})]},s.id))})]})})})})]})]})}export{_e as default};
