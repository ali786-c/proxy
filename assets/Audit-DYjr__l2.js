import{r as h,al as w,j as e,I as S,p as v,q as _,v as C,w as b,x as p,M as T,s as L}from"./index-WAZqrxeU.js";import{S as A}from"./SEOHead-BQbD0fka.js";import{C as y,c as I}from"./card-DA1uTK-7.js";import{B as O}from"./badge-Dr0x0J-M.js";import{T as q,a as F,b as l,c as i,d as P,e as r}from"./table-Td0WyvwD.js";import{S as R}from"./search-D67DS-4j.js";const k={ban:"destructive",deduct:"destructive",unban:"default",top_up:"default",update:"secondary",reply:"secondary",create:"default"};function z(){const[n,j]=h.useState(""),[c,g]=h.useState("all"),{data:d,isLoading:o}=w({queryKey:["audit-log",c],queryFn:async()=>{let t=L.from("audit_log").select("*").order("created_at",{ascending:!1}).limit(100);c!=="all"&&(t=t.ilike("action",`%${c}%`));const{data:s,error:a}=await t;if(a)throw a;return s??[]}}),x=(d??[]).filter(t=>{var a,m,u;if(!n)return!0;const s=n.toLowerCase();return t.action.toLowerCase().includes(s)||((a=t.target_id)==null?void 0:a.toLowerCase().includes(s))||((m=t.ip_address)==null?void 0:m.toLowerCase().includes(s))||((u=t.geo_country)==null?void 0:u.toLowerCase().includes(s))}),f=[...new Set((d??[]).map(t=>t.action.split("_")[0]))],N=t=>new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Admin — Audit Log",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review all system-wide activity with IP & geo tracking."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(R,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(S,{placeholder:"Search action, target, IP, country…",value:n,onChange:t=>j(t.target.value),className:"pl-9"})]}),e.jsxs(v,{value:c,onValueChange:g,children:[e.jsx(_,{className:"w-[150px]",children:e.jsx(C,{placeholder:"Action type"})}),e.jsxs(b,{children:[e.jsx(p,{value:"all",children:"All actions"}),f.map(t=>e.jsx(p,{value:t,className:"capitalize",children:t},t))]})]})]}),e.jsx(y,{children:e.jsx(I,{className:"p-0",children:e.jsxs(q,{children:[e.jsx(F,{children:e.jsxs(l,{children:[e.jsx(i,{children:"Timestamp"}),e.jsx(i,{children:"Action"}),e.jsx(i,{children:"Target"}),e.jsx(i,{children:"IP Address"}),e.jsx(i,{children:"Location"}),e.jsx(i,{children:"Meta"})]})}),e.jsxs(P,{children:[o&&e.jsx(l,{children:e.jsx(r,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"Loading…"})}),!o&&x.map(t=>{var a;const s=t.action.split("_")[0];return e.jsxs(l,{children:[e.jsx(r,{className:"text-sm text-muted-foreground whitespace-nowrap",children:N(t.created_at)}),e.jsx(r,{children:e.jsx(O,{variant:k[s]??"outline",className:"text-xs",children:t.action})}),e.jsx(r,{className:"text-sm font-mono text-xs",children:((a=t.target_id)==null?void 0:a.slice(0,8))??"—"}),e.jsx(r,{className:"text-sm font-mono text-xs",children:t.ip_address??"—"}),e.jsx(r,{className:"text-sm",children:t.geo_country?e.jsxs("span",{className:"flex items-center gap-1 text-xs",children:[e.jsx(T,{className:"h-3 w-3"}),t.geo_city?`${t.geo_city}, `:"",t.geo_country]}):"—"}),e.jsx(r,{className:"text-xs text-muted-foreground max-w-[200px] truncate",children:t.metadata&&Object.keys(t.metadata).length>0?JSON.stringify(t.metadata):"—"})]},t.id)}),!o&&x.length===0&&e.jsx(l,{children:e.jsx(r,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No audit entries found."})})]})]})})})]})]})}export{z as default};
