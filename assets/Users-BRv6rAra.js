import{c as U,r as x,j as e,P as R,I as g,aK as P,aL as z,aM as E,aN as O,aO as $,B as b,S as H,t as r}from"./index-CKrLide3.js";import{S as I}from"./SEOHead-DJT_5oK0.js";import{C as h,c as u}from"./card-COtyNIWo.js";import{B as w}from"./badge-C6BetpSO.js";import{L as A}from"./label-BCmrcToX.js";import{T as J,a as K,b as N,c as d,d as V,e as l}from"./table-By0b838L.js";import{n as q,o as G,m as Q}from"./use-backend-DK7bIyPX.js";import{S as W}from"./search-DHPoF9Kw.js";import{P as X}from"./plus-BcJ1h9Ee.js";import"./useQuery-D6bDMPQD.js";import"./useMutation-CW9kxkEL.js";import"./api-BTF2QDx4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=U("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=U("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);function he(){const{data:c,isLoading:L}=q(),{updateBalance:j,banUser:v}=G(),[i,k]=x.useState(""),[a,o]=x.useState(null),[m,p]=x.useState(""),[S,f]=x.useState(""),{data:ee}=Q(),_=null;if(L)return e.jsx(R,{});const y=(c??[]).filter(s=>{var t,n;return!(i&&!((t=s.email)!=null&&t.toLowerCase().includes(i.toLowerCase()))&&!((n=s.name)!=null&&n.toLowerCase().includes(i.toLowerCase())))}),F=async s=>{const t=s.role==="banned";try{await v.mutateAsync({user_id:s.id,reason:t?"Unbanning":"Violated terms of service"}),o(null),r({title:t?"User unbanned":"User banned"})}catch(n){r({title:"Error",description:n.message,variant:"destructive"})}},B=async s=>{const t=parseFloat(m);if(!t||t<=0){r({title:"Invalid amount",variant:"destructive"});return}try{const n=await j.mutateAsync({user_id:a.id,amount:s?t:-t,reason:S||(s?"Admin top-up":"Admin deduction")});p(""),f(""),o(C=>C?{...C,balance:n.new_balance}:null),r({title:`Balance ${s?"topped up":"deducted"} successfully`})}catch(n){r({title:"Error",description:n.message,variant:"destructive"})}},T=(c??[]).length,D=(c??[]).filter(s=>s.role==="banned").length,M=(c??[]).reduce((s,t)=>s+Number(t.balance??0),0);return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Admin — Users",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all registered users, balances, and access."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(h,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:T})]})}),e.jsx(h,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Banned Users"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:D})]})}),e.jsx(h,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total User Balances"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(M||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(W,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(g,{placeholder:"Search by name or email…",value:i,onChange:s=>k(s.target.value),className:"pl-9"})]})}),e.jsx(h,{children:e.jsx(u,{className:"p-0",children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(N,{children:[e.jsx(d,{children:"User"}),e.jsx(d,{children:"Role"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Balance"}),e.jsx(d,{children:"Joined"})]})}),e.jsxs(V,{children:[y.map(s=>e.jsxs(N,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>o(s),children:[e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(l,{className:"capitalize",children:s.role||"client"}),e.jsx(l,{children:e.jsx(w,{variant:s.role==="banned"?"destructive":"default",children:s.role==="banned"?"Banned":"Active"})}),e.jsxs(l,{children:["$",Number(s.balance??0).toFixed(2)]}),e.jsx(l,{className:"text-muted-foreground text-sm",children:s.created_at?new Date(s.created_at).toLocaleDateString():"—"})]},s.id)),y.length===0&&e.jsx(N,{children:e.jsx(l,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No users found."})})]})]})})})]}),e.jsx(P,{open:!!a,onOpenChange:()=>{o(null),p(""),f("")},children:e.jsx(z,{className:"sm:max-w-lg overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx(O,{children:a.full_name||"User"}),e.jsx($,{children:a.email})]}),e.jsxs("div",{className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:a.role||"client"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx(w,{variant:a.role==="banned"?"destructive":"default",children:a.role==="banned"?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:"font-medium text-lg",children:["$",Number(a.balance??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium",children:a.created_at?new Date(a.created_at).toLocaleDateString():"—"})]})]}),_,a.ban_reason&&e.jsxs("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx("strong",{children:"Ban reason:"})," ",a.ban_reason]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Adjust Balance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(g,{id:"amount",type:"number",min:"0.01",step:"0.01",placeholder:"e.g. 50.00",value:m,onChange:s=>p(s.target.value)}),e.jsx(A,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(g,{id:"reason",placeholder:"e.g. Manual credit for support case",value:S,onChange:s=>f(s.target.value)}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(b,{size:"sm",onClick:()=>B(!0),disabled:j.isPending||!m,className:"flex-1",children:[e.jsx(X,{className:"mr-1 h-4 w-4"})," Top Up"]}),e.jsxs(b,{size:"sm",variant:"destructive",onClick:()=>B(!1),disabled:j.isPending||!m,className:"flex-1",children:[e.jsx(Y,{className:"mr-1 h-4 w-4"})," Deduct"]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Access Control"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(b,{variant:a.role==="banned"?"default":"destructive",size:"sm",onClick:()=>F(a),disabled:v.isPending,children:[a.role==="banned"?e.jsx(H,{className:"mr-2 h-4 w-4"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),a.role==="banned"?"Unban User":"Ban User"]})})]})]})]})})})]})}export{he as default};
