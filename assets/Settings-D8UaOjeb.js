import{j as e,U,S as T,r as l,N as g,I as p,b as B,B as c,t as f}from"./index-AkMOU31n.js";import{S as O}from"./SEOHead-Dp93D3qd.js";import{E as $}from"./ErrorBanner-ArJYqe_s.js";import{E}from"./EmptyState-ClYIKbWC.js";import{L as C}from"./label-mOhBPKCn.js";import{C as y,c as v,a as A,b as S}from"./card-BMBKLJ43.js";import{T as K,a as L,b as I,c as h,d as R,e as j}from"./table-ColB3Miv.js";import{T as q,a as M,b as k,c as D}from"./tabs-D1D8VMYH.js";import{D as V,a as Y,b as Z,c as G,d as J,e as Q}from"./dialog-eCSTBwFs.js";import{e as W,f as X,g as ee,h as se}from"./use-backend-B7dGBO34.js";import{K as F}from"./key-DEzWZkaB.js";import{P as z}from"./plus-D_ZMFFqu.js";import{T as _}from"./trash-2-Pk481UUx.js";import{C as ae}from"./copy--UiwxHMY.js";import"./circle-alert-BjyZeqsb.js";import"./useQuery-CwukAndk.js";import"./useMutation-DV0x6ne4.js";import"./api-BTF2QDx4.js";function Pe(){return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Settings",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"}),e.jsxs(q,{defaultValue:"allowlist",children:[e.jsxs(M,{children:[e.jsxs(k,{value:"profile",children:[e.jsx(U,{className:"mr-1 h-3.5 w-3.5"})," Profile"]}),e.jsxs(k,{value:"allowlist",children:[e.jsx(T,{className:"mr-1 h-3.5 w-3.5"})," IP Allowlist"]}),e.jsxs(k,{value:"api-keys",children:[e.jsx(F,{className:"mr-1 h-3.5 w-3.5"})," API Keys"]})]}),e.jsx(D,{value:"profile",className:"mt-4",children:e.jsx(re,{})}),e.jsx(D,{value:"allowlist",className:"mt-4",children:e.jsx(te,{})}),e.jsx(D,{value:"api-keys",className:"mt-4",children:e.jsx(le,{})})]})]})]})}function te(){const{data:a,isLoading:w,addEntry:o,removeEntry:x}=ee(),[m,r]=l.useState(""),[u,i]=l.useState(""),[n,t]=l.useState(null),N=async()=>{var d,b;t(null);const s=m.trim();if(!s){t("IP address is required.");return}if(!/^\d{1,3}(\.\d{1,3}){3}(\/\d{1,2})?$/.test(s)){t("Enter a valid IPv4 address or CIDR range.");return}try{await o.mutateAsync({ip:s,label:u.trim()||void 0}),r(""),i(""),f({title:"IP Added",description:`${s} added to allowlist.`})}catch(P){t(((b=(d=P.response)==null?void 0:d.data)==null?void 0:b.message)||"Failed to add IP.")}};return w?e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx(g,{className:"h-20 w-full"}),e.jsx(g,{className:"h-40 w-full"})]}):e.jsxs(y,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"IP Allowlist"})}),e.jsxs(v,{className:"space-y-4",children:[n&&e.jsx($,{message:n,onDismiss:()=>t(null)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"203.0.113.0/24",value:m,onChange:s=>r(s.target.value),className:"max-w-xs"}),e.jsx(p,{placeholder:"Label (optional)",value:u,onChange:s=>i(s.target.value),className:"max-w-xs"}),e.jsx(c,{onClick:N,disabled:o.isPending,children:o.isPending?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-1 h-4 w-4"})," Add"]})})]}),!a||a.length===0?e.jsx(E,{icon:T,title:"No IPs allowlisted",description:"Add your server IPs to authenticate without credentials."}):e.jsxs(K,{children:[e.jsx(L,{children:e.jsxs(I,{children:[e.jsx(h,{children:"IP Address"}),e.jsx(h,{children:"Label"}),e.jsx(h,{children:"Added"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(R,{children:a.map(s=>e.jsxs(I,{children:[e.jsx(j,{className:"font-mono text-sm",children:s.ip}),e.jsx(j,{className:"text-sm text-muted-foreground",children:s.label??"—"}),e.jsx(j,{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(j,{children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>x.mutate(s.id),disabled:x.isPending,"aria-label":"Remove",children:e.jsx(_,{className:"h-4 w-4 text-destructive"})})})]},s.id))})]})]})]})}function le(){const{data:a,isLoading:w,createKey:o,revokeKey:x}=se(),[m,r]=l.useState(null),[u,i]=l.useState(!1),[n,t]=l.useState(""),N=async()=>{if(n.trim())try{const s=await o.mutateAsync(n.trim());r(s.api_key),t(""),i(!1),f({title:"API Key Created",description:"Copy it now — it won't be shown again."})}catch{f({title:"Error",description:"Failed to create API key.",variant:"destructive"})}};return w?e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx(g,{className:"h-20 w-full"}),e.jsx(g,{className:"h-40 w-full"})]}):e.jsxs("div",{className:"space-y-4",children:[m&&e.jsx(y,{className:"border-primary bg-primary/5",children:e.jsx(v,{className:"flex items-center justify-between gap-4 py-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-primary",children:"Your new API key (copy it now!):"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("code",{className:"flex-1 block text-xs font-mono text-primary break-all bg-background border border-primary/20 p-2 rounded",children:m}),e.jsxs(c,{variant:"default",size:"sm",onClick:()=>{navigator.clipboard.writeText(m||""),f({title:"Copied to clipboard"})},children:[e.jsx(ae,{className:"mr-1 h-3.5 w-3.5"})," Copy"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>r(null),children:"Close"})]})]})})}),e.jsxs(y,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsx(S,{className:"text-lg",children:"API Keys"}),e.jsxs(V,{open:u,onOpenChange:i,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx(z,{className:"mr-1 h-4 w-4"})," Create Key"]})}),e.jsxs(Z,{children:[e.jsx(G,{children:e.jsx(J,{children:"Create API Key"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Key Name"}),e.jsx(p,{value:n,onChange:s=>t(s.target.value),placeholder:"Production"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"API keys allow you to generate proxies and check usage via our REST API."})]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(c,{onClick:N,disabled:!n.trim()||o.isPending,children:o.isPending?"Creating...":"Create"})]})]})]})]}),e.jsx(v,{className:"p-0",children:!a||a.length===0?e.jsx("div",{className:"p-6",children:e.jsx(E,{icon:F,title:"No API keys",description:"Create a key to access the UpgradedProxy API programmatically."})}):e.jsxs(K,{children:[e.jsx(L,{children:e.jsxs(I,{children:[e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Key Prefix"}),e.jsx(h,{children:"Added"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(R,{children:a.map(s=>e.jsxs(I,{children:[e.jsx(j,{className:"font-medium text-sm",children:s.key_name}),e.jsxs(j,{className:"font-mono text-xs",children:[s.api_key.substring(0,12),"****"]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(j,{children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>x.mutate(s.id),disabled:x.isPending,"aria-label":"Revoke",children:e.jsx(_,{className:"h-4 w-4 text-destructive"})})})]},s.id))})]})})]})]})}function re(){const{data:a,isLoading:w}=W(),o=X(),[x,m]=l.useState(""),[r,u]=l.useState(""),[i,n]=l.useState(""),[t,N]=l.useState(!1);l.useState(()=>{a!=null&&a.name&&m(a.name)});const s=async d=>{var b,P;if(d.preventDefault(),r&&r!==i){f({title:"Error",description:"Passwords do not match.",variant:"destructive"});return}N(!0);try{await o.mutateAsync({name:x||void 0,password:r||void 0,password_confirmation:i||void 0}),f({title:"Success",description:"Profile updated successfully."}),u(""),n("")}catch(H){f({title:"Error",description:((P=(b=H.response)==null?void 0:b.data)==null?void 0:P.message)||"Failed to update profile.",variant:"destructive"})}finally{N(!1)}};return w?e.jsx(y,{children:e.jsxs(v,{className:"pt-6 space-y-4",children:[e.jsx(g,{className:"h-10 w-full"}),e.jsx(g,{className:"h-10 w-full"}),e.jsx(g,{className:"h-10 w-24"})]})}):e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(y,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"Account Details"})}),e.jsx(v,{children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Email Address"}),e.jsx(p,{value:a==null?void 0:a.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Email cannot be changed manually. Contact support for assistance."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Display Name"}),e.jsx(p,{value:x||(a==null?void 0:a.name)||"",onChange:d=>m(d.target.value),placeholder:"Full Name"})]}),e.jsx("hr",{className:"my-6 border-border"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(C,{children:"Change Password"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"password",placeholder:"New Password",value:r,onChange:d=>u(d.target.value)}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center",children:"Minimum 8 characters"})]}),e.jsx(p,{type:"password",placeholder:"Confirm New Password",value:i,onChange:d=>n(d.target.value)})]})]}),e.jsx(c,{type:"submit",disabled:t,children:t?"Saving...":"Save Changes"})]})})]}),e.jsxs(y,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"Danger Zone"})}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Delete Account"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permanently delete your account and all associated data."})]}),e.jsx(c,{variant:"destructive",size:"sm",children:"Delete Account"})]})})]})]})}export{Pe as default};
