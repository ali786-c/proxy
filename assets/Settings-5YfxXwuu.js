import{j as e,S as k,Z as R,_ as B,r as t,I as p,a as m,t as d,k as E,i as j}from"./index-Cl2slAZZ.js";import{S as M}from"./SEOHead-DgXLMDjT.js";import{E as W}from"./ErrorBanner-DFePrb4P.js";import{E as Q}from"./EmptyState-DYYgFjyo.js";import{L as w}from"./label-BrxkBhDm.js";import{C as P,a as H,b as U,c as _}from"./card-B8OYlSOh.js";import{T as z,a as F,b as S,c as r,d as $,e as i}from"./table-CqP-QKlx.js";import{T as X,a as ee,b as L,c as D}from"./tabs-COxzwz7b.js";import{D as se,e as ae,a as te,b as le,c as re,f as ie,g as ne}from"./dialog-IgnHuk_m.js";import{K as G}from"./key-CwR5hdZB.js";import{L as I}from"./loader-circle-BAwQG-yb.js";import{P as O}from"./plus-BriIawa7.js";import{T as V}from"./trash-2-DmOGn-41.js";import{C as ce}from"./copy-Cjpj0xli.js";import"./circle-alert-B2Fw2rV4.js";function Ke(){return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Settings",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"}),e.jsxs(X,{defaultValue:"allowlist",children:[e.jsxs(ee,{children:[e.jsxs(L,{value:"allowlist",children:[e.jsx(k,{className:"mr-1 h-3.5 w-3.5"})," IP Allowlist"]}),e.jsxs(L,{value:"api-keys",children:[e.jsx(G,{className:"mr-1 h-3.5 w-3.5"})," API Keys"]})]}),e.jsx(D,{value:"allowlist",className:"mt-4",children:e.jsx(de,{})}),e.jsx(D,{value:"api-keys",className:"mt-4",children:e.jsx(me,{})})]})]})]})}function de(){const y=R(),{data:n,isLoading:A}=B({queryKey:["allowlist"],queryFn:()=>j.getAllowlist()}),[x,f]=t.useState(""),[K,g]=t.useState(""),[o,c]=t.useState(null),[u,v]=t.useState(!1),N=async()=>{c(null);const a=x.trim();if(!a){c("IP address is required.");return}if(!/^\d{1,3}(\.\d{1,3}){3}(\/\d{1,2})?$/.test(a)){c("Enter a valid IPv4 address or CIDR range.");return}v(!0);try{await j.addAllowlistEntry(a,K.trim()||void 0),y.invalidateQueries({queryKey:["allowlist"]}),f(""),g(""),d({title:"IP Added",description:`${a} added to allowlist.`})}catch(h){c(h.message)}finally{v(!0)}},C=async a=>{try{await j.removeAllowlistEntry(a),y.invalidateQueries({queryKey:["allowlist"]}),d({title:"Removed",description:"IP removed from allowlist."})}catch(h){d({title:"Error",description:h.message,variant:"destructive"})}};return e.jsxs(P,{children:[e.jsx(H,{children:e.jsx(U,{className:"text-lg",children:"IP Allowlist"})}),e.jsxs(_,{className:"space-y-4",children:[o&&e.jsx(W,{message:o,onDismiss:()=>c(null)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"203.0.113.0/24",value:x,onChange:a=>f(a.target.value),className:"max-w-xs"}),e.jsx(p,{placeholder:"Label (optional)",value:K,onChange:a=>g(a.target.value),className:"max-w-xs"}),e.jsxs(m,{onClick:N,disabled:u,children:[u?e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(O,{className:"mr-1 h-4 w-4"}),"Add"]})]}),A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(n==null?void 0:n.length)===0?e.jsx(Q,{icon:k,title:"No IPs allowlisted",description:"Add your server IPs to authenticate without credentials."}):e.jsxs(z,{children:[e.jsx(F,{children:e.jsxs(S,{children:[e.jsx(r,{children:"IP Address"}),e.jsx(r,{children:"Label"}),e.jsx(r,{children:"Added"}),e.jsx(r,{className:"w-12"})]})}),e.jsx($,{children:(n||[]).map(a=>e.jsxs(S,{children:[e.jsx(i,{className:"font-mono text-sm",children:a.ip}),e.jsx(i,{className:"text-sm text-muted-foreground",children:a.label??"—"}),e.jsx(i,{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),e.jsx(i,{children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>C(a.id),"aria-label":"Remove",children:e.jsx(V,{className:"h-4 w-4 text-destructive"})})})]},a.id))})]})]})]})}const oe=["proxy:generate","usage:read","allowlist:manage","keys:manage"];function me(){const y=R(),{data:n,isLoading:A}=B({queryKey:["api-keys"],queryFn:()=>j.getApiKeys()}),[x,f]=t.useState(null),[K,g]=t.useState(!1),[o,c]=t.useState(""),[u,v]=t.useState(""),[N,C]=t.useState(""),[a,h]=t.useState(""),[T,q]=t.useState(["proxy:generate"]),Y=s=>{q(l=>l.includes(s)?l.filter(b=>b!==s):[...l,s])},Z=async()=>{if(o.trim()){g(!0);try{const s=await j.createApiKey({name:o.trim(),allowed_countries:u?u.split(",").map(l=>l.trim().toUpperCase()):[],daily_gb_cap:N?Number(N):void 0,daily_request_cap:a?Number(a):void 0,allowed_scopes:T});y.invalidateQueries({queryKey:["api-keys"]}),f(s.key),c(""),v(""),C(""),h(""),q(["proxy:generate"]),d({title:"API Key Created",description:"Copy it now — it won't be shown again."})}catch(s){d({title:"Error",description:s.message,variant:"destructive"})}finally{g(!1)}}},J=async s=>{try{await j.revokeApiKey(s),y.invalidateQueries({queryKey:["api-keys"]}),d({title:"Revoked",description:"API key has been revoked."})}catch(l){d({title:"Error",description:l.message,variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4",children:[x&&e.jsx(P,{className:"border-primary",children:e.jsxs(_,{className:"flex items-center justify-between gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Your new API key (copy now — shown once):"}),e.jsx("code",{className:"mt-1 block text-xs font-mono text-primary",children:x})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(x),d({title:"Copied"})},children:[e.jsx(ce,{className:"mr-1 h-3.5 w-3.5"})," Copy"]})]})}),e.jsxs(P,{children:[e.jsxs(H,{className:"flex flex-row items-center justify-between",children:[e.jsx(U,{className:"text-lg",children:"API Keys"}),e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(m,{size:"sm",children:[e.jsx(O,{className:"mr-1 h-4 w-4"})," Create Key"]})}),e.jsxs(te,{children:[e.jsx(le,{children:e.jsx(re,{children:"Create API Key"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Key Name"}),e.jsx(p,{value:o,onChange:s=>c(s.target.value),placeholder:"Production"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Allowed Countries (comma-separated, optional)"}),e.jsx(p,{value:u,onChange:s=>v(s.target.value),placeholder:"US, UK, DE"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Daily GB Cap"}),e.jsx(p,{type:"number",value:N,onChange:s=>C(s.target.value),placeholder:"No limit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Daily Request Cap"}),e.jsx(p,{type:"number",value:a,onChange:s=>h(s.target.value),placeholder:"No limit"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Scopes"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map(s=>e.jsx(E,{variant:T.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>Y(s),children:s},s))})]})]}),e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"Cancel"})}),e.jsx(m,{onClick:Z,disabled:!o.trim(),children:"Create"})]})]})]})]}),e.jsx(_,{className:"p-0",children:A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(n==null?void 0:n.length)===0?e.jsx("div",{className:"p-6",children:e.jsx(Q,{icon:G,title:"No API keys",description:"Create a key to access the UpgradedProxy API programmatically."})}):e.jsxs(z,{children:[e.jsx(F,{children:e.jsxs(S,{children:[e.jsx(r,{children:"Name"}),e.jsx(r,{children:"Key"}),e.jsx(r,{children:"Scopes"}),e.jsx(r,{children:"Limits"}),e.jsx(r,{children:"Last Used"}),e.jsx(r,{className:"w-12"})]})}),e.jsx($,{children:(n||[]).map(s=>{var l;return e.jsxs(S,{children:[e.jsx(i,{className:"font-medium text-sm",children:s.name}),e.jsx(i,{className:"font-mono text-xs",children:s.key_prefix}),e.jsx(i,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(l=s.allowed_scopes)==null?void 0:l.map(b=>e.jsx(E,{variant:"secondary",className:"text-[10px]",children:b},b))})}),e.jsxs(i,{className:"text-xs text-muted-foreground",children:[s.daily_gb_cap?`${s.daily_gb_cap} GB/d`:"—",s.daily_request_cap?` / ${s.daily_request_cap.toLocaleString()} req/d`:""]}),e.jsx(i,{className:"text-xs text-muted-foreground",children:s.last_used_at?new Date(s.last_used_at).toLocaleDateString():"Never"}),e.jsx(i,{children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>J(s.id),"aria-label":"Revoke",children:e.jsx(V,{className:"h-4 w-4 text-destructive"})})})]},s.id)})})]})})]})]})}export{Ke as default};
