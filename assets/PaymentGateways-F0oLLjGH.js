import{j as e,x as j}from"./ui-DhchgSRK.js";import{r as c,aA as v,t as K,W,aw as k,b0 as D,a1 as p,a9 as q,ar as z,aH as R,a2 as U}from"./vendor-Dios4bpT.js";import{S as Y}from"./SEOHead-CjChOdX1.js";import{C as N,a as H,b as O,c as C}from"./card-ClKFnvWz.js";import{j as Q,d as V,k as J,I as X,t as _,x as S,M as Z,B as y,a6 as ee,s as se}from"./index-CWrgTXZn.js";import{L as w}from"./label-CHENNY20.js";import{S as ae}from"./switch-D9iDOXel.js";import{u as te}from"./useMutation-DegG07yA.js";import{D as re}from"./use-backend-Cmgkz6zt.js";const ie=[{id:"crypto",name:"!!! PAY VIA BINANCE ID (MANUAL) !!!",icon:v,fields:[{key:"binance_pay_id",label:"Binance Merchant ID",placeholder:"786...",value:""},{key:"binance_pay_instructions",label:"Payment Instructions",placeholder:"Send USDT and upload proof...",value:""}]},{id:"stripe",name:"Stripe",icon:K,fields:[{key:"stripe_publishable_key",label:"Publishable Key",placeholder:"pk_live_...",value:"",secret:!1},{key:"stripe_secret_key",label:"Secret Key",placeholder:"sk_live_...",value:"",secret:!0},{key:"stripe_webhook_secret",label:"Webhook Secret",placeholder:"whsec_...",value:"",secret:!0}]},{id:"paypal",name:"PayPal",icon:W,fields:[{key:"paypal_client_id",label:"Client ID",placeholder:"AV...",value:""},{key:"paypal_client_secret",label:"Client Secret",placeholder:"EL...",value:""},{key:"paypal_mode",label:"Mode (sandbox/live)",placeholder:"sandbox",value:""}]},{id:"cryptomus",name:"Cryptomus (Automated Crypto)",icon:v,fields:[{key:"cryptomus_merchant_id",label:"Merchant ID",placeholder:"UUID-...",value:""},{key:"cryptomus_api_key",label:"Payment/API Key",placeholder:"Your API key",value:"",secret:!0},{key:"cryptomus_webhook_secret",label:"Webhook/Sign Key",placeholder:"Your webhook key",value:"",secret:!0}]}];function he(){const $=Q(),{gateways:E,toggleGateway:I}=V(),[h,x]=c.useState(ie),[f,P]=c.useState({}),{data:m={},isLoading:A}=J({queryKey:["admin","settings"],queryFn:()=>S.get("/admin/settings",ee(se()))}),[u,b]=c.useState(!1),{data:l,isLoading:d,refetch:L}=re(u),G=async()=>{b(!0)};c.useEffect(()=>{u&&!d&&b(!1)},[d,u]);const o=te({mutationFn:s=>S.post("/admin/settings",Z,s),onSuccess:()=>{$.invalidateQueries({queryKey:["admin","settings"]}),L(),_({title:"Configuration Saved",description:"Gateway settings have been updated and verified."})},onError:()=>_({title:"Save Failed",description:"Could not save settings to backend.",variant:"destructive"})}),[g,M]=c.useState(!1);c.useEffect(()=>{Object.keys(m).length>0&&!g&&(x(s=>s.map(t=>({...t,fields:t.fields.map(r=>({...r,value:m[r.key]||""}))}))),M(!0))},[m,g]);const T=(s,t,r)=>{x(i=>i.map(a=>a.id===s?{...a,fields:a.fields.map(n=>n.key===t?{...n,value:r}:n)}:a))},B=s=>{const t=h.find(i=>i.id===s);if(!t)return;const r={};t.fields.forEach(i=>{r[i.key]=i.value}),o.mutate(r)},F=s=>{var r;const t=(r=l==null?void 0:l.gateways)==null?void 0:r.find(i=>i.id===s);return t?t.status==="connected"?e.jsxs(y,{variant:"default",className:"bg-success text-success-foreground hover:bg-success/90 gap-1",children:[e.jsx(U,{className:"h-3 w-3"})," Connected"]}):t.status==="error"?e.jsxs(y,{variant:"destructive",className:"gap-1",children:[e.jsx(p,{className:"h-3 w-3"})," Config Error"]}):e.jsx(y,{variant:"secondary",children:"Not Configured"}):null};return A?e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Payment Gateways",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Payment Gateways"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure and enable payment methods for clients."})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>G(),disabled:d,className:"gap-2",children:[e.jsx(D,{className:`h-4 w-4 ${d?"animate-spin":""}`})," Verify Status"]})]}),e.jsx("div",{className:"grid gap-6",children:h.map(s=>{var r,i;const t=E[s.id];return e.jsxs(N,{className:t?"border-primary/30 ring-1 ring-primary/10 shadow-sm":"opacity-70",children:[e.jsx(H,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:`rounded-lg p-2 ${t?"bg-primary/10":"bg-muted"}`,children:e.jsx(s.icon,{className:`h-5 w-5 ${t?"text-primary":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s.name,F(s.id)]}),t&&((i=(r=l==null?void 0:l.gateways)==null?void 0:r.find(a=>a.id===s.id))==null?void 0:i.webhook_health)==="missing"&&e.jsxs("span",{className:"text-[10px] text-destructive flex items-center gap-1 font-normal mt-1",children:[e.jsx(p,{className:"h-2.5 w-2.5"})," Webhook secret missing - payments won't auto-credit"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-muted/50 py-1 px-3 rounded-full",children:[e.jsx(w,{htmlFor:`toggle-${s.id}`,className:"text-xs font-medium cursor-pointer",children:t?"Live for Clients":"Disabled"}),e.jsx(ae,{id:`toggle-${s.id}`,checked:t,onCheckedChange:()=>{I(s.id),o.mutate({[`gateway_${s.id}_enabled`]:t?"0":"1"})}})]})]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.fields.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-[11px] uppercase tracking-wider text-muted-foreground font-semibold",children:a.label}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{id:`${s.id}-${a.key}`,name:`${s.id}-${a.key}`,type:a.secret?f[`${s.id}-${a.key}`]?"text":"password":"text",placeholder:a.placeholder,value:a.value,onChange:n=>T(s.id,a.key,n.target.value),className:"bg-muted/30 focus-visible:ring-primary/20",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),a.secret&&e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>P(n=>({...n,[`${s.id}-${a.key}`]:!n[`${s.id}-${a.key}`]})),children:f[`${s.id}-${a.key}`]?e.jsx(q,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"})})]})]},a.key))}),e.jsxs("div",{className:"pt-2 flex items-center justify-between border-t border-muted",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Changes take effect immediately across the platform."}),e.jsxs(j,{onClick:()=>B(s.id),className:"gap-2",size:"sm",disabled:o.isPending,children:[o.isPending?e.jsx(k,{className:"h-4 w-4 animate-spin"}):e.jsx(R,{className:"h-4 w-4"}),"Save ",s.name," Config"]})]})]})]},s.id)})}),e.jsx(N,{className:"border-dashed bg-muted/20",children:e.jsxs(C,{className:"pt-6 text-center text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center justify-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-warning"})," Security Implementation"]}),e.jsx("p",{className:"max-w-md mx-auto",children:"These keys are stored in the system database. Ensure your backend environment is secured and database is properly firewalled."})]})})]})]})}export{he as default};
