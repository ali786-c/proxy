import{r as p,Y as b,j as e,I as T,y,z as v,E as C,J as L,K as j,M as A,p as g,s as r,aN as f,aj as I,ao as O}from"./index-D6dWZ1IX.js";import{S as E}from"./SEOHead-DFHjZ5P0.js";import{C as F,c as P}from"./card-Dkjg3cB_.js";import{B as R}from"./badge-RpOJCILK.js";import{T as q,a as B,b as c,c as n,d as H,e as i}from"./table-BGTyX-D9.js";import{S as M}from"./search-816HyIoW.js";const V=g({id:f(),action:r(),details:r().nullable(),target_user_id:f().nullable(),created_at:r(),admin:g({name:r()}).nullable()}),k={ban_user:"destructive",deduct:"destructive",unban_user:"default",top_up:"default",update:"secondary",reply:"secondary",create:"default",update_balance:"default"};function U(){const[l,_]=p.useState(""),[d,N]=p.useState("all"),{data:m,isLoading:o}=b({queryKey:["audit-log",d],queryFn:async()=>(await I.get(`/admin/logs?action=${d}`,O(V))).map(t=>{var s;return{id:String(t.id),created_at:t.created_at,action:t.action,target_id:String(t.target_user_id||""),ip_address:"Internal",admin_name:((s=t.admin)==null?void 0:s.name)??"System",metadata:{details:t.details}}})}),x=(m??[]).filter(a=>{var s,u,h;if(!l)return!0;const t=l.toLowerCase();return a.action.toLowerCase().includes(t)||((s=a.target_id)==null?void 0:s.toLowerCase().includes(t))||((u=a.ip_address)==null?void 0:u.toLowerCase().includes(t))||((h=a.geo_country)==null?void 0:h.toLowerCase().includes(t))}),S=[...new Set((m??[]).map(a=>a.action.split("_")[0]))],w=a=>new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"Admin — Audit Log",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review all system-wide activity with IP & geo tracking."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(M,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(T,{placeholder:"Search action, target, IP, country…",value:l,onChange:a=>_(a.target.value),className:"pl-9"})]}),e.jsxs(y,{value:d,onValueChange:N,children:[e.jsx(v,{className:"w-[150px]",children:e.jsx(C,{placeholder:"Action type"})}),e.jsxs(L,{children:[e.jsx(j,{value:"all",children:"All actions"}),S.map(a=>e.jsx(j,{value:a,className:"capitalize",children:a},a))]})]})]}),e.jsx(F,{children:e.jsx(P,{className:"p-0",children:e.jsxs(q,{children:[e.jsx(B,{children:e.jsxs(c,{children:[e.jsx(n,{children:"Timestamp"}),e.jsx(n,{children:"Action"}),e.jsx(n,{children:"Target"}),e.jsx(n,{children:"IP Address"}),e.jsx(n,{children:"Location"}),e.jsx(n,{children:"Meta"})]})}),e.jsxs(H,{children:[o&&e.jsx(c,{children:e.jsx(i,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"Loading…"})}),!o&&x.map(a=>{var s;const t=a.action.split("_")[0];return e.jsxs(c,{children:[e.jsx(i,{className:"text-sm text-muted-foreground whitespace-nowrap",children:w(a.created_at)}),e.jsx(i,{children:e.jsx(R,{variant:k[t]??"outline",className:"text-xs",children:a.action})}),e.jsx(i,{className:"text-sm font-mono text-xs",children:((s=a.target_id)==null?void 0:s.slice(0,8))??"—"}),e.jsx(i,{className:"text-sm font-mono text-xs",children:a.ip_address??"—"}),e.jsx(i,{className:"text-sm",children:a.geo_country?e.jsxs("span",{className:"flex items-center gap-1 text-xs",children:[e.jsx(A,{className:"h-3 w-3"}),a.geo_city?`${a.geo_city}, `:"",a.geo_country]}):"—"}),e.jsx(i,{className:"text-xs text-muted-foreground max-w-[200px] truncate",children:a.metadata&&Object.keys(a.metadata).length>0?JSON.stringify(a.metadata):"—"})]},a.id)}),!o&&x.length===0&&e.jsx(c,{children:e.jsx(i,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No audit entries found."})})]})]})})})]})]})}export{U as default};
