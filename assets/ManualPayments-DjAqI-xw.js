import{j as e,x as y,y as R,z as $,A as F,E as H,H as q}from"./ui-DX3or849.js";import{v as i,M as b,x as m,w as I,a2 as P,o,s,_ as p,Q as r,a3 as x,a1 as L,a4 as U,j as z,k as K,B as S,I as Q,t as T}from"./index-BV37k1rB.js";import{u as X}from"./useMutation-CebBY9Yo.js";import{S as O}from"./SEOHead-BH3wptKB.js";import{C as V,a as G,b as J,c as W}from"./card-DSnBPwJC.js";import{T as Y,a as Z,b as g,c as d,d as ee,e as l}from"./table-C6Yo1Rvr.js";import{r as A,an as se,X as ae,d as te}from"./vendor-Dttvuw5L.js";import{L as D}from"./label-4iBZNAPj.js";const ne=o({total_users:r(),active_subs:r(),bandwidth_30d_gb:r(),error_rate:r(),top_geos:m(o({country:s(),bandwidth_gb:r()}))}),B=o({id:s(),email:s(),name:s(),role:x(["client","admin"]),status:x(["active","suspended","pending"]),plan:s(),allowlist_count:r(),keys_count:r(),bandwidth_used_gb:r(),created_at:s()});o({status:x(["active","suspended"]).optional(),role:x(["client","admin"]).optional(),daily_gb_cap:r().optional(),reset_keys:p().optional()});const f=o({id:s(),name:s(),proxy_type:s(),price_per_gb:r(),included_gb:r(),monthly_price:r(),is_active:p()});o({name:s().min(1),proxy_type:s().min(1),price_per_gb:r().min(0),included_gb:r().min(0),monthly_price:r().min(0),is_active:p()});const re=o({id:s(),actor:s(),action:s(),target:s().optional(),meta:L(U()).optional(),timestamp:s()}),ie=o({id:s(),title:s(),slug:s(),status:x(["draft","queued","published"]),keywords:m(s()),author:s(),created_at:s(),published_at:s().nullable()}),E=o({error_spike_pct:r(),ban_spike_pct:r(),spend_cap_usd:r(),unusual_geo_threshold:r(),notify_email:p(),notify_webhook:p(),webhook_url:s()}),M={getKpis:()=>i.get("/admin/kpis",ne),getUsers:a=>i.get(`/admin/users${a?`?${a}`:""}`,P(B)),patchUser:(a,t)=>i.patch(`/admin/users/${a}`,B,t),getProducts:()=>i.get("/admin/products",m(f)),createProduct:a=>i.post("/admin/products",f,a),updateProduct:(a,t)=>i.patch(`/admin/products/${a}`,f,t),getAudit:a=>i.get(`/admin/audit${a?`?${a}`:""}`,P(re)),getBlogPosts:()=>i.get("/admin/blog/posts",m(ie)),publishPost:(a,t)=>i.post("/admin/blog/publish",b,{id:a,scheduled_at:t}),regeneratePost:a=>i.post("/admin/blog/regenerate",b,{id:a}),getAlertConfig:()=>i.get("/admin/alerts",E),updateAlertConfig:a=>i.patch("/admin/alerts",E,a),getPendingCrypto:()=>i.get("/admin/crypto/pending",m(I())),approveCrypto:(a,t,c)=>i.post(`/admin/crypto/${a}/approve`,b,{status:t,admin_note:c})};function he(){var k;const a=z(),[t,c]=A.useState(null),[N,_]=A.useState(""),{data:v=[],isLoading:C}=K({queryKey:["admin-pending-crypto"],queryFn:()=>M.getPendingCrypto()}),j=X({mutationFn:({id:n,status:u,note:h})=>M.approveCrypto(n,u,h),onSuccess:n=>{T({title:"Success",description:n.message}),a.invalidateQueries({queryKey:["admin-pending-crypto"]}),c(null),_("")},onError:n=>{T({title:"Error",description:n.message,variant:"destructive"})}}),w=n=>{t&&j.mutate({id:t.id,status:n,note:N})};return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Manual Payment Verification",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Manual Payment Verification"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Review and approve crypto transactions submitted by users."})]}),e.jsxs(V,{children:[e.jsx(G,{children:e.jsxs(J,{className:"text-lg flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-amber-500"})," Pending Review"]})}),e.jsx(W,{className:"p-0",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(g,{children:[e.jsx(d,{children:"User"}),e.jsx(d,{children:"Currency"}),e.jsx(d,{children:"Amount"}),e.jsx(d,{children:"TXID"}),e.jsx(d,{children:"Submitted"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsxs(ee,{children:[C?e.jsx(g,{children:e.jsx(l,{colSpan:6,className:"h-24 text-center",children:"Loading pending payments..."})}):v.map(n=>{var u,h;return e.jsxs(g,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:(u=n.user)==null?void 0:u.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:(h=n.user)==null?void 0:h.email})]})}),e.jsx(l,{children:e.jsx(S,{variant:"outline",children:n.currency})}),e.jsxs(l,{className:"font-semibold",children:["€",Number(n.amount).toFixed(2)]}),e.jsx(l,{className:"font-mono text-[10px] max-w-[150px] truncate",children:n.txid}),e.jsx(l,{className:"text-xs text-muted-foreground",children:new Date(n.created_at).toLocaleString()}),e.jsx(l,{className:"text-right space-x-2",children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>c(n),children:"Review"})})]},n.id)}),!C&&v.length===0&&e.jsx(g,{children:e.jsx(l,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No pending transactions."})})]})]})})]})]}),e.jsx(R,{open:!!t,onOpenChange:n=>!n&&c(null),children:e.jsxs($,{children:[e.jsx(F,{children:e.jsx(H,{children:"Process Crypto Payment"})}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"User:"}),e.jsx("span",{className:"font-medium",children:(k=t.user)==null?void 0:k.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-primary",children:["€",Number(t.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Currency:"}),e.jsx(S,{variant:"secondary",children:t.currency})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"TXID:"}),e.jsx("span",{className:"font-mono text-[10px] break-all bg-background p-1.5 rounded border",children:t.txid||"N/A"})]}),t.binance_id&&e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Binance ID:"}),e.jsx("span",{className:"font-mono text-[10px] break-all bg-background p-1.5 rounded border",children:t.binance_id})]})]}),t.proof_url&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Proof Screenshot"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-background",children:e.jsx("img",{src:t.proof_url,alt:"Payment Proof",className:"max-h-[300px] w-full object-contain cursor-zoom-in",onClick:()=>window.open(t.proof_url,"_blank")})}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center italic",children:"Click image to view full size"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Admin Note (optional)"}),e.jsx(Q,{placeholder:"Reason for rejection or internal note...",value:N,onChange:n=>_(n.target.value)})]})]}),e.jsxs(q,{className:"gap-2",children:[e.jsxs(y,{variant:"destructive",className:"gap-2",onClick:()=>w("rejected"),disabled:j.isPending,children:[e.jsx(ae,{className:"h-4 w-4"})," Reject"]}),e.jsxs(y,{className:"gap-2",onClick:()=>w("approved"),disabled:j.isPending,children:[e.jsx(te,{className:"h-4 w-4"})," Approve & Credit Balance"]})]})]})})]})}export{he as default};
