import{r,j as e,P as E,B as i,I as H,q as A,v as M,w as Y,x as F,y as j,p as q,t as d}from"./index-CZjjzW98.js";import{S as z}from"./SEOHead-BQntEyAM.js";import{C as T,a as V,b as G,c as w}from"./card-B5Gfyd7p.js";import{L as g}from"./label-C7s9DKkj.js";import{T as k}from"./textarea-CAE5aKsT.js";import{B as y}from"./badge-BpWL1baF.js";import{D as U,a as $,b as J,c as K,d as Q,e as W,g as X}from"./dialog-DxFlqzkX.js";import{T as Z,a as ee,b as D,c as x,d as se,e as m}from"./table-s1GjQ5ZU.js";import{E as ae}from"./EmptyState-DHkUx2GI.js";import{l as te}from"./use-backend-C-fVTGhT.js";import{P as re}from"./plus-B7Txo7Wn.js";import{C as P}from"./circle-check-JKXDKr-6.js";import{C as ie}from"./clock-OBO7u3-H.js";import{C as le}from"./circle-alert-Z2gZLUsP.js";import"./useQuery-CPO4fHLH.js";import"./useMutation-DDTMDbh5.js";import"./api-BTF2QDx4.js";const ce={open:{color:"secondary",icon:le},in_progress:{color:"default",icon:ie},resolved:{color:"outline",icon:P},closed:{color:"outline",icon:P}},_={low:"secondary",normal:"default",high:"destructive"};function Te(){const{data:a,isLoading:I,createTicket:p,replyTicket:h}=te(),[l,f]=r.useState(""),[v,L]=r.useState("normal"),[c,N]=r.useState(""),[O,S]=r.useState(!1),[u,b]=r.useState(null),[n,C]=r.useState(""),t=a==null?void 0:a.find(s=>s.id===u),R=async()=>{if(!(!l.trim()||!c.trim()))try{await p.mutateAsync({subject:l,message:c,priority:v}),f(""),N(""),S(!1),d({title:"Ticket Created",description:"Your support ticket has been submitted."})}catch(s){d({title:"Error",description:s.message,variant:"destructive"})}},B=async()=>{if(!(!n.trim()||!u))try{await h.mutateAsync({id:u,message:n}),C(""),d({title:"Reply Sent"})}catch(s){d({title:"Error",description:s.message,variant:"destructive"})}};return I?e.jsx(E,{}):e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Support",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Support Tickets"}),e.jsxs(U,{open:O,onOpenChange:S,children:[e.jsx($,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(re,{className:"mr-1 h-4 w-4"})," New Ticket"]})}),e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(Q,{children:"Create Support Ticket"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(g,{children:"Subject"}),e.jsx(H,{value:l,onChange:s=>f(s.target.value),placeholder:"Brief description of your issue"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(g,{children:"Priority"}),e.jsxs(A,{value:v,onValueChange:L,children:[e.jsx(M,{children:e.jsx(Y,{})}),e.jsxs(F,{children:[e.jsx(j,{value:"low",children:"Low"}),e.jsx(j,{value:"normal",children:"Normal"}),e.jsx(j,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(g,{children:"Message"}),e.jsx(k,{value:c,onChange:s=>N(s.target.value),placeholder:"Describe your issue in detail...",rows:4})]})]}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(i,{variant:"outline",children:"Cancel"})}),e.jsx(i,{onClick:R,disabled:!l.trim()||!c.trim()||p.isPending,children:p.isPending?"Submitting…":"Submit Ticket"})]})]})]})]}),t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>b(null),children:"← Back to Tickets"}),e.jsxs(T,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-lg",children:t.subject}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-primary italic lowercase",children:["#",t.id," · ",t.status.replace("_"," ")]})]}),e.jsx(y,{variant:_[t.priority]??"secondary",children:t.priority})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:(t.messages??[]).map((s,o)=>e.jsxs("div",{className:`rounded-lg p-3 text-sm ${s.is_admin_reply?"bg-primary/5 mr-8 border border-primary/10":"bg-muted ml-8"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-bold text-xs",children:s.is_admin_reply?"Support Ninja":"You"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.message})]},o))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:n,onChange:s=>C(s.target.value),placeholder:"Type your message...",rows:2,className:"flex-1"}),e.jsx(i,{onClick:B,disabled:!n.trim()||h.isPending,className:"self-end",children:h.isPending?"Sending...":"Send"})]})]})]})]}):a!=null&&a.length?e.jsx(T,{children:e.jsx(w,{className:"p-0",children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(D,{children:[e.jsx(x,{children:"Subject"}),e.jsx(x,{children:"Priority"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Created"})]})}),e.jsx(se,{children:a.map(s=>{var o;return e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>b(s.id),children:[e.jsx(m,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.subject}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["#",s.id]})]})}),e.jsx(m,{children:e.jsx(y,{variant:_[s.priority]??"secondary",className:"text-[10px]",children:s.priority})}),e.jsx(m,{children:e.jsx(y,{variant:((o=ce[s.status])==null?void 0:o.color)??"secondary",className:"text-[10px] capitalize",children:s.status.replace("_"," ")})}),e.jsx(m,{className:"text-right text-xs text-muted-foreground",children:s.created_at?new Date(s.created_at).toLocaleDateString():"—"})]},s.id)})})]})})}):e.jsx(ae,{icon:q,title:"No tickets",description:"You haven't created any support tickets yet."})]})]})}export{Te as default};
