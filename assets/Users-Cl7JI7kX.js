import{c as w,r as f,j as e,_ as z,I as _,aJ as E,aK as O,aL as $,aM as H,aN as I,D as J,aO as Q,a as y,S as V,t as x,i as D,U as Z,ae as u}from"./index-BUT0sXTI.js";import{S as G}from"./SEOHead-BCkjpzGJ.js";import{C as g,c as v}from"./card-DLfvWdew.js";import{B as T}from"./badge-4qiJzpXv.js";import{L as F}from"./label-C1zToKJ6.js";import{T as W,a as X,b as S,c as h,d as Y,e as m}from"./table-BPHTtwtd.js";import{u as ee}from"./useMutation-B77yjbCU.js";import{S as se}from"./search-ZkFKJtoo.js";import{K as ae}from"./key-Zxt-LDnu.js";import{P as te}from"./plus-Bs9G_gr8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=w("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=w("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=w("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);function de(){return D({queryKey:["admin-users"],queryFn:async()=>(await u.get("/admin/users",n=>n)).map(n=>({...n,full_name:n.name,user_id:n.id,is_banned:n.role==="banned",user_roles:[{role:n.role}]}))})}function ie(){const l=Z();return ee({mutationFn:async n=>{const{action:r,...i}=n;if(r==="list_users")return u.get("/admin/users",c=>c);if(r==="ban_user"||r==="unban_user")return u.post("/admin/users/ban",c=>c,{user_id:i.user_id,reason:i.ban_reason||(r==="ban_user"?"Banned by admin":"Unbanned by admin")});if(r==="adjust_balance")return u.post("/admin/users/balance",c=>c,{user_id:i.user_id,amount:i.amount,reason:i.reason||"Admin adjustment"});if(r==="get_user_stats")return u.get("/admin/stats",c=>c);throw new Error("Action not supported in Laravel bridge")},onSuccess:()=>l.invalidateQueries({queryKey:["admin-users"]})})}function ce(l){return D({queryKey:["admin-user-stats",l],enabled:!!l,queryFn:async()=>u.get(`/admin/users/${l}/stats`,n=>n)})}function Ne(){var B,U,L;const{data:l,isLoading:n}=de(),r=ie(),[i,c]=f.useState(""),[a,j]=f.useState(null),[p,N]=f.useState(""),[C,b]=f.useState(""),{data:o}=ce((a==null?void 0:a.user_id)??null);if(n)return e.jsx(z,{});const k=(l??[]).filter(s=>{var t,d;return!(i&&!((t=s.email)!=null&&t.toLowerCase().includes(i.toLowerCase()))&&!((d=s.full_name)!=null&&d.toLowerCase().includes(i.toLowerCase())))}),q=async(s,t)=>{try{await r.mutateAsync({action:t?"unban_user":"ban_user",user_id:s,ban_reason:t?void 0:"Violated terms of service"}),j(null),x({title:t?"User unbanned":"User banned"})}catch(d){x({title:"Error",description:d.message,variant:"destructive"})}},A=async s=>{const t=parseFloat(p);if(!t||t<=0){x({title:"Invalid amount",variant:"destructive"});return}try{const d=await r.mutateAsync({action:"adjust_balance",user_id:a.user_id,amount:s?t:-t,reason:C||(s?"Admin top-up":"Admin deduction")});N(""),b(""),j(M=>M?{...M,balance:d.new_balance}:null),x({title:`Balance ${s?"topped up":"deducted"} successfully`})}catch(d){x({title:"Error",description:d.message,variant:"destructive"})}},K=(l??[]).length,P=(l??[]).filter(s=>s.is_banned).length,R=(l??[]).reduce((s,t)=>s+Number(t.balance??0),0);return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Admin — Users",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all registered users, balances, and access."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(g,{children:e.jsxs(v,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})}),e.jsx(g,{children:e.jsxs(v,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Banned Users"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:P})]})}),e.jsx(g,{children:e.jsxs(v,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total User Balances"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",R.toFixed(2)]})]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(se,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(_,{placeholder:"Search by name or email…",value:i,onChange:s=>c(s.target.value),className:"pl-9"})]})}),e.jsx(g,{children:e.jsx(v,{className:"p-0",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(S,{children:[e.jsx(h,{children:"User"}),e.jsx(h,{children:"Role"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Balance"}),e.jsx(h,{children:"Joined"})]})}),e.jsxs(Y,{children:[k.map(s=>{var t,d;return e.jsxs(S,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>j(s),children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(m,{className:"capitalize",children:((d=(t=s.user_roles)==null?void 0:t[0])==null?void 0:d.role)??"client"}),e.jsx(m,{children:e.jsx(T,{variant:s.is_banned?"destructive":"default",children:s.is_banned?"Banned":"Active"})}),e.jsxs(m,{children:["$",Number(s.balance??0).toFixed(2)]}),e.jsx(m,{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()})]},s.id)}),k.length===0&&e.jsx(S,{children:e.jsx(m,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No users found."})})]})]})})})]}),e.jsx(E,{open:!!a,onOpenChange:()=>{j(null),N(""),b("")},children:e.jsx(O,{className:"sm:max-w-lg overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx(H,{children:a.full_name||"User"}),e.jsx(I,{children:a.email})]}),e.jsxs("div",{className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:((U=(B=a.user_roles)==null?void 0:B[0])==null?void 0:U.role)??"client"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx(T,{variant:a.is_banned?"destructive":"default",children:a.is_banned?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:"font-medium text-lg",children:["$",Number(a.balance??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString()})]})]}),o&&e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"User Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"font-medium",children:["€",((L=o.total_spent)==null?void 0:L.toFixed(2))??"0.00"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsxs("p",{className:"font-medium",children:[o.active_orders??0," active / ",o.total_orders??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"API Keys"}),e.jsxs("p",{className:"font-medium",children:[o.active_keys??0," active / ",o.total_keys??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tickets"}),e.jsxs("p",{className:"font-medium",children:[o.open_tickets??0," open / ",o.total_tickets??0," total"]})]})]})]})]}),a.ban_reason&&e.jsxs("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx("strong",{children:"Ban reason:"})," ",a.ban_reason]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Adjust Balance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(_,{id:"amount",type:"number",min:"0.01",step:"0.01",placeholder:"e.g. 50.00",value:p,onChange:s=>N(s.target.value)}),e.jsx(F,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(_,{id:"reason",placeholder:"e.g. Manual credit for support case",value:C,onChange:s=>b(s.target.value)}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(y,{size:"sm",onClick:()=>A(!0),disabled:r.isPending||!p,className:"flex-1",children:[e.jsx(te,{className:"mr-1 h-4 w-4"})," Top Up"]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>A(!1),disabled:r.isPending||!p,className:"flex-1",children:[e.jsx(ne,{className:"mr-1 h-4 w-4"})," Deduct"]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Access Control"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(y,{variant:a.is_banned?"default":"destructive",size:"sm",onClick:()=>q(a.user_id,a.is_banned),disabled:r.isPending,children:[a.is_banned?e.jsx(V,{className:"mr-2 h-4 w-4"}):e.jsx(re,{className:"mr-2 h-4 w-4"}),a.is_banned?"Unban User":"Ban User"]})})]})]})]})})})]})}export{Ne as default};
