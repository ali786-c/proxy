import{U as z,r as L,j as e,A as B,a as m,I as h,t as j,i as C}from"./index-BUbETakz.js";import{u as D}from"./useMutation-BBlCQ__n.js";import{s as u}from"./client-DBtcxyoE.js";import{C as o,a as M,b as P,c as x}from"./card-DX_4htAf.js";import{B as y}from"./badge-X0ZTVhbe.js";import{L as g}from"./label-SIQxsXuV.js";import{T as f,a as _,b as d,c as i,d as v,e as r}from"./table-DfcVc9DS.js";import{T as H,a as K,b as N,c as b}from"./tabs-DwchOpWN.js";import{D as O,a as E,b as I,c as Q,d as G}from"./dialog-DJUmwZgj.js";import{P as $}from"./plus-F924Jpxw.js";import{C as R}from"./circle-check-big-naKnNJu9.js";import{f as V}from"./format-sbWH3_uq.js";const W={up:"bg-green-500",degraded:"bg-yellow-500",down:"bg-destructive"};function J(){return C({queryKey:["sla-configs"],queryFn:async()=>{const{data:n,error:a}=await u.from("sla_configs").select("*").order("proxy_type");if(a)throw a;return n??[]}})}function X(){return C({queryKey:["uptime-records"],queryFn:async()=>{const{data:n,error:a}=await u.from("uptime_records").select("*").order("checked_at",{ascending:!1}).limit(200);if(a)throw a;return n??[]}})}function Y(){return C({queryKey:["sla-credits"],queryFn:async()=>{const{data:n,error:a}=await u.from("sla_credits").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;return n??[]}})}function xe(){const{data:n}=J(),{data:a}=X(),{data:l}=Y(),S=z(),[F,w]=L.useState(!1),[c,p]=L.useState({proxy_type:"",guaranteed_uptime:"99.9",credit_per_percent:"5"}),T=D({mutationFn:async()=>{const{error:s}=await u.from("sla_configs").insert({proxy_type:c.proxy_type,guaranteed_uptime:parseFloat(c.guaranteed_uptime),credit_per_percent:parseFloat(c.credit_per_percent)});if(s)throw s},onSuccess:()=>{S.invalidateQueries({queryKey:["sla-configs"]}),j({title:"SLA config created"}),w(!1)},onError:s=>j({title:"Error",description:s.message,variant:"destructive"})}),q=D({mutationFn:async s=>{const{error:t}=await u.from("sla_credits").update({status:"approved"}).eq("id",s);if(t)throw t},onSuccess:()=>{S.invalidateQueries({queryKey:["sla-credits"]}),j({title:"Credit approved"})}}),U=(a==null?void 0:a.reduce((s,t)=>(s[t.proxy_type]||(s[t.proxy_type]={total:0,up:0}),s[t.proxy_type].total++,t.status==="up"&&s[t.proxy_type].up++,s),{}))??{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(B,{className:"h-6 w-6"})," SLA Monitoring"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track uptime guarantees and manage credits"})]}),e.jsxs(O,{open:F,onOpenChange:w,children:[e.jsx(E,{asChild:!0,children:e.jsxs(m,{children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Add SLA Config"]})}),e.jsxs(I,{children:[e.jsx(Q,{children:e.jsx(G,{children:"Create SLA Configuration"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Proxy Type"}),e.jsx(h,{placeholder:"e.g. residential",value:c.proxy_type,onChange:s=>p(t=>({...t,proxy_type:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Guaranteed Uptime (%)"}),e.jsx(h,{type:"number",step:"0.1",value:c.guaranteed_uptime,onChange:s=>p(t=>({...t,guaranteed_uptime:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Credit per % Downtime"}),e.jsx(h,{type:"number",value:c.credit_per_percent,onChange:s=>p(t=>({...t,credit_per_percent:s.target.value}))})]})]}),e.jsx(m,{onClick:()=>T.mutate(),disabled:T.isPending,className:"w-full",children:"Create"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[n==null?void 0:n.map(s=>{const t=U[s.proxy_type],k=t?(t.up/t.total*100).toFixed(2):"N/A",A=t?t.up/t.total*100>=Number(s.guaranteed_uptime):!0;return e.jsxs(o,{children:[e.jsx(M,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium capitalize",children:s.proxy_type})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[k,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["SLA: ",Number(s.guaranteed_uptime),"%"]}),e.jsx(y,{variant:A?"default":"destructive",className:"mt-2",children:A?"SLA Met":"SLA Breached"})]})]},s.id)}),!(n!=null&&n.length)&&e.jsx(o,{className:"md:col-span-4",children:e.jsx(x,{className:"py-8 text-center text-muted-foreground",children:"No SLA configs. Create one to start monitoring."})})]}),e.jsxs(H,{defaultValue:"uptime",children:[e.jsxs(K,{children:[e.jsx(N,{value:"uptime",children:"Uptime Records"}),e.jsx(N,{value:"credits",children:"SLA Credits"}),e.jsx(N,{value:"configs",children:"Configurations"})]}),e.jsx(b,{value:"uptime",children:e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(d,{children:[e.jsx(i,{children:"Proxy Type"}),e.jsx(i,{children:"Region"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Response Time"}),e.jsx(i,{children:"Checked At"})]})}),e.jsxs(v,{children:[a==null?void 0:a.slice(0,50).map(s=>e.jsxs(d,{children:[e.jsx(r,{className:"capitalize",children:s.proxy_type}),e.jsx(r,{children:s.region}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${W[s.status]??"bg-muted"}`}),e.jsx("span",{className:"capitalize",children:s.status})]})}),e.jsx(r,{children:s.response_time_ms?`${s.response_time_ms}ms`:"—"}),e.jsx(r,{className:"text-xs",children:V(new Date(s.checked_at),"MMM d, HH:mm:ss")})]},s.id)),!(a!=null&&a.length)&&e.jsx(d,{children:e.jsx(r,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No uptime records yet"})})]})]})})})}),e.jsx(b,{value:"credits",children:e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(d,{children:[e.jsx(i,{children:"User ID"}),e.jsx(i,{children:"Proxy Type"}),e.jsx(i,{children:"Actual Uptime"}),e.jsx(i,{children:"Guaranteed"}),e.jsx(i,{children:"Credit"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Actions"})]})}),e.jsxs(v,{children:[l==null?void 0:l.map(s=>e.jsxs(d,{children:[e.jsxs(r,{className:"font-mono text-xs",children:[s.user_id.slice(0,8),"…"]}),e.jsx(r,{className:"capitalize",children:s.proxy_type}),e.jsxs(r,{children:[Number(s.actual_uptime).toFixed(2),"%"]}),e.jsxs(r,{children:[Number(s.guaranteed_uptime),"%"]}),e.jsxs(r,{className:"font-semibold",children:["$",Number(s.credit_amount).toFixed(2)]}),e.jsx(r,{children:e.jsx(y,{variant:s.status==="approved"?"default":s.status==="applied"?"secondary":"outline",children:s.status})}),e.jsx(r,{children:s.status==="pending"&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>q.mutate(s.id),children:[e.jsx(R,{className:"mr-1 h-3 w-3"})," Approve"]})})]},s.id)),!(l!=null&&l.length)&&e.jsx(d,{children:e.jsx(r,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No SLA credits issued"})})]})]})})})}),e.jsx(b,{value:"configs",children:e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(d,{children:[e.jsx(i,{children:"Proxy Type"}),e.jsx(i,{children:"Guaranteed Uptime"}),e.jsx(i,{children:"Credit / % Downtime"}),e.jsx(i,{children:"Window"}),e.jsx(i,{children:"Status"})]})}),e.jsx(v,{children:n==null?void 0:n.map(s=>e.jsxs(d,{children:[e.jsx(r,{className:"capitalize font-medium",children:s.proxy_type}),e.jsxs(r,{children:[Number(s.guaranteed_uptime),"%"]}),e.jsxs(r,{children:[Number(s.credit_per_percent),"%"]}),e.jsx(r,{className:"capitalize",children:s.measurement_window}),e.jsx(r,{children:e.jsx(y,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})})]},s.id))})]})})})})]})]})}export{xe as default};
