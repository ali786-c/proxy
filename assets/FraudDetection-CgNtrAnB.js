import{r as R,U as q,j as e,aI as F,y as M,z as I,E as D,J as U,K as g,a as $,t as E,i as w}from"./index-DnjEIbOH.js";import{u as H}from"./useMutation-C2-PnVOi.js";import{s as u}from"./client-DBtcxyoE.js";import{C as o,a as h,b as m,c as x}from"./card-CDhwwvex.js";import{B as f}from"./badge-DW7uU0yh.js";import{T as p,a as v,b as d,c as t,d as y,e as r}from"./table-CvZNE4B_.js";import{T as B,a as K,b as N,c as _}from"./tabs-CMyxn5mD.js";import{f as b}from"./format-sbWH3_uq.js";import{C as V}from"./circle-check-big-E65gsiEF.js";const C={low:"bg-blue-500/10 text-blue-500",medium:"bg-yellow-500/10 text-yellow-500",high:"bg-orange-500/10 text-orange-500",critical:"bg-destructive/10 text-destructive"},O={login_anomaly:"Login Anomaly",usage_spike:"Usage Spike",impossible_travel:"Impossible Travel",rapid_auth:"Rapid Auth Attempts"};function Q(i){return w({queryKey:["fraud-signals",i],queryFn:async()=>{let l=u.from("fraud_signals").select("*").order("created_at",{ascending:!1}).limit(100);i!=="all"&&(l=l.eq("is_resolved",i==="resolved"));const{data:a,error:j}=await l;if(j)throw j;return a??[]}})}function z(){return w({queryKey:["risk-scores"],queryFn:async()=>{const{data:i,error:l}=await u.from("user_risk_scores").select("*").order("risk_score",{ascending:!1}).limit(50);if(l)throw l;return i??[]}})}function P(){return w({queryKey:["login-history"],queryFn:async()=>{const{data:i,error:l}=await u.from("login_history").select("*").order("created_at",{ascending:!1}).limit(100);if(l)throw l;return i??[]}})}function te(){const[i,l]=R.useState("unresolved"),{data:a,isLoading:j}=Q(i),{data:n}=z(),{data:c}=P(),T=q(),k=H({mutationFn:async s=>{const{error:S}=await u.from("fraud_signals").update({is_resolved:!0,resolved_at:new Date().toISOString()}).eq("id",s);if(S)throw S},onSuccess:()=>{T.invalidateQueries({queryKey:["fraud-signals"]}),E({title:"Signal resolved"})}}),L=(a==null?void 0:a.filter(s=>s.severity==="critical"&&!s.is_resolved).length)??0,A=(n==null?void 0:n.filter(s=>s.risk_score>=70).length)??0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(F,{className:"h-6 w-6"})," Fraud Detection"]}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor login anomalies, usage abuse, and risk scores"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Active Signals"})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.filter(s=>!s.is_resolved).length)??0})})]}),e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Critical Alerts"})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:L})})]}),e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"High-Risk Users"})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-warning",children:A})})]}),e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Login Events (24h)"})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:(c==null?void 0:c.length)??0})})]})]}),e.jsxs(B,{defaultValue:"signals",children:[e.jsxs(K,{children:[e.jsx(N,{value:"signals",children:"Fraud Signals"}),e.jsx(N,{value:"risk",children:"Risk Scores"}),e.jsx(N,{value:"logins",children:"Login History"})]}),e.jsxs(_,{value:"signals",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(M,{value:i,onValueChange:l,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(D,{})}),e.jsxs(U,{children:[e.jsx(g,{value:"all",children:"All Signals"}),e.jsx(g,{value:"unresolved",children:"Unresolved"}),e.jsx(g,{value:"resolved",children:"Resolved"})]})]})}),e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs(d,{children:[e.jsx(t,{children:"Type"}),e.jsx(t,{children:"Severity"}),e.jsx(t,{children:"Description"}),e.jsx(t,{children:"Location"}),e.jsx(t,{children:"IP"}),e.jsx(t,{children:"Time"}),e.jsx(t,{children:"Actions"})]})}),e.jsxs(y,{children:[a==null?void 0:a.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:e.jsx(f,{variant:"outline",children:O[s.signal_type]??s.signal_type})}),e.jsx(r,{children:e.jsx("span",{className:`rounded px-2 py-0.5 text-xs font-semibold ${C[s.severity]??""}`,children:s.severity})}),e.jsx(r,{className:"max-w-[200px] truncate",children:s.description}),e.jsx(r,{children:s.geo_city?`${s.geo_city}, ${s.geo_country}`:s.geo_country??"—"}),e.jsx(r,{className:"font-mono text-xs",children:s.ip_address??"—"}),e.jsx(r,{className:"text-xs",children:b(new Date(s.created_at),"MMM d, HH:mm")}),e.jsx(r,{children:s.is_resolved?e.jsx(f,{variant:"secondary",children:"Resolved"}):e.jsxs($,{size:"sm",variant:"outline",onClick:()=>k.mutate(s.id),children:[e.jsx(V,{className:"mr-1 h-3 w-3"})," Resolve"]})})]},s.id)),!(a!=null&&a.length)&&e.jsx(d,{children:e.jsx(r,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No fraud signals detected"})})]})]})})})]}),e.jsx(_,{value:"risk",children:e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs(d,{children:[e.jsx(t,{children:"User ID"}),e.jsx(t,{children:"Risk Score"}),e.jsx(t,{children:"Level"}),e.jsx(t,{children:"Factors"}),e.jsx(t,{children:"Last Calculated"})]})}),e.jsxs(y,{children:[n==null?void 0:n.map(s=>e.jsxs(d,{children:[e.jsxs(r,{className:"font-mono text-xs",children:[s.user_id.slice(0,8),"…"]}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-16 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.risk_score>=70?"bg-destructive":s.risk_score>=40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${s.risk_score}%`}})}),e.jsx("span",{className:"text-sm font-semibold",children:s.risk_score})]})}),e.jsx(r,{children:e.jsx("span",{className:`rounded px-2 py-0.5 text-xs font-semibold ${C[s.risk_level]??""}`,children:s.risk_level})}),e.jsx(r,{className:"text-xs",children:Array.isArray(s.factors)?s.factors.join(", "):"—"}),e.jsx(r,{className:"text-xs",children:b(new Date(s.last_calculated_at),"MMM d, HH:mm")})]},s.id)),!(n!=null&&n.length)&&e.jsx(d,{children:e.jsx(r,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No risk scores calculated yet"})})]})]})})})}),e.jsx(_,{value:"logins",children:e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs(d,{children:[e.jsx(t,{children:"User ID"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"IP"}),e.jsx(t,{children:"Location"}),e.jsx(t,{children:"User Agent"}),e.jsx(t,{children:"Time"})]})}),e.jsxs(y,{children:[c==null?void 0:c.map(s=>e.jsxs(d,{children:[e.jsxs(r,{className:"font-mono text-xs",children:[s.user_id.slice(0,8),"…"]}),e.jsx(r,{children:e.jsx(f,{variant:s.success?"default":"destructive",children:s.success?"Success":"Failed"})}),e.jsx(r,{className:"font-mono text-xs",children:s.ip_address??"—"}),e.jsx(r,{children:s.geo_city?`${s.geo_city}, ${s.geo_country}`:s.geo_country??"—"}),e.jsx(r,{className:"max-w-[150px] truncate text-xs",children:s.user_agent??"—"}),e.jsx(r,{className:"text-xs",children:b(new Date(s.created_at),"MMM d, HH:mm")})]},s.id)),!(c!=null&&c.length)&&e.jsx(d,{children:e.jsx(r,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No login events recorded"})})]})]})})})})]})]})}export{te as default};
