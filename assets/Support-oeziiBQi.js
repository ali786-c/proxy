import{r as x,j as e,B as T,q as _,v as k,w as R,x as L,y as l,I as V,t as m}from"./index-CZjjzW98.js";import{S as $}from"./SEOHead-BQntEyAM.js";import{C as I,a as z,b as Y,c as O}from"./card-B5Gfyd7p.js";import{B as f}from"./badge-BpWL1baF.js";import{T as G}from"./textarea-CAE5aKsT.js";import{T as J,a as K,b as g,c,d as M,e as i}from"./table-s1GjQ5ZU.js";import{q as Q}from"./use-backend-C-fVTGhT.js";import{S as W}from"./search-DWCfwqMR.js";import"./useQuery-CPO4fHLH.js";import"./useMutation-DDTMDbh5.js";import"./api-BTF2QDx4.js";const X={open:"secondary",in_progress:"default",resolved:"outline",closed:"outline"},A={low:"secondary",normal:"default",high:"destructive"};function oe(){var S,w;const{data:n,isLoading:P,replyTicket:u,updateStatus:B}=Q(),[h,E]=x.useState(""),[p,D]=x.useState("all"),[j,v]=x.useState(null),[d,N]=x.useState("");if(P)return e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading tickets..."});const t=n==null?void 0:n.find(s=>s.id===j),y=(n??[]).filter(s=>{var a,r,C,b;if(p!=="all"&&s.status!==p)return!1;if(h){const o=h.toLowerCase();return String(s.id).includes(o)||((r=(a=s.user)==null?void 0:a.name)==null?void 0:r.toLowerCase().includes(o))||((b=(C=s.user)==null?void 0:C.email)==null?void 0:b.toLowerCase().includes(o))||s.subject.toLowerCase().includes(o)}return!0}),F=async()=>{if(!(!d.trim()||!j))try{await u.mutateAsync({id:j,message:d}),N(""),m({title:"Reply Sent"})}catch(s){m({title:"Error",description:s.message,variant:"destructive"})}},H=async(s,a)=>{try{await B.mutateAsync({id:s,status:a}),m({title:"Status Updated",description:`Ticket #${s} → ${a}`})}catch(r){m({title:"Error",description:r.message,variant:"destructive"})}},q=(n??[]).filter(s=>s.status==="open").length,U=(n??[]).filter(s=>s.status==="in_progress").length;return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Admin — Support",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Support Tickets"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[q," open · ",U," in progress · ",n.length," total"]})]})}),t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>v(null),children:"← Back"}),e.jsxs(I,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg",children:t.subject}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["#",t.id," · ",(S=t.user)==null?void 0:S.name," (",(w=t.user)==null?void 0:w.email,")"]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{variant:A[t.priority],children:t.priority}),e.jsxs(_,{value:t.status,onValueChange:s=>H(t.id,s),children:[e.jsx(k,{className:"w-[140px] h-8 text-xs",children:e.jsx(R,{})}),e.jsxs(L,{children:[e.jsx(l,{value:"open",children:"Open"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"resolved",children:"Resolved"}),e.jsx(l,{value:"closed",children:"Closed"})]})]})]})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:(t.messages??[]).map((s,a)=>{var r;return e.jsxs("div",{className:`rounded-lg p-3 text-sm ${s.is_admin_reply?"bg-primary/5 ml-8 border border-primary/10":"bg-muted mr-8"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-bold text-xs",children:s.is_admin_reply?"Support (You)":(r=t.user)==null?void 0:r.name}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.message})]},a)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:d,onChange:s=>N(s.target.value),placeholder:"Type your reply...",rows:2,className:"flex-1"}),e.jsx(T,{onClick:F,disabled:!d.trim()||u.isPending,className:"self-end",children:u.isPending?"Sending...":"Send"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(W,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(V,{placeholder:"Search tickets...",value:h,onChange:s=>E(s.target.value),className:"pl-9"})]}),e.jsxs(_,{value:p,onValueChange:D,children:[e.jsx(k,{className:"w-[150px]",children:e.jsx(R,{placeholder:"Status"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"All Statuses"}),e.jsx(l,{value:"open",children:"Open"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"resolved",children:"Resolved"}),e.jsx(l,{value:"closed",children:"Closed"})]})]})]}),e.jsx(I,{children:e.jsx(O,{className:"p-0",children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(g,{children:[e.jsx(c,{className:"w-16",children:"ID"}),e.jsx(c,{children:"User"}),e.jsx(c,{children:"Subject"}),e.jsx(c,{className:"w-24",children:"Priority"}),e.jsx(c,{className:"w-32",children:"Status"}),e.jsx(c,{className:"text-right",children:"Created"})]})}),e.jsxs(M,{children:[y.map(s=>{var a,r;return e.jsxs(g,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>v(s.id),children:[e.jsxs(i,{className:"font-mono text-[10px] text-muted-foreground",children:["#",s.id]}),e.jsx(i,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:(a=s.user)==null?void 0:a.name}),e.jsx("span",{className:"text-[10px] text-muted-foreground line-clamp-1",children:(r=s.user)==null?void 0:r.email})]})}),e.jsx(i,{className:"font-medium",children:s.subject}),e.jsx(i,{children:e.jsx(f,{variant:A[s.priority]??"secondary",className:"text-[10px]",children:s.priority})}),e.jsx(i,{children:e.jsx(f,{variant:X[s.status]??"secondary",className:"text-[10px] capitalize",children:s.status.replace("_"," ")})}),e.jsx(i,{className:"text-right text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]},s.id)}),y.length===0&&e.jsx(g,{children:e.jsx(i,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No tickets found."})})]})]})})})]})]})]})}export{oe as default};
