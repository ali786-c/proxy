import{c as T,U as A,Y as M,r as o,K as B,q as I,V as q,j as e,a as g,I as F,t as b,ae as v,af as K,aU as W,s as H}from"./index-uv7RKa8h.js";import{S as O}from"./SEOHead-D4EfXKfM.js";import{C as j,a as Q,b as R,c as N}from"./card-VS78f1Pp.js";import{L as k}from"./label-CfxDIkHK.js";import{S as U}from"./switch-E7iNmqa8.js";import{B as m}from"./badge-BXbAltru.js";import{u as V}from"./useMutation-DUDPJtMj.js";import{x as Y}from"./use-backend-QIDQpZrQ.js";import{B as z}from"./bitcoin-fUahyD7y.js";import{L as C}from"./loader-circle-Dk7HOFAw.js";import{C as p}from"./circle-alert-oUv2dtCf.js";import{E as D}from"./eye-off-B7XsGaHB.js";import{E as J}from"./eye-CUUkkPNa.js";import{S as X}from"./save-mrPU52C9.js";import{C as Z}from"./circle-check-BnDk6COd.js";import"./dashboard-BJhQ00ui.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=T("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),se=[{id:"stripe",name:"Stripe",icon:B,fields:[{key:"stripe_publishable_key",label:"Publishable Key",placeholder:"pk_live_...",value:""},{key:"stripe_secret_key",label:"Secret Key",placeholder:"sk_live_...",value:""},{key:"stripe_webhook_secret",label:"Webhook Secret",placeholder:"whsec_...",value:""}]},{id:"paypal",name:"PayPal",icon:I,fields:[{key:"paypal_client_id",label:"Client ID",placeholder:"AV...",value:""},{key:"paypal_client_secret",label:"Client Secret",placeholder:"EL...",value:""},{key:"paypal_mode",label:"Mode (sandbox/live)",placeholder:"sandbox",value:""}]},{id:"crypto",name:"Crypto (USDT/BTC/ETH)",icon:z,fields:[{key:"crypto_wallet_address",label:"Wallet Address",placeholder:"0x...",value:""},{key:"crypto_provider",label:"Provider (e.g. NOWPayments)",placeholder:"nowpayments",value:""},{key:"crypto_api_key",label:"API Key",placeholder:"Your API key",value:""}]}];function ge(){const w=A(),{gateways:S,toggleGateway:_}=M(),[u,h]=o.useState(se),[x,E]=o.useState({}),{data:c={},isLoading:L}=q({queryKey:["admin","settings"],queryFn:()=>v.get("/admin/settings",W(H()))}),{data:l,isLoading:y,refetch:f}=Y(),d=V({mutationFn:s=>v.post("/admin/settings",K,s),onSuccess:()=>{w.invalidateQueries({queryKey:["admin","settings"]}),f(),b({title:"Configuration Saved",description:"Gateway settings have been updated and verified."})},onError:()=>b({title:"Save Failed",description:"Could not save settings to backend.",variant:"destructive"})});o.useEffect(()=>{c&&h(s=>s.map(a=>({...a,fields:a.fields.map(r=>({...r,value:c[r.key]||""}))})))},[c]);const P=(s,a,r)=>{h(i=>i.map(t=>t.id===s?{...t,fields:t.fields.map(n=>n.key===a?{...n,value:r}:n)}:t))},$=s=>{const a=u.find(i=>i.id===s);if(!a)return;const r={};a.fields.forEach(i=>{r[i.key]=i.value}),d.mutate(r)},G=s=>{var r;const a=(r=l==null?void 0:l.gateways)==null?void 0:r.find(i=>i.id===s);return a?a.status==="connected"?e.jsxs(m,{variant:"default",className:"bg-success text-success-foreground hover:bg-success/90 gap-1",children:[e.jsx(Z,{className:"h-3 w-3"})," Connected"]}):a.status==="error"?e.jsxs(m,{variant:"destructive",className:"gap-1",children:[e.jsx(p,{className:"h-3 w-3"})," Config Error"]}):e.jsx(m,{variant:"secondary",children:"Not Configured"}):null};return L?e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Payment Gateways",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Payment Gateways"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure and enable payment methods for clients."})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>f(),disabled:y,className:"gap-2",children:[e.jsx(ee,{className:`h-4 w-4 ${y?"animate-spin":""}`})," Verify Status"]})]}),e.jsx("div",{className:"grid gap-6",children:u.map(s=>{var r,i;const a=S[s.id];return e.jsxs(j,{className:a?"border-primary/30 ring-1 ring-primary/10 shadow-sm":"opacity-70",children:[e.jsx(Q,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(R,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:`rounded-lg p-2 ${a?"bg-primary/10":"bg-muted"}`,children:e.jsx(s.icon,{className:`h-5 w-5 ${a?"text-primary":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s.name,G(s.id)]}),a&&((i=(r=l==null?void 0:l.gateways)==null?void 0:r.find(t=>t.id===s.id))==null?void 0:i.webhook_health)==="missing"&&e.jsxs("span",{className:"text-[10px] text-destructive flex items-center gap-1 font-normal mt-1",children:[e.jsx(p,{className:"h-2.5 w-2.5"})," Webhook secret missing - payments won't auto-credit"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-muted/50 py-1 px-3 rounded-full",children:[e.jsx(k,{htmlFor:`toggle-${s.id}`,className:"text-xs font-medium cursor-pointer",children:a?"Live for Clients":"Disabled"}),e.jsx(U,{id:`toggle-${s.id}`,checked:a,onCheckedChange:()=>{_(s.id),d.mutate({[`gateway_${s.id}_enabled`]:a?"0":"1"})}})]})]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.fields.map(t=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(k,{className:"text-[11px] uppercase tracking-wider text-muted-foreground font-semibold",children:t.label}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{type:x[`${s.id}-${t.key}`]?"text":"password",placeholder:t.placeholder,value:t.value,onChange:n=>P(s.id,t.key,n.target.value),className:"bg-muted/30 focus-visible:ring-primary/20"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>E(n=>({...n,[`${s.id}-${t.key}`]:!n[`${s.id}-${t.key}`]})),children:x[`${s.id}-${t.key}`]?e.jsx(D,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]})]},t.key))}),e.jsxs("div",{className:"pt-2 flex items-center justify-between border-t border-muted",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Changes take effect immediately across the platform."}),e.jsxs(g,{onClick:()=>$(s.id),className:"gap-2",size:"sm",disabled:d.isPending,children:[d.isPending?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(X,{className:"h-4 w-4"}),"Save ",s.name," Config"]})]})]})]},s.id)})}),e.jsx(j,{className:"border-dashed bg-muted/20",children:e.jsxs(N,{className:"pt-6 text-center text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center justify-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-warning"})," Security Implementation"]}),e.jsx("p",{className:"max-w-md mx-auto",children:"These keys are stored in the system database. Ensure your backend environment is secured and database is properly firewalled."})]})})]})]})}export{ge as default};
