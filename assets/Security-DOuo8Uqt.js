import{j as e,k as ee,x as z}from"./ui-BpDXiumg.js";import{r as t,aG as Le,t as Ge,H as $e,am as ze,aw as Ue}from"./vendor-CXoGxISd.js";import{S as Ve}from"./SEOHead-CruxSZC3.js";import{C as oe,a as ie,b as ce,d as qe,c as ue}from"./card-NvV88nEZ.js";import{a as Qe,B as be,t as U,I as ye}from"./index-JwncgfEP.js";import{L as Se}from"./label-BO-7FaBh.js";import{j as Je}from"./use-backend-V_mSDTAx.js";import"./useMutation-Co15Ke09.js";var Ke=Object.defineProperty,Xe=Object.defineProperties,Ye=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,Ce=(n,a,s)=>a in n?Ke(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s,Ze=(n,a)=>{for(var s in a||(a={}))Pe.call(a,s)&&Ce(n,s,a[s]);if(te)for(var s of te(a))Ee.call(a,s)&&Ce(n,s,a[s]);return n},et=(n,a)=>Xe(n,Ye(a)),tt=(n,a)=>{var s={};for(var o in n)Pe.call(n,o)&&a.indexOf(o)<0&&(s[o]=n[o]);if(n!=null&&te)for(var o of te(n))a.indexOf(o)<0&&Ee.call(n,o)&&(s[o]=n[o]);return s};function nt(n){let a=setTimeout(n,0),s=setTimeout(n,10),o=setTimeout(n,50);return[a,s,o]}function at(n){let a=t.useRef();return t.useEffect(()=>{a.current=n}),a.current}var rt=18,Ne=40,st=`${Ne}px`,lt=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function ot({containerRef:n,inputRef:a,pushPasswordManagerStrategy:s,isFocused:o}){let[g,u]=t.useState(!1),[k,v]=t.useState(!1),[T,C]=t.useState(!1),A=t.useMemo(()=>s==="none"?!1:(s==="increase-width"||s==="experimental-no-flickering")&&g&&k,[g,k,s]),P=t.useCallback(()=>{let m=n.current,b=a.current;if(!m||!b||T||s==="none")return;let f=m,y=f.getBoundingClientRect().left+f.offsetWidth,M=f.getBoundingClientRect().top+f.offsetHeight/2,i=y-rt,I=M;document.querySelectorAll(lt).length===0&&document.elementFromPoint(i,I)===m||(u(!0),C(!0))},[n,a,T,s]);return t.useEffect(()=>{let m=n.current;if(!m||s==="none")return;function b(){let y=window.innerWidth-m.getBoundingClientRect().right;v(y>=Ne)}b();let f=setInterval(b,1e3);return()=>{clearInterval(f)}},[n,s]),t.useEffect(()=>{let m=o||document.activeElement===a.current;if(s==="none"||!m)return;let b=setTimeout(P,0),f=setTimeout(P,2e3),y=setTimeout(P,5e3),M=setTimeout(()=>{C(!0)},6e3);return()=>{clearTimeout(b),clearTimeout(f),clearTimeout(y),clearTimeout(M)}},[a,o,s,P]),{hasPWMBadge:g,willPushPWMBadge:A,PWM_BADGE_SPACE_WIDTH:st}}var ke=t.createContext({}),Te=t.forwardRef((n,a)=>{var s=n,{value:o,onChange:g,maxLength:u,textAlign:k="left",pattern:v,placeholder:T,inputMode:C="numeric",onComplete:A,pushPasswordManagerStrategy:P="increase-width",pasteTransformer:m,containerClassName:b,noScriptCSSFallback:f=it,render:y,children:M}=s,i=tt(s,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),I,X,R,de,pe;let[Re,Oe]=t.useState(typeof i.defaultValue=="string"?i.defaultValue:""),d=o??Re,D=at(d),V=t.useCallback(r=>{g==null||g(r),Oe(r)},[g]),E=t.useMemo(()=>v?typeof v=="string"?new RegExp(v):v:null,[v]),p=t.useRef(null),ne=t.useRef(null),ae=t.useRef({value:d,onChange:V,isIOS:typeof window<"u"&&((X=(I=window==null?void 0:window.CSS)==null?void 0:I.supports)==null?void 0:X.call(I,"-webkit-touch-callout","none"))}),Y=t.useRef({prev:[(R=p.current)==null?void 0:R.selectionStart,(de=p.current)==null?void 0:de.selectionEnd,(pe=p.current)==null?void 0:pe.selectionDirection]});t.useImperativeHandle(a,()=>p.current,[]),t.useEffect(()=>{let r=p.current,l=ne.current;if(!r||!l)return;ae.current.value!==r.value&&ae.current.onChange(r.value),Y.current.prev=[r.selectionStart,r.selectionEnd,r.selectionDirection];function h(){if(document.activeElement!==r){Q(null),J(null);return}let c=r.selectionStart,x=r.selectionEnd,Z=r.selectionDirection,S=r.maxLength,W=r.value,N=Y.current.prev,O=-1,B=-1,H;if(W.length!==0&&c!==null&&x!==null){let We=c===x,He=c===W.length&&W.length<S;if(We&&!He){let _=c;if(_===0)O=0,B=1,H="forward";else if(_===S)O=_-1,B=_,H="backward";else if(S>1&&W.length>1){let le=0;if(N[0]!==null&&N[1]!==null){H=_<N[1]?"backward":"forward";let _e=N[0]===N[1]&&N[0]<S;H==="backward"&&!_e&&(le=-1)}O=le+_,B=le+_+1}}O!==-1&&B!==-1&&O!==B&&p.current.setSelectionRange(O,B,H)}let je=O!==-1?O:c,we=B!==-1?B:x,Fe=H??Z;Q(je),J(we),Y.current.prev=[je,we,Fe]}if(document.addEventListener("selectionchange",h,{capture:!0}),h(),document.activeElement===r&&re(!0),!document.getElementById("input-otp-style")){let c=document.createElement("style");if(c.id="input-otp-style",document.head.appendChild(c),c.sheet){let x="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";K(c.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),K(c.sheet,`[data-input-otp]:autofill { ${x} }`),K(c.sheet,`[data-input-otp]:-webkit-autofill { ${x} }`),K(c.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),K(c.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let j=()=>{l&&l.style.setProperty("--root-height",`${r.clientHeight}px`)};j();let w=new ResizeObserver(j);return w.observe(r),()=>{document.removeEventListener("selectionchange",h,{capture:!0}),w.disconnect()}},[]);let[me,he]=t.useState(!1),[q,re]=t.useState(!1),[F,Q]=t.useState(null),[G,J]=t.useState(null);t.useEffect(()=>{nt(()=>{var r,l,h,j;(r=p.current)==null||r.dispatchEvent(new Event("input"));let w=(l=p.current)==null?void 0:l.selectionStart,c=(h=p.current)==null?void 0:h.selectionEnd,x=(j=p.current)==null?void 0:j.selectionDirection;w!==null&&c!==null&&(Q(w),J(c),Y.current.prev=[w,c,x])})},[d,q]),t.useEffect(()=>{D!==void 0&&d!==D&&D.length<u&&d.length===u&&(A==null||A(d))},[u,A,D,d]);let $=ot({containerRef:ne,inputRef:p,pushPasswordManagerStrategy:P,isFocused:q}),fe=t.useCallback(r=>{let l=r.currentTarget.value.slice(0,u);if(l.length>0&&E&&!E.test(l)){r.preventDefault();return}typeof D=="string"&&l.length<D.length&&document.dispatchEvent(new Event("selectionchange")),V(l)},[u,V,D,E]),ve=t.useCallback(()=>{var r;if(p.current){let l=Math.min(p.current.value.length,u-1),h=p.current.value.length;(r=p.current)==null||r.setSelectionRange(l,h),Q(l),J(h)}re(!0)},[u]),xe=t.useCallback(r=>{var l,h;let j=p.current;if(!m&&(!ae.current.isIOS||!r.clipboardData||!j))return;let w=r.clipboardData.getData("text/plain"),c=m?m(w):w;r.preventDefault();let x=(l=p.current)==null?void 0:l.selectionStart,Z=(h=p.current)==null?void 0:h.selectionEnd,S=(x!==Z?d.slice(0,x)+c+d.slice(Z):d.slice(0,x)+c+d.slice(x)).slice(0,u);if(S.length>0&&E&&!E.test(S))return;j.value=S,V(S);let W=Math.min(S.length,u-1),N=S.length;j.setSelectionRange(W,N),Q(W),J(N)},[u,V,E,d]),Be=t.useMemo(()=>({position:"relative",cursor:i.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[i.disabled]),ge=t.useMemo(()=>({position:"absolute",inset:0,width:$.willPushPWMBadge?`calc(100% + ${$.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:$.willPushPWMBadge?`inset(0 ${$.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:k,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[$.PWM_BADGE_SPACE_WIDTH,$.willPushPWMBadge,k]),Ie=t.useMemo(()=>t.createElement("input",et(Ze({autoComplete:i.autoComplete||"one-time-code"},i),{"data-input-otp":!0,"data-input-otp-placeholder-shown":d.length===0||void 0,"data-input-otp-mss":F,"data-input-otp-mse":G,inputMode:C,pattern:E==null?void 0:E.source,"aria-placeholder":T,style:ge,maxLength:u,value:d,ref:p,onPaste:r=>{var l;xe(r),(l=i.onPaste)==null||l.call(i,r)},onChange:fe,onMouseOver:r=>{var l;he(!0),(l=i.onMouseOver)==null||l.call(i,r)},onMouseLeave:r=>{var l;he(!1),(l=i.onMouseLeave)==null||l.call(i,r)},onFocus:r=>{var l;ve(),(l=i.onFocus)==null||l.call(i,r)},onBlur:r=>{var l;re(!1),(l=i.onBlur)==null||l.call(i,r)}})),[fe,ve,xe,C,ge,u,G,F,i,E==null?void 0:E.source,d]),se=t.useMemo(()=>({slots:Array.from({length:u}).map((r,l)=>{var h;let j=q&&F!==null&&G!==null&&(F===G&&l===F||l>=F&&l<G),w=d[l]!==void 0?d[l]:null,c=d[0]!==void 0?null:(h=T==null?void 0:T[l])!=null?h:null;return{char:w,placeholderChar:c,isActive:j,hasFakeCaret:j&&w===null}}),isFocused:q,isHovering:!i.disabled&&me}),[q,me,u,G,F,i.disabled,d]),De=t.useMemo(()=>y?y(se):t.createElement(ke.Provider,{value:se},M),[M,se,y]);return t.createElement(t.Fragment,null,f!==null&&t.createElement("noscript",null,t.createElement("style",null,f)),t.createElement("div",{ref:ne,"data-input-otp-container":!0,style:Be,className:b},De,t.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Ie)))});Te.displayName="Input";function K(n,a){try{n.insertRule(a)}catch{console.error("input-otp could not insert CSS rule:",a)}}var it=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const Ae=t.forwardRef(({className:n,containerClassName:a,...s},o)=>e.jsx(Te,{ref:o,containerClassName:ee("flex items-center gap-2 has-[:disabled]:opacity-50",a),className:ee("disabled:cursor-not-allowed",n),...s}));Ae.displayName="InputOTP";const Me=t.forwardRef(({className:n,...a},s)=>e.jsx("div",{ref:s,className:ee("flex items-center",n),...a}));Me.displayName="InputOTPGroup";const L=t.forwardRef(({index:n,className:a,...s},o)=>{const g=t.useContext(ke),{char:u,hasFakeCaret:k,isActive:v}=g.slots[n];return e.jsxs("div",{ref:o,className:ee("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",v&&"z-10 ring-2 ring-ring ring-offset-background",a),...s,children:[u,k&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});L.displayName="InputOTPSlot";const ct=t.forwardRef(({...n},a)=>e.jsx("div",{ref:a,role:"separator",...n,children:e.jsx(Le,{})}));ct.displayName="InputOTPSeparator";function gt(){const{user:n}=Qe(),[a,s]=t.useState("idle"),[o,g]=t.useState(""),[u,k]=t.useState(!1),v="JBSWY3DPEHPK3PXP",T=Je(),[C,A]=t.useState(""),[P,m]=t.useState(""),[b,f]=t.useState(!1),y=async()=>{if(!C||C!==P){U({title:"Validation Error",description:"Passwords do not match.",variant:"destructive"});return}f(!0);try{await T.mutateAsync({password:C,password_confirmation:P}),U({title:"Password updated successfully"}),A(""),m("")}catch(R){U({title:"Error",description:R.message,variant:"destructive"})}finally{f(!1)}},M={mutate:()=>U({title:"2FA Setup",description:"This feature is coming soon to the self-hosted version."})},i=!1,I=()=>{if(o.length!==6){U({title:"Invalid code",description:"Enter a 6-digit code",variant:"destructive"});return}M.mutate()},X=`otpauth://totp/UpgradedProxy:${n==null?void 0:n.email}?secret=${v}&issuer=UpgradedProxy`;return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{title:"Security & 2FA",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Security & 2FA"}),e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-8 w-8 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(ce,{className:"text-lg",children:"Two-Factor Authentication (TOTP)"}),e.jsx(qe,{children:"Add an extra layer of security using an authenticator app like Google Authenticator or Authy."})]}),e.jsx(be,{variant:"secondary",className:"ml-auto",children:"Disabled"})]})}),e.jsxs(ue,{className:"space-y-4",children:[i,a==="idle"&&e.jsxs(z,{onClick:()=>s("setup"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"})," Enable 2FA"]}),a==="setup"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"1. Scan this QR code with your authenticator app:"}),e.jsx("div",{className:"flex items-center justify-center rounded-lg border bg-white p-6",style:{maxWidth:240},children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(X)}`,alt:"2FA QR Code",className:"w-48 h-48"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Or enter this secret manually:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-muted px-3 py-1.5 rounded text-sm font-mono",children:v}),e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>{navigator.clipboard.writeText(v),U({title:"Copied"})},children:e.jsx(ze,{className:"h-4 w-4"})})]})]}),e.jsx(z,{onClick:()=>s("verify"),children:"Next: Verify Code"})]}),a==="verify"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"2. Enter the 6-digit code from your authenticator app:"}),e.jsx(Ae,{maxLength:6,value:o,onChange:g,children:e.jsxs(Me,{children:[e.jsx(L,{index:0}),e.jsx(L,{index:1}),e.jsx(L,{index:2}),e.jsx(L,{index:3}),e.jsx(L,{index:4}),e.jsx(L,{index:5})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>{s("setup"),g("")},children:"Back"}),e.jsx(z,{onClick:I,disabled:o.length!==6,children:"Verify & Enable"})]})]})]})]}),e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsx(ce,{className:"text-lg",children:"Change Password"})}),e.jsxs(ue,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 max-w-sm",children:[e.jsx(Se,{children:"New Password"}),e.jsx(ye,{type:"password",placeholder:"••••••••",value:C,onChange:R=>A(R.target.value)})]}),e.jsxs("div",{className:"space-y-2 max-w-sm",children:[e.jsx(Se,{children:"Confirm New Password"}),e.jsx(ye,{type:"password",placeholder:"••••••••",value:P,onChange:R=>m(R.target.value)})]}),e.jsxs(z,{onClick:y,disabled:b,children:[b?e.jsx(Ue,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Update Password"]})]})]}),e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsx(ce,{className:"text-lg",children:"Active Sessions"})}),e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Session"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Browser • ",navigator.userAgent.split(" ").pop()]})]}),e.jsx(be,{variant:"default",children:"Active"})]})})]})]})]})}export{gt as default};
