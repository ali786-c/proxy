import{c as A,a3 as T,E as F,r as d,Q as K,x as q,a4 as B,j as e,a as g,a8 as m,I as W,t as v,at as j,av as z,k as u,v as Q,b1 as O,s as R}from"./index-Rj6KsRZ3.js";import{S as Y}from"./SEOHead-Cp9_LOLn.js";import{C as k,a as H,b as U,c as N}from"./card-CN5fxAhF.js";import{L as C}from"./label-DtO0pv43.js";import{S as V}from"./switch-oojT6DnC.js";import{u as D}from"./useMutation-obzcPQ9v.js";import{x as J}from"./use-backend-BpEpryGj.js";import{B as X}from"./bitcoin-8Gk9LgZ2.js";import{L as w}from"./loader-circle-DaV2DsNq.js";import{E as Z}from"./eye-off-BT6HGBv-.js";import{E as ee}from"./eye-C-fpZWR3.js";import{S as se}from"./save-DS47Vt7v.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=A("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),te=[{id:"stripe",name:"Stripe",icon:K,fields:[{key:"stripe_publishable_key",label:"Publishable Key",placeholder:"pk_live_...",value:"",secret:!1},{key:"stripe_secret_key",label:"Secret Key",placeholder:"sk_live_...",value:"",secret:!0},{key:"stripe_webhook_secret",label:"Webhook Secret",placeholder:"whsec_...",value:"",secret:!0}]},{id:"paypal",name:"PayPal",icon:q,fields:[{key:"paypal_client_id",label:"Client ID",placeholder:"AV...",value:""},{key:"paypal_client_secret",label:"Client Secret",placeholder:"EL...",value:""},{key:"paypal_mode",label:"Mode (sandbox/live)",placeholder:"sandbox",value:""}]},{id:"cryptomus",name:"Cryptomus (Automated Crypto)",icon:X,fields:[{key:"cryptomus_merchant_id",label:"Merchant ID",placeholder:"UUID-...",value:""},{key:"cryptomus_api_key",label:"Payment/API Key",placeholder:"Your API key",value:"",secret:!0},{key:"cryptomus_webhook_secret",label:"Webhook/Sign Key",placeholder:"Your webhook key",value:"",secret:!0}]}];function xe(){const S=T(),{gateways:_,toggleGateway:E}=F(),[p,h]=d.useState(te),[y,$]=d.useState({}),{data:o={},isLoading:L}=B({queryKey:["admin","settings"],queryFn:()=>j.get("/admin/settings",O(R()))}),{data:l,isLoading:x,refetch:f}=J(),c=D({mutationFn:s=>j.post("/admin/settings",z,s),onSuccess:()=>{S.invalidateQueries({queryKey:["admin","settings"]}),f(),v({title:"Configuration Saved",description:"Gateway settings have been updated and verified."})},onError:()=>v({title:"Save Failed",description:"Could not save settings to backend.",variant:"destructive"})}),[b,P]=d.useState(!1);d.useEffect(()=>{Object.keys(o).length>0&&!b&&(h(s=>s.map(t=>({...t,fields:t.fields.map(r=>({...r,value:o[r.key]||""}))}))),P(!0))},[o,b]);const I=(s,t,r)=>{h(i=>i.map(a=>a.id===s?{...a,fields:a.fields.map(n=>n.key===t?{...n,value:r}:n)}:a))},G=s=>{const t=p.find(i=>i.id===s);if(!t)return;const r={};t.fields.forEach(i=>{r[i.key]=i.value}),c.mutate(r)},M=s=>{var r;const t=(r=l==null?void 0:l.gateways)==null?void 0:r.find(i=>i.id===s);return t?t.status==="connected"?e.jsxs(u,{variant:"default",className:"bg-success text-success-foreground hover:bg-success/90 gap-1",children:[e.jsx(Q,{className:"h-3 w-3"})," Connected"]}):t.status==="error"?e.jsxs(u,{variant:"destructive",className:"gap-1",children:[e.jsx(m,{className:"h-3 w-3"})," Config Error"]}):e.jsx(u,{variant:"secondary",children:"Not Configured"}):null};return L?e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Payment Gateways",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Payment Gateways"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure and enable payment methods for clients."})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>f(),disabled:x,className:"gap-2",children:[e.jsx(ae,{className:`h-4 w-4 ${x?"animate-spin":""}`})," Verify Status"]})]}),e.jsx("div",{className:"grid gap-6",children:p.map(s=>{var r,i;const t=_[s.id];return e.jsxs(k,{className:t?"border-primary/30 ring-1 ring-primary/10 shadow-sm":"opacity-70",children:[e.jsx(H,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:`rounded-lg p-2 ${t?"bg-primary/10":"bg-muted"}`,children:e.jsx(s.icon,{className:`h-5 w-5 ${t?"text-primary":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[s.name,M(s.id)]}),t&&((i=(r=l==null?void 0:l.gateways)==null?void 0:r.find(a=>a.id===s.id))==null?void 0:i.webhook_health)==="missing"&&e.jsxs("span",{className:"text-[10px] text-destructive flex items-center gap-1 font-normal mt-1",children:[e.jsx(m,{className:"h-2.5 w-2.5"})," Webhook secret missing - payments won't auto-credit"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-muted/50 py-1 px-3 rounded-full",children:[e.jsx(C,{htmlFor:`toggle-${s.id}`,className:"text-xs font-medium cursor-pointer",children:t?"Live for Clients":"Disabled"}),e.jsx(V,{id:`toggle-${s.id}`,checked:t,onCheckedChange:()=>{E(s.id),c.mutate({[`gateway_${s.id}_enabled`]:t?"0":"1"})}})]})]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.fields.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{className:"text-[11px] uppercase tracking-wider text-muted-foreground font-semibold",children:a.label}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{id:`${s.id}-${a.key}`,name:`${s.id}-${a.key}`,type:a.secret?y[`${s.id}-${a.key}`]?"text":"password":"text",placeholder:a.placeholder,value:a.value,onChange:n=>I(s.id,a.key,n.target.value),className:"bg-muted/30 focus-visible:ring-primary/20",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),a.secret&&e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>$(n=>({...n,[`${s.id}-${a.key}`]:!n[`${s.id}-${a.key}`]})),children:y[`${s.id}-${a.key}`]?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(ee,{className:"h-4 w-4"})})]})]},a.key))}),e.jsxs("div",{className:"pt-2 flex items-center justify-between border-t border-muted",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Changes take effect immediately across the platform."}),e.jsxs(g,{onClick:()=>G(s.id),className:"gap-2",size:"sm",disabled:c.isPending,children:[c.isPending?e.jsx(w,{className:"h-4 w-4 animate-spin"}):e.jsx(se,{className:"h-4 w-4"}),"Save ",s.name," Config"]})]})]})]},s.id)})}),e.jsx(k,{className:"border-dashed bg-muted/20",children:e.jsxs(N,{className:"pt-6 text-center text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center justify-center gap-2",children:[e.jsx(m,{className:"h-4 w-4 text-warning"})," Security Implementation"]}),e.jsx("p",{className:"max-w-md mx-auto",children:"These keys are stored in the system database. Ensure your backend environment is secured and database is properly firewalled."})]})})]})]})}export{xe as default};
