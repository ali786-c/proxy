import{j as e,y as q,J as G,x as l,z as J,A as K,E as Q,H as W,K as X}from"./ui-BvSIVwgG.js";import{r,aC as Z,a4 as R,an as ee,a3 as se,aI as te,Y as ae}from"./vendor-co0Zkaum.js";import{S as re}from"./SEOHead-D1jIlvoo.js";import{C as A,a as ie,b as le,c as E}from"./card-0KzbiLUl.js";import{L as ne,I as f,e as ce,f as oe,g as de,h as xe,i as v,B as m,t as c}from"./index-Cs0kIkPS.js";import{L as o}from"./label-D7lsv8RO.js";import{T as I}from"./textarea-BY_AKs5L.js";import{T as he,a as me,b as O,c as u,d as ue,e as p}from"./table-gVuxc4b7.js";import{E as pe}from"./EmptyState-DfmhFfYc.js";import{i as je}from"./use-backend-C-Pt7uzV.js";import"./useMutation-6K8IHZlD.js";const F={open:{color:"secondary",icon:se},in_progress:{color:"default",icon:ee},resolved:{color:"outline",icon:R},closed:{color:"outline",icon:R}},H={low:"secondary",normal:"default",high:"destructive"};function _e(){var P,L;const{data:i,isLoading:B,createTicket:j,replyTicket:g,updateStatus:N}=je(),[n,b]=r.useState(null),[d,S]=r.useState(""),[C,Y]=r.useState("normal"),[x,w]=r.useState(""),[M,T]=r.useState(null),[h,k]=r.useState(""),[y,_]=r.useState(null),[z,D]=r.useState(!1),t=i==null?void 0:i.find(s=>s.id===n),V=async()=>{if(!(!d.trim()||!x.trim()))try{await j.mutateAsync({subject:d,message:x,priority:C,attachment:M||void 0}),S(""),w(""),T(null),D(!1),c({title:"Ticket Created",description:"Your support ticket has been submitted."})}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}},U=async()=>{if(!(!h.trim()&&!y||!n))try{await g.mutateAsync({id:n,message:h,attachment:y||void 0}),k(""),_(null)}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}},$=async()=>{if(n)try{await N.mutateAsync({id:n,status:"closed"}),c({title:"Ticket Closed",description:"Your ticket has been marked as closed."})}catch(s){c({title:"Error",description:s.message,variant:"destructive"})}};return B?e.jsx(ne,{}):e.jsxs(e.Fragment,{children:[e.jsx(re,{title:"Support",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Support Tickets"}),!t&&e.jsxs(q,{open:z,onOpenChange:D,children:[e.jsx(G,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(Z,{className:"mr-1 h-4 w-4"})," New Ticket"]})}),e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(Q,{children:"Create Support Ticket"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Subject"}),e.jsx(f,{value:d,onChange:s=>S(s.target.value),placeholder:"Brief description of your issue"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Priority"}),e.jsxs(ce,{value:C,onValueChange:Y,children:[e.jsx(oe,{children:e.jsx(de,{})}),e.jsxs(xe,{children:[e.jsx(v,{value:"low",children:"Low"}),e.jsx(v,{value:"normal",children:"Normal"}),e.jsx(v,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Message"}),e.jsx(I,{value:x,onChange:s=>w(s.target.value),placeholder:"Describe your issue in detail...",rows:4})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Attachment (Optional)"}),e.jsx(f,{type:"file",onChange:s=>{var a;return T(((a=s.target.files)==null?void 0:a[0])||null)},className:"cursor-pointer"})]})]}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Cancel"})}),e.jsx(l,{onClick:V,disabled:!d.trim()||!x.trim()||j.isPending,children:j.isPending?"Submitting…":"Submit Ticket"})]})]})]})]}),t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>b(null),children:"← Back to List"}),e.jsxs(A,{children:[e.jsxs(ie,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-lg",children:t.subject}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(m,{variant:H[t.priority]??"secondary",children:t.priority}),e.jsx(m,{variant:((P=F[t.status])==null?void 0:P.color)??"secondary",children:t.status.replace("_"," ")})]})]}),t.status!=="closed"&&e.jsx(l,{variant:"outline",size:"sm",onClick:$,disabled:N.isPending,children:"Close Ticket"})]}),e.jsxs(E,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto px-1",children:(L=t.messages)==null?void 0:L.map(s=>e.jsx("div",{className:`flex flex-col ${s.is_admin_reply?"items-start":"items-end"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${s.is_admin_reply?"bg-muted text-foreground":"bg-primary text-primary-foreground"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-1",children:[e.jsx("span",{className:"font-bold text-[10px] uppercase opacity-70",children:s.is_admin_reply?"Support Agent":"You"}),e.jsx("span",{className:"text-[10px] opacity-70",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),s.attachment_url&&e.jsx("div",{className:"mt-2 pt-2 border-t border-current/20",children:e.jsxs("a",{href:s.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 text-xs hover:underline mt-1",children:[e.jsx(te,{className:"h-3 w-3"}),s.attachment_name||"View Attachment"]})})]})},s.id))}),t.status!=="closed"&&e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsx(o,{children:"Reply to Ticket"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(I,{value:h,onChange:s=>k(s.target.value),placeholder:"Type your message here...",rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-[250px]",children:e.jsx(f,{type:"file",onChange:s=>{var a;return _(((a=s.target.files)==null?void 0:a[0])||null)},className:"h-8 text-xs cursor-pointer"})}),e.jsx(l,{onClick:U,disabled:!h.trim()&&!y||g.isPending,children:g.isPending?"Sending...":"Send Reply"})]})]})]})]})]})]}):e.jsx(e.Fragment,{children:i!=null&&i.length?e.jsx(A,{children:e.jsx(E,{className:"p-0",children:e.jsxs(he,{children:[e.jsx(me,{children:e.jsxs(O,{children:[e.jsx(u,{children:"Subject"}),e.jsx(u,{children:"Priority"}),e.jsx(u,{children:"Status"}),e.jsx(u,{className:"text-right",children:"Last Updated"})]})}),e.jsx(ue,{children:i.map(s=>{var a;return e.jsxs(O,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>b(s.id),children:[e.jsx(p,{className:"font-medium",children:s.subject}),e.jsx(p,{children:e.jsx(m,{variant:H[s.priority]??"secondary",className:"text-xs",children:s.priority})}),e.jsx(p,{children:e.jsx(m,{variant:((a=F[s.status])==null?void 0:a.color)??"secondary",className:"text-xs",children:s.status.replace("_"," ")})}),e.jsx(p,{className:"text-right text-xs text-muted-foreground",children:new Date(s.updated_at).toLocaleDateString()})]},s.id)})})]})})}):e.jsx(pe,{icon:ae,title:"No tickets",description:"You haven't created any support tickets yet."})})]})]})}export{_e as default};
