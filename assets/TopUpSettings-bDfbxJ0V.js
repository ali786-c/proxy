import{Q as T,V as U,r as j,U as k,j as e,a as E,I as i,D as P,Y as A,q as B,e as R,x as D,y as F,z as q,E as M,J as y,t as N,ae as v,af as $,aU as I,ag as L}from"./index-DLv-_11A.js";import{S as Q}from"./SEOHead-D5fuhoMQ.js";import{C as d,a as m,b as u,c as p,d as V}from"./card-a0hC1Dpt.js";import{L as l}from"./label-xrehxqYh.js";import{S as x}from"./switch-BZyC2-T6.js";import{B as _}from"./badge-CxiN3S2c.js";import{u as O}from"./useMutation-BxYmRP84.js";import{S as H}from"./save-8zaQwj_d.js";import{R as K}from"./refresh-cw-CZy2eFV2.js";import{B as W}from"./bitcoin-DH2NqpVS.js";const b=[{id:"stripe",name:"Stripe",icon:A,desc:"Charge client's saved card via Stripe"},{id:"paypal",name:"PayPal",icon:B,desc:"Charge client's PayPal agreement"},{id:"crypto",name:"Crypto Wallet",icon:W,desc:"Deduct from client's crypto deposit"}];function re(){const C=T(),{gateways:h}=U(),[t,f]=j.useState({}),{data:c={},isLoading:S}=k({queryKey:["admin-settings"],queryFn:()=>v.get("/admin/settings",I(L()))});j.useEffect(()=>{c&&f(c)},[c]);const o=O({mutationFn:s=>v.post("/admin/settings",$,s),onSuccess:()=>{C.invalidateQueries({queryKey:["admin-settings"]}),N({title:"Settings Saved",description:"Top-up configuration updated successfully."})},onError:s=>N({title:"Error",description:s.message,variant:"destructive"})}),a=(s,r)=>{f(n=>({...n,[s]:r}))},w=()=>{o.mutate(t)};if(S)return e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading configurations..."});const g=t.auto_topup_enabled==="1"||t.auto_topup_enabled===!0;return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Top-Up Settings",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Top-Up & Balance Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure automatic balance top-up for client accounts."})]}),e.jsxs(E,{onClick:w,disabled:o.isPending,children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),o.isPending?"Saving...":"Save All Settings"]})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center gap-2 text-lg",children:[e.jsx(K,{className:"h-5 w-5"})," Client Auto Top-Up"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up for Clients"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Allow clients to opt-in to automatic balance replenishment"})]}),e.jsx(x,{checked:g,onCheckedChange:s=>a("auto_topup_enabled",s)})]}),g&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(l,{children:"Min Balance Threshold ($)"}),e.jsx(i,{type:"number",value:t.min_balance_threshold||"5",onChange:s=>a("min_balance_threshold",s.target.value)}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Top-up triggers when balance falls below this"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(l,{children:"Default Top-Up Amount ($)"}),e.jsx(i,{type:"number",value:t.default_topup_amount||"50",onChange:s=>a("default_topup_amount",s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(l,{children:"Max Monthly Top-Up ($)"}),e.jsx(i,{type:"number",value:t.max_monthly_topup||"500",onChange:s=>a("max_monthly_topup",s.target.value)}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Safety cap per client per month"})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2 text-lg",children:[e.jsx(P,{className:"h-5 w-5"})," Auto Top-Up Source Provider"]}),e.jsx(V,{children:"Choose which payment method to charge clients from when auto top-up triggers."})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:b.map(s=>{const r=h[s.id],n=t.topup_source_primary===s.id;return e.jsxs("button",{onClick:()=>r&&a("topup_source_primary",s.id),disabled:!r,className:`relative flex flex-col items-center gap-2 rounded-lg border-2 p-4 transition-all text-center ${n?"border-primary bg-primary/5":r?"border-border hover:border-primary/50 cursor-pointer":"border-border opacity-40 cursor-not-allowed"}`,children:[n&&e.jsx("div",{className:"absolute top-2 right-2 rounded-full bg-primary p-0.5",children:e.jsx(R,{className:"h-3 w-3 text-primary-foreground"})}),e.jsx(s.icon,{className:`h-6 w-6 ${n?"text-primary":"text-muted-foreground"}`}),e.jsx("span",{className:"font-semibold text-sm",children:s.name}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:s.desc}),!r&&e.jsx(_,{variant:"secondary",className:"text-[10px]",children:"Gateway disabled"}),n&&e.jsx(_,{className:"text-[10px]",children:"Primary"})]},s.id)})}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(l,{children:"Fallback Source"}),e.jsxs(D,{value:t.topup_source_fallback||"none",onValueChange:s=>a("topup_source_fallback",s),children:[e.jsx(F,{children:e.jsx(q,{})}),e.jsxs(M,{children:[e.jsx(y,{value:"none",children:"No fallback"}),b.filter(s=>s.id!==t.topup_source_primary&&h[s.id]).map(s=>e.jsx(y,{value:s.id,children:s.name},s.id))]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Used if primary source fails"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(l,{children:"Retry Attempts"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{type:"number",value:t.retry_attempts||"3",onChange:s=>a("retry_attempts",s.target.value),className:"w-20"}),e.jsx("span",{className:"text-sm text-muted-foreground self-center",children:"attempts, every"}),e.jsx(i,{type:"number",value:t.retry_interval||"60",onChange:s=>a("retry_interval",s.target.value),className:"w-20"}),e.jsx("span",{className:"text-sm text-muted-foreground self-center",children:"min"})]})]})]})]})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(u,{className:"text-lg",children:"Top-Up Notifications"})}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Notify client on successful charge"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Send email when auto top-up completes"})]}),e.jsx(x,{checked:t.notify_client_success==="1"||t.notify_client_success===!0,onCheckedChange:s=>a("notify_client_success",s)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Notify admin on charge failure"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Alert when auto top-up fails after all retries"})]}),e.jsx(x,{checked:t.notify_admin_failure==="1"||t.notify_admin_failure===!0,onCheckedChange:s=>a("notify_admin_failure",s)})]})]})]})]})]})}export{re as default};
