import{j as e,x as y,y as E,z as M,A as R,E as q,H as F}from"./ui-BpDXiumg.js";import{q as r,M as b,v as m,r as H,a0 as P,o,s,Y as p,N as n,a1 as u,$ as L,a2 as U,i as I,j as K,B as S,I as Q,t as k}from"./index-Ck7z1012.js";import{u as X}from"./useMutation-uhtpKmZt.js";import{S as z}from"./SEOHead-CHfoSTEG.js";import{C as O,a as V,b as Y,c as G}from"./card-NvV88nEZ.js";import{T as J,a as W,b as g,c as l,d as Z,e as d}from"./table-N-EE5-8s.js";import{r as A,an as ee,X as se,d as ae}from"./vendor-CXoGxISd.js";import{L as te}from"./label-BO-7FaBh.js";const ne=o({total_users:n(),active_subs:n(),bandwidth_30d_gb:n(),error_rate:n(),top_geos:m(o({country:s(),bandwidth_gb:n()}))}),D=o({id:s(),email:s(),name:s(),role:u(["client","admin"]),status:u(["active","suspended","pending"]),plan:s(),allowlist_count:n(),keys_count:n(),bandwidth_used_gb:n(),created_at:s()});o({status:u(["active","suspended"]).optional(),role:u(["client","admin"]).optional(),daily_gb_cap:n().optional(),reset_keys:p().optional()});const f=o({id:s(),name:s(),proxy_type:s(),price_per_gb:n(),included_gb:n(),monthly_price:n(),is_active:p()});o({name:s().min(1),proxy_type:s().min(1),price_per_gb:n().min(0),included_gb:n().min(0),monthly_price:n().min(0),is_active:p()});const ie=o({id:s(),actor:s(),action:s(),target:s().optional(),meta:L(U()).optional(),timestamp:s()}),re=o({id:s(),title:s(),slug:s(),status:u(["draft","queued","published"]),keywords:m(s()),author:s(),created_at:s(),published_at:s().nullable()}),$=o({error_spike_pct:n(),ban_spike_pct:n(),spend_cap_usd:n(),unusual_geo_threshold:n(),notify_email:p(),notify_webhook:p(),webhook_url:s()}),B={getKpis:()=>r.get("/admin/kpis",ne),getUsers:a=>r.get(`/admin/users${a?`?${a}`:""}`,P(D)),patchUser:(a,i)=>r.patch(`/admin/users/${a}`,D,i),getProducts:()=>r.get("/admin/products",m(f)),createProduct:a=>r.post("/admin/products",f,a),updateProduct:(a,i)=>r.patch(`/admin/products/${a}`,f,i),getAudit:a=>r.get(`/admin/audit${a?`?${a}`:""}`,P(ie)),getBlogPosts:()=>r.get("/admin/blog/posts",m(re)),publishPost:(a,i)=>r.post("/admin/blog/publish",b,{id:a,scheduled_at:i}),regeneratePost:a=>r.post("/admin/blog/regenerate",b,{id:a}),getAlertConfig:()=>r.get("/admin/alerts",$),updateAlertConfig:a=>r.patch("/admin/alerts",$,a),getPendingCrypto:()=>r.get("/admin/crypto/pending",m(H())),approveCrypto:(a,i,c)=>r.post(`/admin/crypto/${a}/approve`,b,{status:i,admin_note:c})};function he(){var T;const a=I(),[i,c]=A.useState(null),[N,_]=A.useState(""),{data:v=[],isLoading:C}=K({queryKey:["admin-pending-crypto"],queryFn:()=>B.getPendingCrypto()}),j=X({mutationFn:({id:t,status:x,note:h})=>B.approveCrypto(t,x,h),onSuccess:t=>{k({title:"Success",description:t.message}),a.invalidateQueries({queryKey:["admin-pending-crypto"]}),c(null),_("")},onError:t=>{k({title:"Error",description:t.message,variant:"destructive"})}}),w=t=>{i&&j.mutate({id:i.id,status:t,note:N})};return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Manual Payment Verification",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Manual Payment Verification"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Review and approve crypto transactions submitted by users."})]}),e.jsxs(O,{children:[e.jsx(V,{children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-amber-500"})," Pending Review"]})}),e.jsx(G,{className:"p-0",children:e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(l,{children:"User"}),e.jsx(l,{children:"Currency"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"TXID"}),e.jsx(l,{children:"Submitted"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsxs(Z,{children:[C?e.jsx(g,{children:e.jsx(d,{colSpan:6,className:"h-24 text-center",children:"Loading pending payments..."})}):v.map(t=>{var x,h;return e.jsxs(g,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:(x=t.user)==null?void 0:x.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:(h=t.user)==null?void 0:h.email})]})}),e.jsx(d,{children:e.jsx(S,{variant:"outline",children:t.currency})}),e.jsxs(d,{className:"font-semibold",children:["€",Number(t.amount).toFixed(2)]}),e.jsx(d,{className:"font-mono text-[10px] max-w-[150px] truncate",children:t.txid}),e.jsx(d,{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleString()}),e.jsx(d,{className:"text-right space-x-2",children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>c(t),children:"Review"})})]},t.id)}),!C&&v.length===0&&e.jsx(g,{children:e.jsx(d,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No pending transactions."})})]})]})})]})]}),e.jsx(E,{open:!!i,onOpenChange:t=>!t&&c(null),children:e.jsxs(M,{children:[e.jsx(R,{children:e.jsx(q,{children:"Process Crypto Payment"})}),i&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"User:"}),e.jsx("span",{className:"font-medium",children:(T=i.user)==null?void 0:T.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-primary",children:["€",Number(i.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Currency:"}),e.jsx(S,{variant:"secondary",children:i.currency})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"TXID:"}),e.jsx("span",{className:"font-mono text-[10px] break-all bg-background p-1.5 rounded border",children:i.txid})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{children:"Admin Note (optional)"}),e.jsx(Q,{placeholder:"Reason for rejection or internal note...",value:N,onChange:t=>_(t.target.value)})]})]}),e.jsxs(F,{className:"gap-2",children:[e.jsxs(y,{variant:"destructive",className:"gap-2",onClick:()=>w("rejected"),disabled:j.isPending,children:[e.jsx(se,{className:"h-4 w-4"})," Reject"]}),e.jsxs(y,{className:"gap-2",onClick:()=>w("approved"),disabled:j.isPending,children:[e.jsx(ae,{className:"h-4 w-4"})," Approve & Credit Balance"]})]})]})})]})}export{he as default};
