import{j as e,x as o}from"./ui-A4Mg_2PO.js";import{r,K as O,W as le,aA as E,aE as ce,a3 as oe,aw as q,ay as de,a5 as ue,d as me,V as xe}from"./vendor-B1YgQW9R.js";import{S as he}from"./SEOHead-ClsiTI7-.js";import{C as y,a as g,b as v,d as pe,c as N}from"./card-CGPo2FAR.js";import{T as je,a as fe,b as z,c as b,d as ye,e as C}from"./table-BKfF2Z1b.js";import{k as ge,b as ve,j as G,I as w,B as M,l as Ne,c as m}from"./index-DZxfRMeM.js";import{L as A}from"./label-7BY5oMnS.js";import{S as be}from"./switch-DPmHtvdD.js";import{M as Ce}from"./ManualCryptoDialog-DVHqDsbE.js";const we=.22,d=5,Ae={paid:"default",pending:"secondary",failed:"destructive"};function $e(){const{toast:a}=ge(),[B]=r.useState("residential"),[h,F]=r.useState("50"),{gateways:x,autoTopUpEnabled:K}=ve(),[U,$]=r.useState(!1),[W,Y]=r.useState("50"),[Q,J]=r.useState("5"),[l,X]=r.useState(null),[p,V]=r.useState(""),[j,u]=r.useState(!1),[Z,_]=r.useState(!1),[t,S]=r.useState(null),[D,I]=r.useState(!1),{data:ee}=G({queryKey:["plans"],queryFn:()=>m.getPlans()}),{data:se}=G({queryKey:["invoices"],queryFn:()=>m.getInvoices()}),c=parseFloat(h)||0,T=t?t.discount:0,L=Math.max(0,c-T),f=l==="cryptomus"||l==="manual",R=f?0:L*we,P=L+R,k=c<d,te=async()=>{if(p.trim()){if(c<d){a({title:"Error",description:`Please enter an amount of at least €${d} first.`,variant:"destructive"});return}I(!0);try{const s=await m.validateCoupon(p.toUpperCase(),c);s.valid&&(S({code:s.code,discount:s.discount,type:s.type,value:s.value}),a({title:"Coupon Applied",description:`You saved €${s.discount.toFixed(2)}!`}))}catch(s){S(null),a({title:"Invalid Coupon",description:s.message||"This code is not valid.",variant:"destructive"})}finally{I(!1)}}},ae=s=>{a({title:"Product Selected",description:`Switching to ${s}.`})},ie=async s=>{if($(s),s)try{const{client_secret:i}=await m.createSetupIntent();a({title:"Card setup started",description:"Please follow the instructions to save your card for auto top-up."})}catch(i){a({title:"Setup Error",description:i.message,variant:"destructive"}),$(!1)}},ne=async()=>{if(k){a({title:"Minimum not met",description:`Minimum purchase is €${d}.`,variant:"destructive"});return}if(!l){a({title:"Select a payment method",description:"Please choose how you'd like to pay.",variant:"destructive"});return}if(l==="cryptomus"){u(!0);try{const{url:s}=await m.createCryptomusCheckout(c,t==null?void 0:t.code);window.location.href=s}catch(s){a({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{u(!1)}}else if(l==="stripe"){u(!0);try{const{url:s}=await m.createCheckout(B,c,t==null?void 0:t.code);window.location.href=s}catch(s){a({title:"Checkout Error",description:s.message,variant:"destructive"})}finally{u(!1)}}else l==="manual"?_(!0):a({title:`Pay with ${l}`,description:`Redirecting to ${l} checkout for €${P.toFixed(2)}...`})},H=[{id:"stripe",name:"Card (Stripe)",subtitle:"Credit/Debit Card",icon:O,vatLabel:"+22% VAT",enabled:x.stripe},{id:"paypal",name:"PayPal",subtitle:"PayPal Balance",icon:le,vatLabel:"+22% VAT",enabled:x.paypal},{id:"cryptomus",name:"Crypto",subtitle:"Automated via Cryptomus",icon:E,vatLabel:"No VAT",enabled:x.cryptomus},{id:"manual",name:"Binance Pay",subtitle:"Manual Transfer",icon:E,vatLabel:"No VAT",enabled:x.crypto}],re=H.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(he,{title:"Account & Billing",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Account & Billing"}),e.jsxs(y,{children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ce,{className:"h-5 w-5"})," Add Balance"]}),e.jsxs(pe,{children:["Minimum purchase: €",d,". 22% VAT applies to card & PayPal payments. Crypto is VAT-free."]})]}),e.jsxs(N,{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 max-w-lg",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(A,{children:"Amount (€)"}),e.jsx(w,{type:"number",value:h,onChange:s=>F(s.target.value),min:d,step:"1",placeholder:`Min €${d}`}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["10","25","50","100"].map(s=>e.jsxs(o,{variant:"outline",size:"sm",className:`text-xs h-7 px-3 ${h===s?"border-primary bg-primary/5 text-primary":""}`,onClick:()=>F(s),children:["€",s]},s))}),k&&c>0&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"})," Minimum purchase is €",d]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(A,{children:"Promo Code (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"WELCOME20",value:p,onChange:s=>V(s.target.value),className:t?"border-green-500 bg-green-500/5":"",disabled:!!t}),t?e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{S(null),V("")},children:"Remove"}):e.jsx(o,{variant:"outline",size:"sm",className:"shrink-0",onClick:te,disabled:D||!p.trim(),children:D?e.jsx(q,{className:"h-4 w-4 animate-spin"}):"Apply"})]}),t&&e.jsxs("p",{className:"text-[11px] text-green-600 font-medium",children:[" Coupon applied: ",t.type==="percentage"?`${t.value}%`:`€${t.value}`," off"]})]})]}),!re&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No payment methods are currently available. Please contact support."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:H.map(s=>{const i=s.enabled,n=l===s.id;return e.jsxs(o,{variant:n?"default":"outline",className:`h-auto py-4 flex-col gap-1 relative ${i?"":"opacity-40 cursor-not-allowed"}`,disabled:!i,onClick:()=>X(s.id),children:[e.jsx(s.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-[11px] font-normal opacity-80",children:s.subtitle}),e.jsx(M,{variant:s.id==="crypto"||s.id==="manual"?"default":"secondary",className:"text-[10px] mt-1",children:s.vatLabel}),!i&&e.jsx("span",{className:"text-[10px] font-normal",children:"Not available"})]},s.id)})}),l&&c>=d&&e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 max-w-sm space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["€",c.toFixed(2)]})]}),T>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 font-medium font-mono",children:[e.jsxs("span",{children:["Discount (",t==null?void 0:t.code,")"]}),e.jsxs("span",{children:["-€",T.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["VAT (22%)",f&&e.jsx(de,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("span",{className:f?"line-through text-muted-foreground":"",children:f?"€0.00 — exempt":`€${R.toFixed(2)}`})]}),e.jsx(Ne,{}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["€",P.toFixed(2)]})]}),e.jsxs(o,{className:"w-full mt-2",onClick:ne,disabled:k||j,children:[j?e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Pay €",P.toFixed(2)]})]})]})]}),K&&e.jsxs(y,{children:[e.jsx(g,{children:e.jsxs(v,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ue,{className:"h-5 w-5"})," Auto Top-Up"]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Auto Top-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically add balance when it drops below the threshold"})]}),e.jsx(be,{checked:U,onCheckedChange:ie})]}),U&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(A,{children:"Min Balance Threshold (€)"}),e.jsx(w,{type:"number",value:Q,onChange:s=>J(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(A,{children:"Top-Up Amount (€)"}),e.jsx(w,{type:"number",value:W,onChange:s=>Y(s.target.value)})]})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-3",children:(ee||[]).map(s=>{const i=s.id===B;return e.jsxs(y,{className:i?"border-primary ring-2 ring-primary/20":"",children:[e.jsx(g,{className:"pb-2",children:e.jsxs(v,{className:"flex items-center justify-between text-lg",children:[s.name,i&&e.jsx(M,{children:"Active"})]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("p",{className:"text-3xl font-bold",children:["€",(s.price_cents/100).toFixed(2),e.jsxs("span",{className:"text-base font-normal text-muted-foreground",children:["/",(s.id==="datacenter","GB")]})]}),e.jsx("ul",{className:"space-y-1.5",children:s.features.map(n=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(me,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),n]},n))}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{variant:i?"outline":"default",className:"w-full",disabled:i,onClick:()=>ae(s.id),children:i?"Active Product":"Select Product"}),!i&&e.jsxs("div",{className:"flex flex-col gap-2",children:[x.stripe&&e.jsxs(o,{variant:"secondary",className:"w-full gap-2",disabled:j,onClick:async()=>{u(!0);try{const{url:n}=await m.createProductCheckout(s.id,1);window.location.href=n}catch(n){a({title:"Purchase Error",description:n.message,variant:"destructive"})}finally{u(!1)}},children:[e.jsx(O,{className:"h-4 w-4"})," Buy with Card"]}),x.cryptomus&&e.jsxs(o,{variant:"outline",className:"w-full gap-2 border-primary/20 hover:border-primary/50",disabled:j,onClick:async()=>{u(!0);try{const{url:n}=await m.createCryptomusProductCheckout(s.id,1);window.location.href=n}catch(n){a({title:"Purchase Error",description:n.message,variant:"destructive"})}finally{u(!1)}},children:[e.jsx(E,{className:"h-4 w-4 text-orange-500"})," Buy with Crypto"]})]})]})]})]},s.id)})}),e.jsxs(y,{children:[e.jsx(g,{children:e.jsx(v,{className:"text-lg",children:"Recent Invoices"})}),e.jsx(N,{className:"p-0",children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(z,{children:[e.jsx(b,{children:"Period"}),e.jsx(b,{children:"Amount"}),e.jsx(b,{children:"Status"}),e.jsx(b,{className:"text-right",children:"Date"})]})}),e.jsx(ye,{children:(se||[]).map(s=>e.jsxs(z,{children:[e.jsx(C,{className:"font-medium",children:s.period}),e.jsxs(C,{children:["€",(s.amount_cents/100).toFixed(2)]}),e.jsx(C,{children:e.jsx(M,{variant:Ae[s.status]??"secondary",children:s.status})}),e.jsxs(C,{className:"text-right text-sm text-muted-foreground space-x-2",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.pdf_url&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"Download PDF",children:e.jsx("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(xe,{className:"h-3.5 w-3.5"})})})]})]},s.id))})]})})]})]}),e.jsx(Ce,{open:Z,onOpenChange:_,defaultAmount:h})]})}export{$e as default};
