import{j as e,y as L,J as k,x as c,z as B,A as R,E as z}from"./ui-BvSIVwgG.js";import{r as C,G as F,aC as H,a2 as M,an as j,aL as A,am as Q,aD as V}from"./vendor-co0Zkaum.js";import{a as P,j as X,I as G,e as K,f as O,g as U,h as J,i as l,B as t,t as x,k as W}from"./index-BT6JCiqt.js";import{u as N}from"./useMutation-DDLa6Ofn.js";import{s as y}from"./client-DBtcxyoE.js";import{C as D,a as _,b,d as Y,c as w}from"./card-0KzbiLUl.js";import{L as S}from"./label-D7lsv8RO.js";import{T as $,a as Z,b as p,c as o,d as ee,e as n}from"./table-gVuxc4b7.js";const T={active:{variant:"default",icon:A},issuing:{variant:"outline",icon:j},pending:{variant:"secondary",icon:j},failed:{variant:"destructive",icon:M}};function se(){const{user:i}=P();return W({queryKey:["custom-domains",i==null?void 0:i.id],enabled:!!(i!=null&&i.id),queryFn:async()=>{const{data:r,error:m}=await y.from("custom_proxy_domains").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});if(m)throw m;return r??[]}})}function le(){const{user:i}=P(),{data:r,isLoading:m}=se(),g=X(),[E,f]=C.useState(!1),[d,h]=C.useState({domain:"",proxy_type:"residential"}),u=N({mutationFn:async()=>{const s=`uproxy-verify-${crypto.randomUUID().slice(0,12)}`,{error:a}=await y.from("custom_proxy_domains").insert({user_id:i.id,domain:d.domain,proxy_type:d.proxy_type,dns_txt_record:s});if(a)throw a},onSuccess:()=>{g.invalidateQueries({queryKey:["custom-domains"]}),x({title:"Domain added! Configure DNS to complete setup."}),f(!1),h({domain:"",proxy_type:"residential"})},onError:s=>x({title:"Error",description:s.message,variant:"destructive"})}),q=N({mutationFn:async s=>{const{error:a}=await y.from("custom_proxy_domains").delete().eq("id",s);if(a)throw a},onSuccess:()=>{g.invalidateQueries({queryKey:["custom-domains"]}),x({title:"Domain removed"})}}),I=s=>{navigator.clipboard.writeText(s),x({title:"Copied to clipboard"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(F,{className:"h-6 w-6"})," Custom Proxy Domains"]}),e.jsx("p",{className:"text-muted-foreground",children:"Use your own domain for proxy endpoints"})]}),e.jsxs(L,{open:E,onOpenChange:f,children:[e.jsx(k,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Add Domain"]})}),e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(z,{children:"Add Custom Proxy Domain"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Domain"}),e.jsx(G,{placeholder:"proxy.yourdomain.com",value:d.domain,onChange:s=>h(a=>({...a,domain:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Proxy Type"}),e.jsxs(K,{value:d.proxy_type,onValueChange:s=>h(a=>({...a,proxy_type:s})),children:[e.jsx(O,{children:e.jsx(U,{})}),e.jsxs(J,{children:[e.jsx(l,{value:"residential",children:"Residential"}),e.jsx(l,{value:"datacenter",children:"Datacenter"}),e.jsx(l,{value:"mobile",children:"Mobile"}),e.jsx(l,{value:"isp",children:"ISP"})]})]})]}),e.jsx(c,{onClick:()=>u.mutate(),disabled:u.isPending||!d.domain,className:"w-full",children:u.isPending?"Adding…":"Add Domain"})]})]})]})]}),e.jsxs(D,{children:[e.jsxs(_,{children:[e.jsx(b,{children:"DNS Setup Instructions"}),e.jsx(Y,{children:"Add a CNAME record pointing your domain to our proxy endpoint, then add the TXT record to verify ownership."})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(t,{variant:"outline",children:"1"}),e.jsxs("span",{children:["Add a ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"CNAME"})," record: ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"proxy.yourdomain.com → endpoint.upgraderproxy.com"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(t,{variant:"outline",children:"2"}),e.jsxs("span",{children:["Add a ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"TXT"})," record with the verification value shown below"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(t,{variant:"outline",children:"3"}),e.jsx("span",{children:"Wait for DNS propagation and SSL provisioning (up to 24 hours)"})]})]})})]}),e.jsxs(D,{children:[e.jsx(_,{children:e.jsx(b,{children:"Your Domains"})}),e.jsx(w,{children:e.jsxs($,{children:[e.jsx(Z,{children:e.jsxs(p,{children:[e.jsx(o,{children:"Domain"}),e.jsx(o,{children:"Proxy Type"}),e.jsx(o,{children:"DNS Verified"}),e.jsx(o,{children:"SSL Status"}),e.jsx(o,{children:"TXT Record"}),e.jsx(o,{children:"Actions"})]})}),e.jsxs(ee,{children:[r==null?void 0:r.map(s=>{var v;const a=T[s.ssl_status]??T.pending;return e.jsxs(p,{children:[e.jsx(n,{className:"font-medium",children:s.domain}),e.jsx(n,{className:"capitalize",children:s.proxy_type}),e.jsx(n,{children:s.dns_verified?e.jsxs(t,{variant:"default",children:[e.jsx(A,{className:"mr-1 h-3 w-3"}),"Verified"]}):e.jsxs(t,{variant:"secondary",children:[e.jsx(j,{className:"mr-1 h-3 w-3"}),"Pending"]})}),e.jsx(n,{children:e.jsxs(t,{variant:a.variant,children:[e.jsx(a.icon,{className:"mr-1 h-3 w-3"}),s.ssl_status]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("code",{className:"bg-muted px-1 rounded text-xs",children:[(v=s.dns_txt_record)==null?void 0:v.slice(0,20),"…"]}),e.jsx(c,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>I(s.dns_txt_record??""),children:e.jsx(Q,{className:"h-3 w-3"})})]})}),e.jsx(n,{children:e.jsx(c,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive",onClick:()=>q.mutate(s.id),children:e.jsx(V,{className:"h-4 w-4"})})})]},s.id)}),!(r!=null&&r.length)&&e.jsx(p,{children:e.jsx(n,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No custom domains configured"})})]})]})})]})]})}export{le as default};
