import{r as h,j as e,I as N,q as S,v,w as C,x as _,y as p}from"./index-DroWz3-G.js";import{S as T}from"./SEOHead-BWHcznh9.js";import{C as b,c as A}from"./card-CnocJ3Vi.js";import{B as L}from"./badge-BzW6HVQQ.js";import{T as y,a as I,b as n,c as r,d as q,e as s}from"./table-BZIvQM2r.js";import{u as F}from"./useQuery-D5H6PY99.js";import{a as O}from"./api-CW1y2m9B.js";import{S as R}from"./search-DabmYS3s.js";const B={ban:"destructive",deduct:"destructive",unban:"default",top_up:"default",update:"secondary",reply:"secondary",create:"default"};function K(){const[c,j]=h.useState(""),[d,g]=h.useState("all"),{data:o,isLoading:l}=F({queryKey:["audit-log",d],queryFn:async()=>{const{data:t}=await O.get("/admin/logs");return t??[]}}),x=(o??[]).filter(t=>{var i,m,u;if(!c)return!0;const a=c.toLowerCase();return t.action.toLowerCase().includes(a)||((i=t.target_id)==null?void 0:i.toLowerCase().includes(a))||((m=t.ip_address)==null?void 0:m.toLowerCase().includes(a))||((u=t.geo_country)==null?void 0:u.toLowerCase().includes(a))}),f=[...new Set((o??[]).map(t=>t.action.split("_")[0]))],w=t=>new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Admin — Audit Log",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review all system-wide activity with IP & geo tracking."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(R,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(N,{placeholder:"Search action, target, IP, country…",value:c,onChange:t=>j(t.target.value),className:"pl-9"})]}),e.jsxs(S,{value:d,onValueChange:g,children:[e.jsx(v,{className:"w-[150px]",children:e.jsx(C,{placeholder:"Action type"})}),e.jsxs(_,{children:[e.jsx(p,{value:"all",children:"All actions"}),f.map(t=>e.jsx(p,{value:t,className:"capitalize",children:t},t))]})]})]}),e.jsx(b,{children:e.jsx(A,{className:"p-0",children:e.jsxs(y,{children:[e.jsx(I,{children:e.jsxs(n,{children:[e.jsx(r,{children:"Timestamp"}),e.jsx(r,{children:"Action"}),e.jsx(r,{children:"Target"}),e.jsx(r,{children:"IP Address"}),e.jsx(r,{children:"Location"}),e.jsx(r,{children:"Meta"})]})}),e.jsxs(q,{children:[l&&e.jsx(n,{children:e.jsx(s,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"Loading…"})}),!l&&x.map(t=>{var i;const a=t.action.split("_")[0];return e.jsxs(n,{children:[e.jsx(s,{className:"text-sm text-muted-foreground whitespace-nowrap",children:w(t.created_at)}),e.jsx(s,{children:e.jsx(L,{variant:B[a]??"outline",className:"text-xs",children:t.action})}),e.jsx(s,{className:"text-sm font-mono text-xs",children:t.target_user_id?`UserID: ${t.target_user_id}`:"System"}),e.jsxs(s,{className:"text-sm font-mono text-xs",children:["Admin: ",((i=t.admin)==null?void 0:i.name)||t.admin_id]}),e.jsx(s,{className:"text-sm",children:t.details}),e.jsx(s,{className:"text-xs text-muted-foreground max-w-[200px] truncate",children:t.created_at})]},t.id)}),!l&&x.length===0&&e.jsx(n,{children:e.jsx(s,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No audit entries found."})})]})]})})})]})]})}export{K as default};
