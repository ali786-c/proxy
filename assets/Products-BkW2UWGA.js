import{c as R,U,r as h,V as q,j as e,a as u,I as m,x as N,y as b,z as C,E as P,J as n,t as S,ae as x,af as Q,o as G,s as j,ak as v,aQ as H,ah as K}from"./index-D65ms4fs.js";import{S as V}from"./SEOHead-DMypS0Q_.js";import{C as k,c as T}from"./card-SW7E2qhK.js";import{L as l}from"./label-DRxv4uEh.js";import{B as $}from"./badge-DNHHJ4Xd.js";import{S as J}from"./switch-D3nNpzLE.js";import{D as Y,b as W,c as X,d as Z,e as ee}from"./dialog-CG2ry0Cy.js";import{T as se,a as ae,b as F,c as r,d as te,e as c}from"./table-BxfCvPeV.js";import{u as B}from"./useMutation-BLhcnqBb.js";import{P as ie}from"./plus-Bp4B8_4Y.js";import{T as re}from"./trash-2-Caunqqso.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=R("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),_=G({id:v.string(),name:j(),type:j(),price:v.number(),is_active:v.number().or(H()).optional().default(!0),evomi_product_id:j().nullable().optional()}),E={name:"",proxy_type:"residential",unit:"GB",base_cost_eur:"",markup_pct:"0",is_active:!0,evomi_product_id:""};function _e(){const y=U(),[I,d]=h.useState(!1),[o,g]=h.useState(null),[a,i]=h.useState(E),{data:p,isLoading:M}=q({queryKey:["admin-products"],queryFn:async()=>(await x.get("/admin/products",K(_))).map(t=>({id:String(t.id),name:t.name,proxy_type:t.type,unit:t.type==="isp"?"IP":"GB",base_cost_eur:Number(t.price),sell_price_eur:Number(t.price),markup_pct:0,is_active:!!t.is_active,evomi_product_id:t.evomi_product_id}))}),w=B({mutationFn:s=>o?x.put(`/admin/products/${o}`,_,s):x.post("/admin/products",_,s),onSuccess:()=>{y.invalidateQueries({queryKey:["admin-products"]}),d(!1),S({title:`Product ${o?"updated":"created"} successfully`})}}),D=B({mutationFn:s=>x.delete(`/admin/products/${s}`,Q),onSuccess:()=>{y.invalidateQueries({queryKey:["admin-products"]}),S({title:"Product deleted"})}});if(M)return e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading products..."});const A=()=>{g(null),i(E),d(!0)},z=s=>{window.confirm("Are you sure you want to delete this product?")&&D.mutate(s)},L=s=>{g(s.id),i({name:s.name,proxy_type:s.proxy_type,unit:s.unit,base_cost_eur:String(s.base_cost_eur),markup_pct:"0",is_active:s.is_active,evomi_product_id:s.evomi_product_id||""}),d(!0)},f=()=>{const s=parseFloat(a.base_cost_eur)||0,t=parseFloat(a.markup_pct)||0;return(s*(1+t/100)).toFixed(2)},O=()=>{w.mutate({name:a.name,type:a.proxy_type,price:parseFloat(f()),is_active:a.is_active,evomi_product_id:a.evomi_product_id})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"Admin — Products",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage proxy product catalog. All prices flat-rate in EUR with 30% markup over base cost."})]}),e.jsxs(u,{onClick:A,children:[e.jsx(ie,{className:"mr-2 h-4 w-4"})," Add Product"]})]}),e.jsx(k,{children:e.jsx(T,{className:"p-0",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(F,{children:[e.jsx(r,{children:"Product"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Unit"}),e.jsx(r,{className:"text-right",children:"Base Cost"}),e.jsx(r,{className:"text-right",children:"Markup"}),e.jsx(r,{className:"text-right",children:"Sell Price"}),e.jsx(r,{children:"Status"}),e.jsx(r,{})]})}),e.jsx(te,{children:p==null?void 0:p.map(s=>e.jsxs(F,{children:[e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{className:"capitalize",children:s.proxy_type}),e.jsxs(c,{children:["per ",s.unit]}),e.jsxs(c,{className:"text-right",children:["€",s.base_cost_eur.toFixed(2)]}),e.jsxs(c,{className:"text-right",children:[s.markup_pct,"%"]}),e.jsxs(c,{className:"text-right font-semibold",children:["€",s.sell_price_eur.toFixed(2),"/",s.unit]}),e.jsx(c,{children:e.jsx($,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>L(s),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>z(s.id),children:e.jsx(re,{className:"h-4 w-4 text-destructive"})})]})})]},s.id))})]})})}),e.jsx(k,{children:e.jsxs(T,{className:"py-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Pricing Model"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"All products use flat-rate pricing in EUR. The sell price = base cost × (1 + markup%). Same price for all customers regardless of volume — no tiers, no volume discounts."})]})})]}),e.jsx(Y,{open:I,onOpenChange:d,children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsx(Z,{children:o?"Edit Product":"Create Product"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{children:"Name"}),e.jsx(m,{value:a.name,onChange:s=>i({...a,name:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{children:"Proxy Type"}),e.jsxs(N,{value:a.proxy_type,onValueChange:s=>i({...a,proxy_type:s}),children:[e.jsx(b,{children:e.jsx(C,{})}),e.jsxs(P,{children:[e.jsx(n,{value:"residential",children:"Residential"}),e.jsx(n,{value:"datacenter",children:"Datacenter"}),e.jsx(n,{value:"isp",children:"ISP"}),e.jsx(n,{value:"mobile",children:"Mobile"}),e.jsx(n,{value:"socks5",children:"SOCKS5"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{children:"Billing Unit"}),e.jsxs(N,{value:a.unit,onValueChange:s=>i({...a,unit:s}),children:[e.jsx(b,{children:e.jsx(C,{})}),e.jsxs(P,{children:[e.jsx(n,{value:"GB",children:"Per GB"}),e.jsx(n,{value:"IP",children:"Per IP"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{children:"Base Cost (€)"}),e.jsx(m,{type:"number",step:"0.01",value:a.base_cost_eur,onChange:s=>i({...a,base_cost_eur:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{children:"Markup (%)"}),e.jsx(m,{type:"number",value:a.markup_pct,onChange:s=>i({...a,markup_pct:s.target.value})})]})]}),e.jsx("div",{className:"rounded-md bg-muted/50 p-3",children:e.jsxs("p",{className:"text-sm",children:["Sell Price: ",e.jsxs("span",{className:"font-bold text-primary",children:["€",f(),"/",a.unit]})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{children:"Evomi Product ID (External)"}),e.jsx(m,{placeholder:"e.g. residential_premium",value:a.evomi_product_id,onChange:s=>i({...a,evomi_product_id:s.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{checked:a.is_active,onCheckedChange:s=>i({...a,is_active:s})}),e.jsx(l,{children:"Active"})]})]}),e.jsxs(ee,{children:[e.jsx(u,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(u,{onClick:O,children:o?"Update":"Create"})]})]})})]})}export{_e as default};
