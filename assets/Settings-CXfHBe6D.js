import{j as e,U as B,S as K,r,N as g,I as p,b as O,B as o,t as f}from"./index-Iz4kkqCE.js";import{S as Y}from"./SEOHead-oF7wrK92.js";import{E as $}from"./ErrorBanner-D5piLh8f.js";import{E}from"./EmptyState-D-hLkTuM.js";import{L as C}from"./label-k-ijTSLy.js";import{C as w,c as b,a as A,b as S}from"./card-DX92aLG2.js";import{T as L,a as F,b as I,c as h,d as R,e as u}from"./table-o_ecQQMq.js";import{T as q,a as M,b as k,c as D}from"./tabs-AM37__4W.js";import{D as V,a as W,b as Z,c as G,d as J,e as T}from"./dialog-DjkUJwoW.js";import{e as Q,f as X,g as ee,h as se}from"./use-backend-Be-cx8fF.js";import{K as _}from"./key-DpEv6bCl.js";import{P as z}from"./plus-BxEfa3nR.js";import{T as H}from"./trash-2-GtKnQc0b.js";import{C as ae}from"./copy-BlGVYUYg.js";import"./circle-alert-C-qUaagi.js";import"./useQuery-Pz8e27gw.js";import"./useMutation-D81Zszij.js";import"./api-BTF2QDx4.js";function Pe(){return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Settings",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"}),e.jsxs(q,{defaultValue:"allowlist",children:[e.jsxs(M,{children:[e.jsxs(k,{value:"profile",children:[e.jsx(B,{className:"mr-1 h-3.5 w-3.5"})," Profile"]}),e.jsxs(k,{value:"allowlist",children:[e.jsx(K,{className:"mr-1 h-3.5 w-3.5"})," IP Allowlist"]}),e.jsxs(k,{value:"api-keys",children:[e.jsx(_,{className:"mr-1 h-3.5 w-3.5"})," API Keys"]})]}),e.jsx(D,{value:"profile",className:"mt-4",children:e.jsx(re,{})}),e.jsx(D,{value:"allowlist",className:"mt-4",children:e.jsx(te,{})}),e.jsx(D,{value:"api-keys",className:"mt-4",children:e.jsx(le,{})})]})]})]})}function te(){const{data:a,isLoading:y,addEntry:m,removeEntry:x}=ee(),[i,n]=r.useState(""),[j,l]=r.useState(""),[d,t]=r.useState(null),N=async()=>{var c,v;t(null);const s=i.trim();if(!s){t("IP address is required.");return}if(!/^\d{1,3}(\.\d{1,3}){3}(\/\d{1,2})?$/.test(s)){t("Enter a valid IPv4 address or CIDR range.");return}try{await m.mutateAsync({ip:s,label:j.trim()||void 0}),n(""),l(""),f({title:"IP Added",description:`${s} added to allowlist.`})}catch(P){t(((v=(c=P.response)==null?void 0:c.data)==null?void 0:v.message)||"Failed to add IP.")}};return y?e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx(g,{className:"h-20 w-full"}),e.jsx(g,{className:"h-40 w-full"})]}):e.jsxs(w,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"IP Allowlist"})}),e.jsxs(b,{className:"space-y-4",children:[d&&e.jsx($,{message:d,onDismiss:()=>t(null)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"203.0.113.0/24",value:i,onChange:s=>n(s.target.value),className:"max-w-xs"}),e.jsx(p,{placeholder:"Label (optional)",value:j,onChange:s=>l(s.target.value),className:"max-w-xs"}),e.jsx(o,{onClick:N,disabled:m.isPending,children:m.isPending?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-1 h-4 w-4"})," Add"]})})]}),!a||a.length===0?e.jsx(E,{icon:K,title:"No IPs allowlisted",description:"Add your server IPs to authenticate without credentials."}):e.jsxs(L,{children:[e.jsx(F,{children:e.jsxs(I,{children:[e.jsx(h,{children:"IP Address"}),e.jsx(h,{children:"Label"}),e.jsx(h,{children:"Added"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(R,{children:a.map(s=>e.jsxs(I,{children:[e.jsx(u,{className:"font-mono text-sm",children:s.ip}),e.jsx(u,{className:"text-sm text-muted-foreground",children:s.label??"—"}),e.jsx(u,{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(u,{children:e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>x.mutate(s.id),disabled:x.isPending,"aria-label":"Remove",children:e.jsx(H,{className:"h-4 w-4 text-destructive"})})})]},s.id))})]})]})]})}function le(){const{data:a,isLoading:y,createKey:m,revokeKey:x}=se(),[i,n]=r.useState(null),[j,l]=r.useState(!1),[d,t]=r.useState(""),N=async()=>{if(d.trim())try{const s=await m.mutateAsync(d.trim());n(s.api_key),t(""),l(!1),f({title:"API Key Created",description:"Copy it now — it won't be shown again."})}catch{f({title:"Error",description:"Failed to create API key.",variant:"destructive"})}};return y?e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx(g,{className:"h-20 w-full"}),e.jsx(g,{className:"h-40 w-full"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsx(S,{className:"text-lg",children:"API Keys"}),e.jsxs(V,{open:j,onOpenChange:s=>{l(s),s||(n(null),t(""))},children:[e.jsx(W,{asChild:!0,children:e.jsxs(o,{size:"sm",children:[e.jsx(z,{className:"mr-1 h-4 w-4"})," Create Key"]})}),e.jsxs(Z,{children:[e.jsx(G,{children:e.jsx(J,{children:i?"API Key Created":"Create API Key"})}),i?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg border bg-muted p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Your API Key (shown only once):"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 block text-xs font-mono text-primary break-all bg-background border p-2 rounded",children:i}),e.jsx(o,{size:"sm",onClick:()=>{navigator.clipboard.writeText(i),f({title:"Copied to clipboard"})},children:e.jsx(ae,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"text-xs text-destructive font-medium uppercase tracking-tight",children:"Warning: Copy this key now. You will not be able to see it again."}),e.jsx(T,{children:e.jsx(o,{className:"w-full",onClick:()=>l(!1),children:"Done"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Key Name"}),e.jsx(p,{value:d,onChange:s=>t(s.target.value),placeholder:"e.g. Production Server"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"API keys allow you to generate proxies and check usage programmatically."})]}),e.jsxs(T,{children:[e.jsx(o,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(o,{onClick:N,disabled:!d.trim()||m.isPending,children:m.isPending?"Creating...":"Create"})]})]})]})]})]}),e.jsx(b,{className:"p-0",children:!a||a.length===0?e.jsx("div",{className:"p-6",children:e.jsx(E,{icon:_,title:"No API keys",description:"Create a key to access the UpgradedProxy API programmatically."})}):e.jsxs(L,{children:[e.jsx(F,{children:e.jsxs(I,{children:[e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Key Prefix"}),e.jsx(h,{children:"Added"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(R,{children:a.map(s=>e.jsxs(I,{children:[e.jsx(u,{className:"font-medium text-sm",children:s.key_name}),e.jsxs(u,{className:"font-mono text-xs",children:[s.api_key.substring(0,12),"****"]}),e.jsx(u,{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(u,{children:e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>x.mutate(s.id),disabled:x.isPending,"aria-label":"Revoke",children:e.jsx(H,{className:"h-4 w-4 text-destructive"})})})]},s.id))})]})})]})})}function re(){const{data:a,isLoading:y}=Q(),m=X(),[x,i]=r.useState(""),[n,j]=r.useState(""),[l,d]=r.useState(""),[t,N]=r.useState(!1);r.useState(()=>{a!=null&&a.name&&i(a.name)});const s=async c=>{var v,P;if(c.preventDefault(),n&&n!==l){f({title:"Error",description:"Passwords do not match.",variant:"destructive"});return}N(!0);try{await m.mutateAsync({name:x||void 0,password:n||void 0,password_confirmation:l||void 0}),f({title:"Success",description:"Profile updated successfully."}),j(""),d("")}catch(U){f({title:"Error",description:((P=(v=U.response)==null?void 0:v.data)==null?void 0:P.message)||"Failed to update profile.",variant:"destructive"})}finally{N(!1)}};return y?e.jsx(w,{children:e.jsxs(b,{className:"pt-6 space-y-4",children:[e.jsx(g,{className:"h-10 w-full"}),e.jsx(g,{className:"h-10 w-full"}),e.jsx(g,{className:"h-10 w-24"})]})}):e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(w,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"Account Details"})}),e.jsx(b,{children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Email Address"}),e.jsx(p,{value:a==null?void 0:a.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Email cannot be changed manually. Contact support for assistance."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Display Name"}),e.jsx(p,{value:x||(a==null?void 0:a.name)||"",onChange:c=>i(c.target.value),placeholder:"Full Name"})]}),e.jsx("hr",{className:"my-6 border-border"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(C,{children:"Change Password"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"password",placeholder:"New Password",value:n,onChange:c=>j(c.target.value)}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center",children:"Minimum 8 characters"})]}),e.jsx(p,{type:"password",placeholder:"Confirm New Password",value:l,onChange:c=>d(c.target.value)})]})]}),e.jsx(o,{type:"submit",disabled:t,children:t?"Saving...":"Save Changes"})]})})]}),e.jsxs(w,{children:[e.jsx(A,{children:e.jsx(S,{className:"text-lg",children:"Danger Zone"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Delete Account"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permanently delete your account and all associated data."})]}),e.jsx(o,{variant:"destructive",size:"sm",children:"Delete Account"})]})})]})]})}export{Pe as default};
