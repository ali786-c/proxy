import{j as e,x as S}from"./ui-CeaNA1b8.js";import{r as f,ae as Q,I as J,E as V,al as Y,aQ as Z,aC as G,aT as W,w as X,aU as ee}from"./vendor-CSZBJNtL.js";import{S as se}from"./SEOHead-DXWOi5xF.js";import{C as g,c as b}from"./card-clxFFivi.js";import{L as ae,I as N,B as w,Z as te,_ as ne,$ as re,a0 as le,a1 as ie,t as o,k as D,j as de,y as u,C as $,M as E,o as q,Y as _,s as h,z}from"./index-CLM9UJVe.js";import{L as C}from"./label-5YbheAOU.js";import{T as ce,a as oe,b as A,c as x,d as me,e as m}from"./table-D3uMK-0w.js";import{u as ue}from"./useMutation-DzF42c1c.js";const I=q({id:_(),name:h().nullable(),email:h(),role:h(),balance:_().or(h()),custom_referral_rate:_().nullable().optional(),created_at:h()});function xe(){return D({queryKey:["admin-users"],queryFn:async()=>(await u.get("/admin/users",$(I))).map(d=>({...d,full_name:d.name,user_id:d.id,is_banned:d.role==="banned",user_roles:[{role:d.role}]}))})}function he(){const i=de();return ue({mutationFn:async d=>{const{action:n,...l}=d;if(n==="list_users")return u.get("/admin/users",$(I));if(n==="ban_user"||n==="unban_user")return u.post("/admin/users/ban",E,{user_id:l.user_id,reason:l.ban_reason||(n==="ban_user"?"Banned by admin":"Unbanned by admin")});if(n==="update_influencer_rate")return u.post("/admin/referrals/influencer-rate",E,{user_id:l.user_id,custom_rate:l.custom_rate});if(n==="adjust_balance")return u.post("/admin/users/balance",q({message:h(),new_balance:_()}),{user_id:l.user_id,amount:l.amount,reason:l.reason||"Admin adjustment"});if(n==="get_user_stats")return u.get("/admin/stats",z());throw new Error("Action not supported in Laravel bridge")},onSuccess:()=>i.invalidateQueries({queryKey:["admin-users"]})})}function je(i){return D({queryKey:["admin-user-stats",i],enabled:!!i,queryFn:async()=>u.get(`/admin/users/${i}/stats`,z())})}function Se(){var k,F,L;const{data:i,isLoading:d}=xe(),n=he(),[l,M]=f.useState(""),[a,j]=f.useState(null),[p,v]=f.useState(""),[B,y]=f.useState(""),{data:c}=je((a==null?void 0:a.user_id)??null);if(d)return e.jsx(ae,{});const U=(i??[]).filter(s=>{var t,r;return!(l&&!((t=s.email)!=null&&t.toLowerCase().includes(l.toLowerCase()))&&!((r=s.full_name)!=null&&r.toLowerCase().includes(l.toLowerCase())))}),P=async(s,t)=>{try{await n.mutateAsync({action:t?"unban_user":"ban_user",user_id:s,ban_reason:t?void 0:"Violated terms of service"}),j(null),o({title:t?"User unbanned":"User banned"})}catch(r){o({title:"Error",description:r.message,variant:"destructive"})}},T=async s=>{const t=parseFloat(p);if(!t||t<=0){o({title:"Invalid amount",variant:"destructive"});return}try{const r=await n.mutateAsync({action:"adjust_balance",user_id:a.user_id,amount:s?t:-t,reason:B||(s?"Admin top-up":"Admin deduction")});v(""),y(""),j(R=>R?{...R,balance:r.new_balance}:null),o({title:`Balance ${s?"topped up":"deducted"} successfully`})}catch(r){o({title:"Error",description:r.message,variant:"destructive"})}},K=(i??[]).length,H=(i??[]).filter(s=>s.is_banned).length,O=(i??[]).reduce((s,t)=>s+Number(t.balance??0),0);return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Admin — Users",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all registered users, balances, and access."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})}),e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Banned Users"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:H})]})}),e.jsx(g,{children:e.jsxs(b,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total User Balances"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",O.toFixed(2)]})]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(N,{placeholder:"Search by name or email…",value:l,onChange:s=>M(s.target.value),className:"pl-9"})]})}),e.jsx(g,{children:e.jsx(b,{className:"p-0",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(A,{children:[e.jsx(x,{children:"User"}),e.jsx(x,{children:"Role"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Balance"}),e.jsx(x,{children:"Influencer"}),e.jsx(x,{children:"Joined"})]})}),e.jsxs(me,{children:[U.map(s=>{var t,r;return e.jsxs(A,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>j(s),children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(m,{className:"capitalize",children:((r=(t=s.user_roles)==null?void 0:t[0])==null?void 0:r.role)??"client"}),e.jsx(m,{children:e.jsx(w,{variant:s.is_banned?"destructive":"default",children:s.is_banned?"Banned":"Active"})}),e.jsxs(m,{children:["$",Number(s.balance??0).toFixed(2)]}),e.jsx(m,{children:s.custom_referral_rate?e.jsxs(w,{variant:"outline",className:"text-secondary border-secondary",children:[s.custom_referral_rate,"% Rate"]}):"—"}),e.jsx(m,{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()})]},s.id)}),U.length===0&&e.jsx(A,{children:e.jsx(m,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No users found."})})]})]})})})]}),e.jsx(te,{open:!!a,onOpenChange:()=>{j(null),v(""),y("")},children:e.jsx(ne,{className:"sm:max-w-lg overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsx(le,{children:a.full_name||"User"}),e.jsx(ie,{children:a.email})]}),e.jsxs("div",{className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:((F=(k=a.user_roles)==null?void 0:k[0])==null?void 0:F.role)??"client"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx(w,{variant:a.is_banned?"destructive":"default",children:a.is_banned?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:"font-medium text-lg",children:["$",Number(a.balance??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString()})]})]}),c&&e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"User Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"font-medium",children:["€",((L=c.total_spent)==null?void 0:L.toFixed(2))??"0.00"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsxs("p",{className:"font-medium",children:[c.active_orders??0," active / ",c.total_orders??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"API Keys"}),e.jsxs("p",{className:"font-medium",children:[c.active_keys??0," active / ",c.total_keys??0," total"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tickets"}),e.jsxs("p",{className:"font-medium",children:[c.open_tickets??0," open / ",c.total_tickets??0," total"]})]})]})]})]}),a.ban_reason&&e.jsxs("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx("strong",{children:"Ban reason:"})," ",a.ban_reason]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Adjust Balance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(N,{id:"amount",type:"number",min:"0.01",step:"0.01",placeholder:"e.g. 50.00",value:p,onChange:s=>v(s.target.value)}),e.jsx(C,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(N,{id:"reason",placeholder:"e.g. Manual credit for support case",value:B,onChange:s=>y(s.target.value)}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(S,{size:"sm",onClick:()=>T(!0),disabled:n.isPending||!p,className:"flex-1",children:[e.jsx(G,{className:"mr-1 h-4 w-4"})," Top Up"]}),e.jsxs(S,{size:"sm",variant:"destructive",onClick:()=>T(!1),disabled:n.isPending||!p,className:"flex-1",children:[e.jsx(W,{className:"mr-1 h-4 w-4"})," Deduct"]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Access Control"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(S,{variant:a.is_banned?"default":"destructive",size:"sm",onClick:()=>P(a.user_id,a.is_banned),disabled:n.isPending,children:[a.is_banned?e.jsx(X,{className:"mr-2 h-4 w-4"}):e.jsx(ee,{className:"mr-2 h-4 w-4"}),a.is_banned?"Unban User":"Ban User"]})})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Influencer Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Custom Referral Rate (%)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(N,{type:"number",placeholder:"e.g. 15",defaultValue:a.custom_referral_rate||"",onBlur:async s=>{const t=s.target.value===""?null:parseFloat(s.target.value);if(t!==a.custom_referral_rate)try{await n.mutateAsync({action:"update_influencer_rate",user_id:a.user_id,custom_rate:t}),o({title:"Influencer rate updated"})}catch(r){o({title:"Error",description:r.message,variant:"destructive"})}}})}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Set a custom rate for this specific user. Leave empty for default."})]})]})]})]})})})]})}export{Se as default};
