import{j as e,k as oe,x as N}from"./ui-BkJV2AdO.js";import{r as t,aM as Ge,ad as Ve,w as $e,ab as qe,ar as Ue,am as Pe,o as Ye,aw as me}from"./vendor-BJanyxg7.js";import{S as Qe}from"./SEOHead-BjLsFleX.js";import{C as le,a as he,b as fe,d as Ze,c as ie}from"./card-l-SRMqus.js";import{a as Je,B as Ee,I as xe,t as k}from"./index-CbkdlC4K.js";import{L as ve}from"./label-BFQ1M4xB.js";import{k as Ke,l as Xe,m as et,n as tt,o as nt}from"./use-backend-Csrp5RFl.js";import"./useMutation-CaMKQj-7.js";var at=Object.defineProperty,st=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,ke=(n,a,s)=>a in n?at(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s,lt=(n,a)=>{for(var s in a||(a={}))Ae.call(a,s)&&ke(n,s,a[s]);if(ce)for(var s of ce(a))Te.call(a,s)&&ke(n,s,a[s]);return n},it=(n,a)=>st(n,rt(a)),ot=(n,a)=>{var s={};for(var o in n)Ae.call(n,o)&&a.indexOf(o)<0&&(s[o]=n[o]);if(n!=null&&ce)for(var o of ce(n))a.indexOf(o)<0&&Te.call(n,o)&&(s[o]=n[o]);return s};function ct(n){let a=setTimeout(n,0),s=setTimeout(n,10),o=setTimeout(n,50);return[a,s,o]}function dt(n){let a=t.useRef();return t.useEffect(()=>{a.current=n}),a.current}var ut=18,Me=40,pt=`${Me}px`,mt=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function ht({containerRef:n,inputRef:a,pushPasswordManagerStrategy:s,isFocused:o}){let[v,c]=t.useState(!1),[A,w]=t.useState(!1),[F,T]=t.useState(!1),I=t.useMemo(()=>s==="none"?!1:(s==="increase-width"||s==="experimental-no-flickering")&&v&&A,[v,A,s]),M=t.useCallback(()=>{let f=n.current,m=a.current;if(!f||!m||F||s==="none")return;let g=f,j=g.getBoundingClientRect().left+g.offsetWidth,E=g.getBoundingClientRect().top+g.offsetHeight/2,i=j-ut,R=E;document.querySelectorAll(mt).length===0&&document.elementFromPoint(i,R)===f||(c(!0),T(!0))},[n,a,F,s]);return t.useEffect(()=>{let f=n.current;if(!f||s==="none")return;function m(){let j=window.innerWidth-f.getBoundingClientRect().right;w(j>=Me)}m();let g=setInterval(m,1e3);return()=>{clearInterval(g)}},[n,s]),t.useEffect(()=>{let f=o||document.activeElement===a.current;if(s==="none"||!f)return;let m=setTimeout(M,0),g=setTimeout(M,2e3),j=setTimeout(M,5e3),E=setTimeout(()=>{T(!0)},6e3);return()=>{clearTimeout(m),clearTimeout(g),clearTimeout(j),clearTimeout(E)}},[a,o,s,M]),{hasPWMBadge:v,willPushPWMBadge:I,PWM_BADGE_SPACE_WIDTH:pt}}var Re=t.createContext({}),Oe=t.forwardRef((n,a)=>{var s=n,{value:o,onChange:v,maxLength:c,textAlign:A="left",pattern:w,placeholder:F,inputMode:T="numeric",onComplete:I,pushPasswordManagerStrategy:M="increase-width",pasteTransformer:f,containerClassName:m,noScriptCSSFallback:g=ft,render:j,children:E}=s,i=ot(s,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),R,te,W,Q,q;let[ne,ae]=t.useState(typeof i.defaultValue=="string"?i.defaultValue:""),u=o??ne,O=dt(u),L=t.useCallback(r=>{v==null||v(r),ae(r)},[v]),y=t.useMemo(()=>w?typeof w=="string"?new RegExp(w):w:null,[w]),p=t.useRef(null),h=t.useRef(null),Z=t.useRef({value:u,onChange:L,isIOS:typeof window<"u"&&((te=(R=window==null?void 0:window.CSS)==null?void 0:R.supports)==null?void 0:te.call(R,"-webkit-touch-callout","none"))}),se=t.useRef({prev:[(W=p.current)==null?void 0:W.selectionStart,(Q=p.current)==null?void 0:Q.selectionEnd,(q=p.current)==null?void 0:q.selectionDirection]});t.useImperativeHandle(a,()=>p.current,[]),t.useEffect(()=>{let r=p.current,l=h.current;if(!r||!l)return;Z.current.value!==r.value&&Z.current.onChange(r.value),se.current.prev=[r.selectionStart,r.selectionEnd,r.selectionDirection];function x(){if(document.activeElement!==r){K(null),X(null);return}let d=r.selectionStart,b=r.selectionEnd,re=r.selectionDirection,P=r.maxLength,z=r.value,D=se.current.prev,B=-1,_=-1,G;if(z.length!==0&&d!==null&&b!==null){let Le=d===b,He=d===z.length&&z.length<P;if(Le&&!He){let V=d;if(V===0)B=0,_=1,G="forward";else if(V===P)B=V-1,_=V,G="backward";else if(P>1&&z.length>1){let pe=0;if(D[0]!==null&&D[1]!==null){G=V<D[1]?"backward":"forward";let ze=D[0]===D[1]&&D[0]<P;G==="backward"&&!ze&&(pe=-1)}B=pe+V,_=pe+V+1}}B!==-1&&_!==-1&&B!==_&&p.current.setSelectionRange(B,_,G)}let Se=B!==-1?B:d,Ne=_!==-1?_:b,We=G??re;K(Se),X(Ne),se.current.prev=[Se,Ne,We]}if(document.addEventListener("selectionchange",x,{capture:!0}),x(),document.activeElement===r&&de(!0),!document.getElementById("input-otp-style")){let d=document.createElement("style");if(d.id="input-otp-style",document.head.appendChild(d),d.sheet){let b="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";ee(d.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),ee(d.sheet,`[data-input-otp]:autofill { ${b} }`),ee(d.sheet,`[data-input-otp]:-webkit-autofill { ${b} }`),ee(d.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),ee(d.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let C=()=>{l&&l.style.setProperty("--root-height",`${r.clientHeight}px`)};C();let S=new ResizeObserver(C);return S.observe(r),()=>{document.removeEventListener("selectionchange",x,{capture:!0}),S.disconnect()}},[]);let[ge,je]=t.useState(!1),[J,de]=t.useState(!1),[H,K]=t.useState(null),[U,X]=t.useState(null);t.useEffect(()=>{ct(()=>{var r,l,x,C;(r=p.current)==null||r.dispatchEvent(new Event("input"));let S=(l=p.current)==null?void 0:l.selectionStart,d=(x=p.current)==null?void 0:x.selectionEnd,b=(C=p.current)==null?void 0:C.selectionDirection;S!==null&&d!==null&&(K(S),X(d),se.current.prev=[S,d,b])})},[u,J]),t.useEffect(()=>{O!==void 0&&u!==O&&O.length<c&&u.length===c&&(I==null||I(u))},[c,I,O,u]);let Y=ht({containerRef:h,inputRef:p,pushPasswordManagerStrategy:M,isFocused:J}),be=t.useCallback(r=>{let l=r.currentTarget.value.slice(0,c);if(l.length>0&&y&&!y.test(l)){r.preventDefault();return}typeof O=="string"&&l.length<O.length&&document.dispatchEvent(new Event("selectionchange")),L(l)},[c,L,O,y]),we=t.useCallback(()=>{var r;if(p.current){let l=Math.min(p.current.value.length,c-1),x=p.current.value.length;(r=p.current)==null||r.setSelectionRange(l,x),K(l),X(x)}de(!0)},[c]),ye=t.useCallback(r=>{var l,x;let C=p.current;if(!f&&(!Z.current.isIOS||!r.clipboardData||!C))return;let S=r.clipboardData.getData("text/plain"),d=f?f(S):S;r.preventDefault();let b=(l=p.current)==null?void 0:l.selectionStart,re=(x=p.current)==null?void 0:x.selectionEnd,P=(b!==re?u.slice(0,b)+d+u.slice(re):u.slice(0,b)+d+u.slice(b)).slice(0,c);if(P.length>0&&y&&!y.test(P))return;C.value=P,L(P);let z=Math.min(P.length,c-1),D=P.length;C.setSelectionRange(z,D),K(z),X(D)},[c,L,y,u]),Ie=t.useMemo(()=>({position:"relative",cursor:i.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[i.disabled]),Ce=t.useMemo(()=>({position:"absolute",inset:0,width:Y.willPushPWMBadge?`calc(100% + ${Y.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:Y.willPushPWMBadge?`inset(0 ${Y.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:A,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[Y.PWM_BADGE_SPACE_WIDTH,Y.willPushPWMBadge,A]),Be=t.useMemo(()=>t.createElement("input",it(lt({autoComplete:i.autoComplete||"one-time-code"},i),{"data-input-otp":!0,"data-input-otp-placeholder-shown":u.length===0||void 0,"data-input-otp-mss":H,"data-input-otp-mse":U,inputMode:T,pattern:y==null?void 0:y.source,"aria-placeholder":F,style:Ce,maxLength:c,value:u,ref:p,onPaste:r=>{var l;ye(r),(l=i.onPaste)==null||l.call(i,r)},onChange:be,onMouseOver:r=>{var l;je(!0),(l=i.onMouseOver)==null||l.call(i,r)},onMouseLeave:r=>{var l;je(!1),(l=i.onMouseLeave)==null||l.call(i,r)},onFocus:r=>{var l;we(),(l=i.onFocus)==null||l.call(i,r)},onBlur:r=>{var l;de(!1),(l=i.onBlur)==null||l.call(i,r)}})),[be,we,ye,T,Ce,c,U,H,i,y==null?void 0:y.source,u]),ue=t.useMemo(()=>({slots:Array.from({length:c}).map((r,l)=>{var x;let C=J&&H!==null&&U!==null&&(H===U&&l===H||l>=H&&l<U),S=u[l]!==void 0?u[l]:null,d=u[0]!==void 0?null:(x=F==null?void 0:F[l])!=null?x:null;return{char:S,placeholderChar:d,isActive:C,hasFakeCaret:C&&S===null}}),isFocused:J,isHovering:!i.disabled&&ge}),[J,ge,c,U,H,i.disabled,u]),_e=t.useMemo(()=>j?j(ue):t.createElement(Re.Provider,{value:ue},E),[E,ue,j]);return t.createElement(t.Fragment,null,g!==null&&t.createElement("noscript",null,t.createElement("style",null,g)),t.createElement("div",{ref:h,"data-input-otp-container":!0,style:Ie,className:m},_e,t.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Be)))});Oe.displayName="Input";function ee(n,a){try{n.insertRule(a)}catch{console.error("input-otp could not insert CSS rule:",a)}}var ft=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const De=t.forwardRef(({className:n,containerClassName:a,...s},o)=>e.jsx(Oe,{ref:o,containerClassName:oe("flex items-center gap-2 has-[:disabled]:opacity-50",a),className:oe("disabled:cursor-not-allowed",n),...s}));De.displayName="InputOTP";const Fe=t.forwardRef(({className:n,...a},s)=>e.jsx("div",{ref:s,className:oe("flex items-center",n),...a}));Fe.displayName="InputOTPGroup";const $=t.forwardRef(({index:n,className:a,...s},o)=>{const v=t.useContext(Re),{char:c,hasFakeCaret:A,isActive:w}=v.slots[n];return e.jsxs("div",{ref:o,className:oe("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",w&&"z-10 ring-2 ring-ring ring-offset-background",a),...s,children:[c,A&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});$.displayName="InputOTPSlot";const xt=t.forwardRef(({...n},a)=>e.jsx("div",{ref:a,role:"separator",...n,children:e.jsx(Ge,{})}));xt.displayName="InputOTPSeparator";function Nt(){const{user:n}=Je(),[a,s]=t.useState("idle"),[o,v]=t.useState(""),[c,A]=t.useState(!1),[w,F]=t.useState([]),[T,I]=t.useState(""),[M,f]=t.useState(!1),{data:m,isLoading:g}=Ke(),j=Xe(),E=et(),i=!!(n!=null&&n.is_2fa_enabled),{data:R}=tt(i),te=nt(),[W,Q]=t.useState(""),[q,ne]=t.useState(""),[ae,u]=t.useState(!1),O=async()=>{if(!W||W!==q){k({title:"Validation Error",description:"Passwords do not match.",variant:"destructive"});return}u(!0);try{await te.mutateAsync({password:W,password_confirmation:q}),k({title:"Password updated successfully"}),Q(""),ne("")}catch(h){k({title:"Error",description:h.message,variant:"destructive"})}finally{u(!1)}},L=async()=>{if(o.length!==6){k({title:"Invalid code",description:"Enter a 6-digit code",variant:"destructive"});return}try{const h=await j.mutateAsync(o);F(h.recovery_codes),s("idle"),v(""),k({title:"2FA Enabled",description:"Your account is now protected."})}catch(h){k({title:"Verification failed",description:h.message,variant:"destructive"})}},y=async()=>{if(!T){f(!0);return}try{await E.mutateAsync({password:T}),k({title:"2FA Disabled",description:"Two-factor authentication has been turned off."}),I(""),f(!1)}catch(h){k({title:"Error",description:h.message,variant:"destructive"})}},p=w.length>0?w:(R==null?void 0:R.recovery_codes)||[];return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{title:"Security & 2FA",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Security & 2FA"}),e.jsxs(le,{children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[i?e.jsx(Ve,{className:"h-8 w-8 text-success"}):e.jsx($e,{className:"h-8 w-8 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-lg",children:"Two-Factor Authentication (TOTP)"}),e.jsx(Ze,{children:"Add an extra layer of security using an authenticator app like Google Authenticator or Authy."})]}),e.jsx(Ee,{variant:i?"default":"secondary",className:"ml-auto",children:i?"Enabled":"Disabled"})]})}),e.jsxs(ie,{className:"space-y-4",children:[i&&a==="idle"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>A(!c),children:[c?e.jsx(qe,{className:"mr-1 h-4 w-4"}):e.jsx(Ue,{className:"mr-1 h-4 w-4"}),c?"Hide":"Show"," Backup Codes"]}),!M&&e.jsx(N,{variant:"destructive",size:"sm",onClick:()=>f(!0),children:"Disable 2FA"})]}),M&&e.jsxs("div",{className:"flex items-end gap-2 max-w-sm rounded-lg border bg-muted/50 p-4",children:[e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx(ve,{htmlFor:"disable-pass",children:"Confirm Password to Disable"}),e.jsx(xe,{id:"disable-pass",type:"password",placeholder:"Your password",value:T,onChange:h=>I(h.target.value)})]}),e.jsx(N,{variant:"destructive",onClick:y,disabled:E.isPending,children:E.isPending?"Disabling...":"Confirm"}),e.jsx(N,{variant:"ghost",onClick:()=>f(!1),children:"Cancel"})]}),c&&e.jsx(le,{className:"bg-muted",children:e.jsxs(ie,{className:"py-3",children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:"Save these backup codes in a safe place:"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:p.map((h,Z)=>e.jsx("code",{className:"text-xs font-mono bg-background px-2 py-1 rounded",children:h},Z))}),e.jsxs(N,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{navigator.clipboard.writeText(p.join(`
`)),k({title:"Copied"})},children:[e.jsx(Pe,{className:"mr-1 h-3 w-3"})," Copy All"]})]})})]}),!i&&a==="idle"&&e.jsxs(N,{onClick:()=>s("setup"),children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"})," Enable 2FA"]}),a==="setup"&&e.jsxs("div",{className:"space-y-4",children:[g?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(me,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"1. Scan this QR code with your authenticator app:"}),e.jsx("div",{className:"flex items-center justify-center rounded-lg border bg-white p-4",style:{maxWidth:240},children:(m==null?void 0:m.qr_code_svg)&&e.jsx("div",{dangerouslySetInnerHTML:{__html:m.qr_code_svg},className:"w-48 h-48"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Or enter this secret manually:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-muted px-3 py-1.5 rounded text-sm font-mono",children:m==null?void 0:m.secret}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>{m&&(navigator.clipboard.writeText(m.secret),k({title:"Copied"}))},children:e.jsx(Pe,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"ghost",onClick:()=>s("idle"),children:"Cancel"}),e.jsx(N,{onClick:()=>s("verify"),disabled:!m,children:"Next: Verify Code"})]})]}),a==="verify"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"2. Enter the 6-digit code from your authenticator app:"}),e.jsx("div",{className:"flex justify-start",children:e.jsx(De,{maxLength:6,value:o,onChange:v,children:e.jsxs(Fe,{children:[e.jsx($,{index:0}),e.jsx($,{index:1}),e.jsx($,{index:2}),e.jsx($,{index:3}),e.jsx($,{index:4}),e.jsx($,{index:5})]})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",onClick:()=>{s("setup"),v("")},children:"Back"}),e.jsxs(N,{onClick:L,disabled:o.length!==6||j.isPending,children:[j.isPending?e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Verify & Enable"]})]})]})]})]}),e.jsxs(le,{children:[e.jsx(he,{children:e.jsx(fe,{className:"text-lg",children:"Change Password"})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 max-w-sm",children:[e.jsx(ve,{children:"New Password"}),e.jsx(xe,{type:"password",placeholder:"••••••••",value:W,onChange:h=>Q(h.target.value)})]}),e.jsxs("div",{className:"space-y-2 max-w-sm",children:[e.jsx(ve,{children:"Confirm New Password"}),e.jsx(xe,{type:"password",placeholder:"••••••••",value:q,onChange:h=>ne(h.target.value)})]}),e.jsxs(N,{onClick:O,disabled:ae,children:[ae?e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Update Password"]})]})]}),e.jsxs(le,{children:[e.jsx(he,{children:e.jsx(fe,{className:"text-lg",children:"Active Sessions"})}),e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Session"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Browser • ",navigator.userAgent.split(" ").pop()]})]}),e.jsx(Ee,{variant:"default",children:"Active"})]})})]})]})]})}export{Nt as default};
