import{j as e,x as d,y as Q,z as K,A as V,E as $,H as W}from"./ui-DhchgSRK.js";import{r as g,aB as C,aW as X,aF as Y,X as J}from"./vendor-Dios4bpT.js";import{S as Z}from"./SEOHead-DXDb4QCK.js";import{C as P,c as S}from"./card-ClKFnvWz.js";import{j as ee,k as se,B as ae,I as o,e as k,f as w,g as T,h as F,i as r,t as M,x as h,M as te,o as ie,A,s as x,a2 as _,a3 as re}from"./index-ZoSoF22l.js";import{L as n}from"./label-CHENNY20.js";import{S as ne}from"./switch-ADZi5RyU.js";import{T as ce,a as le,b as B,c,d as de,e as l}from"./table-BODbY_8L.js";import{u as I}from"./useMutation-i1HBKd5E.js";const y=ie({id:_.string(),name:x(),type:x(),price:_.number(),is_active:_.number().or(re()).optional().default(!0),evomi_product_id:x().nullable().optional(),tagline:x().nullable().optional(),features:A(x()).nullable().optional()}),E={name:"",proxy_type:"rp",unit:"GB",base_cost_eur:"",markup_pct:"0",is_active:!0,evomi_product_id:"",tagline:"",features:[]};function _e(){const f=ee(),[D,u]=g.useState(!1),[m,N]=g.useState(null),[a,i]=g.useState(E),{data:p,isLoading:R}=se({queryKey:["admin-products"],queryFn:async()=>(await h.get("/admin/products",A(y))).map(t=>({id:String(t.id),name:t.name,proxy_type:t.type,unit:t.type==="isp"?"IP":t.type==="dc_unmetered"?"Month":"GB",base_cost_eur:Number(t.price),sell_price_eur:Number(t.price),markup_pct:0,is_active:!!t.is_active,evomi_product_id:t.evomi_product_id,tagline:t.tagline||"",features:t.features||[]}))}),z=I({mutationFn:s=>m?h.put(`/admin/products/${m}`,y,s):h.post("/admin/products",y,s),onSuccess:()=>{f.invalidateQueries({queryKey:["admin-products"]}),u(!1),M({title:`Product ${m?"updated":"created"} successfully`})}}),U=I({mutationFn:s=>h.delete(`/admin/products/${s}`,te),onSuccess:()=>{f.invalidateQueries({queryKey:["admin-products"]}),M({title:"Product deleted"})}});if(R)return e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading products..."});const q=()=>{N(null),i(E),u(!0)},H=s=>{window.confirm("Are you sure you want to delete this product?")&&U.mutate(s)},L=s=>{N(s.id),i({name:s.name,proxy_type:s.proxy_type,unit:s.unit,base_cost_eur:String(s.base_cost_eur),markup_pct:"0",is_active:s.is_active,evomi_product_id:s.evomi_product_id||"",tagline:s.tagline||"",features:s.features||[]}),u(!0)},b=()=>{const s=parseFloat(a.base_cost_eur)||0,t=parseFloat(a.markup_pct)||0;return(s*(1+t/100)).toFixed(2)},O=()=>{z.mutate({name:a.name,type:a.proxy_type,price:parseFloat(b()),is_active:a.is_active,evomi_product_id:a.evomi_product_id,tagline:a.tagline,features:a.features})};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Admin — Products",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage proxy product catalog. All prices flat-rate in EUR with 30% markup over base cost."})]}),e.jsxs(d,{onClick:q,children:[e.jsx(C,{className:"mr-2 h-4 w-4"})," Add Product"]})]}),e.jsx(P,{children:e.jsx(S,{className:"p-0",children:e.jsxs(ce,{children:[e.jsx(le,{children:e.jsxs(B,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Unit"}),e.jsx(c,{className:"text-right",children:"Base Cost"}),e.jsx(c,{className:"text-right",children:"Markup"}),e.jsx(c,{className:"text-right",children:"Sell Price"}),e.jsx(c,{children:"Status"}),e.jsx(c,{})]})}),e.jsx(de,{children:p==null?void 0:p.map(s=>e.jsxs(B,{children:[e.jsx(l,{className:"font-medium",children:s.name}),e.jsx(l,{className:"capitalize",children:s.proxy_type}),e.jsxs(l,{children:["per ",s.unit]}),e.jsxs(l,{className:"text-right",children:["€",s.base_cost_eur.toFixed(2)]}),e.jsxs(l,{className:"text-right",children:[s.markup_pct,"%"]}),e.jsxs(l,{className:"text-right font-semibold",children:["€",s.sell_price_eur.toFixed(2),"/",s.unit]}),e.jsx(l,{children:e.jsx(ae,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>L(s),children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>H(s.id),children:e.jsx(Y,{className:"h-4 w-4 text-destructive"})})]})})]},s.id))})]})})}),e.jsx(P,{children:e.jsxs(S,{className:"py-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Pricing Model"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"All products use flat-rate pricing in EUR. The sell price = base cost × (1 + markup%). Same price for all customers regardless of volume — no tiers, no volume discounts."})]})})]}),e.jsx(Q,{open:D,onOpenChange:u,children:e.jsxs(K,{children:[e.jsx(V,{children:e.jsx($,{children:m?"Edit Product":"Create Product"})}),e.jsxs("div",{className:"space-y-4 py-2 max-h-[70vh] overflow-y-auto px-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Name"}),e.jsx(o,{value:a.name,onChange:s=>i({...a,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Tagline / Subtitle"}),e.jsx(o,{placeholder:"e.g. 100% ethical residential proxies",value:a.tagline,onChange:s=>i({...a,tagline:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Proxy Type"}),e.jsxs(k,{value:a.proxy_type,onValueChange:s=>i({...a,proxy_type:s}),children:[e.jsx(w,{children:e.jsx(T,{})}),e.jsxs(F,{children:[e.jsx(r,{value:"rp",children:"Residential (rp)"}),e.jsx(r,{value:"dc",children:"Datacenter (dc)"}),e.jsx(r,{value:"mp",children:"Mobile (mp)"}),e.jsx(r,{value:"isp",children:"Static/ISP (isp)"}),e.jsx(r,{value:"dc_ipv6",children:"Datacenter IPv6 (dc_ipv6)"}),e.jsx(r,{value:"dc_unmetered",children:"Datacenter Unmetered (dc_unmetered)"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Billing Unit"}),e.jsxs(k,{value:a.unit,onValueChange:s=>i({...a,unit:s}),children:[e.jsx(w,{children:e.jsx(T,{})}),e.jsxs(F,{children:[e.jsx(r,{value:"GB",children:"Per GB"}),e.jsx(r,{value:"IP",children:"Per IP"}),e.jsx(r,{value:"Month",children:"Per Month"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Base Cost (€)"}),e.jsx(o,{type:"number",step:"0.01",value:a.base_cost_eur,onChange:s=>i({...a,base_cost_eur:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Markup (%)"}),e.jsx(o,{type:"number",value:a.markup_pct,onChange:s=>i({...a,markup_pct:s.target.value})})]})]}),e.jsx("div",{className:"rounded-md bg-muted/50 p-3",children:e.jsxs("p",{className:"text-sm",children:["Sell Price: ",e.jsxs("span",{className:"font-bold text-primary",children:["€",b(),"/",a.unit]})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Evomi Product ID (External)"}),e.jsx(o,{placeholder:"e.g. residential_premium",value:a.evomi_product_id,onChange:s=>i({...a,evomi_product_id:s.target.value})})]}),e.jsxs("div",{className:"space-y-2 border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(n,{children:"Features List"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:()=>i({...a,features:[...a.features,""]}),children:[e.jsx(C,{className:"h-3 w-3 mr-1"})," Add Feature"]})]}),a.features.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"No features added. Core defaults will be shown."}),a.features.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{value:s,placeholder:"e.g. 50M+ Real IPs",onChange:j=>{const v=[...a.features];v[t]=j.target.value,i({...a,features:v})}}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"shrink-0 text-destructive",onClick:()=>{const j=a.features.filter((v,G)=>G!==t);i({...a,features:j})},children:e.jsx(J,{className:"h-4 w-4"})})]},t))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{checked:a.is_active,onCheckedChange:s=>i({...a,is_active:s})}),e.jsx(n,{children:"Active"})]})]}),e.jsxs(W,{children:[e.jsx(d,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(d,{onClick:O,children:m?"Update":"Create"})]})]})})]})}export{_e as default};
