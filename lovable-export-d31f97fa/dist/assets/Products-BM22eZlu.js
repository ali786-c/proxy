import{j as e,x as r,y as X,z as J,A as Z,E as ee,H as se}from"./ui-DhchgSRK.js";import{r as _,aB as b,aW as te,aF as ae,X as B}from"./vendor-Dios4bpT.js";import{S as ie}from"./SEOHead-DbmeABdY.js";import{C as D,c as I}from"./card-ClKFnvWz.js";import{j as re,k as ne,B as le,I as u,e as A,f as E,g as z,h as q,i as o,t as R,x as y,M as ce,o as P,A as S,a2 as j,s as v,a3 as de,Y as C}from"./index-D5vQvJ71.js";import{L as c}from"./label-CHENNY20.js";import{S as oe}from"./switch-CX_DpIra.js";import{T as ue,a as me,b as U,c as m,d as xe,e as x}from"./table-BODbY_8L.js";import{u as H}from"./useMutation-h29atpez.js";const w=P({id:j.string(),name:v(),type:v(),price:j.number(),is_active:j.number().or(de()).optional().default(!0),evomi_product_id:v().nullable().optional(),tagline:v().nullable().optional(),features:S(v()).nullable().optional(),volume_discounts:S(P({min_qty:j.number(),price:j.number()})).nullable().optional()}),he=P({data:S(w),current_page:C(),last_page:C(),total:C()}),L={name:"",proxy_type:"rp",unit:"GB",base_cost_eur:"",markup_pct:"0",is_active:!0,evomi_product_id:"",tagline:"",features:[],volume_discounts:[]};function Ce(){const k=re(),[O,h]=_.useState(!1),[p,T]=_.useState(null),[t,i]=_.useState(L),[g,M]=_.useState(1),{data:n,isLoading:Q}=ne({queryKey:["admin-products",g],queryFn:async()=>{const s=await y.get(`/admin/products?page=${g}`,he);return{...s,data:s.data.map(a=>({id:String(a.id),name:a.name,proxy_type:a.type,unit:a.type==="isp"?"IP":a.type==="dc_unmetered"?"Month":"GB",base_cost_eur:Number(a.price),sell_price_eur:Number(a.price),markup_pct:0,is_active:!!a.is_active,evomi_product_id:a.evomi_product_id,tagline:a.tagline||"",features:a.features||[],volume_discounts:a.volume_discounts||[]}))}}}),f=(n==null?void 0:n.data)||[],$=H({mutationFn:s=>p?y.put(`/admin/products/${p}`,w,s):y.post("/admin/products",w,s),onSuccess:()=>{k.invalidateQueries({queryKey:["admin-products"]}),h(!1),R({title:`Product ${p?"updated":"created"} successfully`})}}),G=H({mutationFn:s=>y.delete(`/admin/products/${s}`,ce),onSuccess:()=>{k.invalidateQueries({queryKey:["admin-products"]}),R({title:"Product deleted"})}});if(Q)return e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading products..."});const V=()=>{T(null),i(L),h(!0)},K=s=>{window.confirm("Are you sure you want to delete this product?")&&G.mutate(s)},Y=s=>{T(s.id),i({name:s.name,proxy_type:s.proxy_type,unit:s.unit,base_cost_eur:String(s.base_cost_eur),markup_pct:"0",is_active:s.is_active,evomi_product_id:s.evomi_product_id||"",tagline:s.tagline||"",features:s.features||[],volume_discounts:s.volume_discounts||[]}),h(!0)},F=()=>{const s=parseFloat(t.base_cost_eur)||0,a=parseFloat(t.markup_pct)||0;return(s*(1+a/100)).toFixed(2)},W=()=>{$.mutate({name:t.name,type:t.proxy_type,price:parseFloat(F()),is_active:t.is_active,evomi_product_id:t.evomi_product_id,tagline:t.tagline,features:t.features,volume_discounts:t.volume_discounts.length>0?t.volume_discounts:null})};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Admin — Products",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage proxy product catalog. All prices flat-rate in EUR with 30% markup over base cost."})]}),e.jsxs(r,{onClick:V,children:[e.jsx(b,{className:"mr-2 h-4 w-4"})," Add Product"]})]}),e.jsx(D,{children:e.jsxs(I,{className:"p-0",children:[e.jsxs(ue,{children:[e.jsx(me,{children:e.jsxs(U,{children:[e.jsx(m,{children:"Product"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Unit"}),e.jsx(m,{className:"text-right",children:"Base Cost"}),e.jsx(m,{className:"text-right",children:"Markup"}),e.jsx(m,{className:"text-right",children:"Sell Price"}),e.jsx(m,{children:"Status"}),e.jsx(m,{})]})}),e.jsx(xe,{children:f==null?void 0:f.map(s=>e.jsxs(U,{children:[e.jsx(x,{className:"font-medium",children:s.name}),e.jsx(x,{className:"capitalize",children:s.proxy_type}),e.jsxs(x,{children:["per ",s.unit]}),e.jsxs(x,{className:"text-right",children:["€",s.base_cost_eur.toFixed(2)]}),e.jsxs(x,{className:"text-right",children:[s.markup_pct,"%"]}),e.jsxs(x,{className:"text-right font-semibold",children:["€",s.sell_price_eur.toFixed(2),"/",s.unit]}),e.jsx(x,{children:e.jsx(le,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>Y(s),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>K(s.id),children:e.jsx(ae,{className:"h-4 w-4 text-destructive"})})]})})]},s.id))})]}),n&&n.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing page ",n.current_page," of ",n.last_page," (",n.total," products)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>M(s=>Math.max(1,s-1)),disabled:g===1,children:"Previous"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>M(s=>Math.min(n.last_page,s+1)),disabled:g===n.last_page,children:"Next"})]})]})]})}),e.jsx(D,{children:e.jsxs(I,{className:"py-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Pricing Model"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"All products use flat-rate pricing in EUR. The sell price = base cost × (1 + markup%). Same price for all customers regardless of volume — no tiers, no volume discounts."})]})})]}),e.jsx(X,{open:O,onOpenChange:h,children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsx(ee,{children:p?"Edit Product":"Create Product"})}),e.jsxs("div",{className:"space-y-4 py-2 max-h-[70vh] overflow-y-auto px-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Name"}),e.jsx(u,{value:t.name,onChange:s=>i({...t,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Tagline / Subtitle"}),e.jsx(u,{placeholder:"e.g. 100% ethical residential proxies",value:t.tagline,onChange:s=>i({...t,tagline:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Proxy Type"}),e.jsxs(A,{value:t.proxy_type,onValueChange:s=>i({...t,proxy_type:s}),children:[e.jsx(E,{children:e.jsx(z,{})}),e.jsxs(q,{children:[e.jsx(o,{value:"rp",children:"Residential (rp)"}),e.jsx(o,{value:"dc",children:"Datacenter (dc)"}),e.jsx(o,{value:"mp",children:"Mobile (mp)"}),e.jsx(o,{value:"isp",children:"Static/ISP (isp)"}),e.jsx(o,{value:"dc_ipv6",children:"Datacenter IPv6 (dc_ipv6)"}),e.jsx(o,{value:"dc_unmetered",children:"Datacenter Unmetered (dc_unmetered)"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Billing Unit"}),e.jsxs(A,{value:t.unit,onValueChange:s=>i({...t,unit:s}),children:[e.jsx(E,{children:e.jsx(z,{})}),e.jsxs(q,{children:[e.jsx(o,{value:"GB",children:"Per GB"}),e.jsx(o,{value:"IP",children:"Per IP"}),e.jsx(o,{value:"Month",children:"Per Month"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Base Cost (€)"}),e.jsx(u,{type:"number",step:"0.01",value:t.base_cost_eur,onChange:s=>i({...t,base_cost_eur:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Markup (%)"}),e.jsx(u,{type:"number",value:t.markup_pct,onChange:s=>i({...t,markup_pct:s.target.value})})]})]}),e.jsx("div",{className:"rounded-md bg-muted/50 p-3",children:e.jsxs("p",{className:"text-sm",children:["Sell Price: ",e.jsxs("span",{className:"font-bold text-primary",children:["€",F(),"/",t.unit]})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Evomi Product ID (External)"}),e.jsx(u,{placeholder:"e.g. residential_premium",value:t.evomi_product_id,onChange:s=>i({...t,evomi_product_id:s.target.value})})]}),e.jsxs("div",{className:"space-y-2 border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(c,{children:"Features List"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>i({...t,features:[...t.features,""]}),children:[e.jsx(b,{className:"h-3 w-3 mr-1"})," Add Feature"]})]}),t.features.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"No features added. Core defaults will be shown."}),t.features.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{value:s,placeholder:"e.g. 50M+ Real IPs",onChange:d=>{const l=[...t.features];l[a]=d.target.value,i({...t,features:l})}}),e.jsx(r,{type:"button",variant:"ghost",size:"icon",className:"shrink-0 text-destructive",onClick:()=>{const d=t.features.filter((l,N)=>N!==a);i({...t,features:d})},children:e.jsx(B,{className:"h-4 w-4"})})]},a))]}),e.jsxs("div",{className:"space-y-2 border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(c,{children:"Volume Discounts"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>i({...t,volume_discounts:[...t.volume_discounts,{min_qty:100,price:.99}]}),children:[e.jsx(b,{className:"h-3 w-3 mr-1"})," Add Tier"]})]}),t.volume_discounts.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"No volume discounts added. Pricing is flat-rate."}),t.volume_discounts.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-16",children:"Min Qty:"}),e.jsx(u,{type:"number",min:"1",value:s.min_qty,onChange:d=>{const l=[...t.volume_discounts];l[a].min_qty=Number(d.target.value),i({...t,volume_discounts:l})}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-12",children:"Price:"}),e.jsx(u,{type:"number",min:"0",step:"0.01",value:s.price,onChange:d=>{const l=[...t.volume_discounts];l[a].price=Number(d.target.value),i({...t,volume_discounts:l})}})]})]}),e.jsx(r,{type:"button",variant:"ghost",size:"icon",className:"shrink-0 text-destructive",onClick:()=>{const d=t.volume_discounts.filter((l,N)=>N!==a);i({...t,volume_discounts:d})},children:e.jsx(B,{className:"h-4 w-4"})})]},`discount-${a}`))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{checked:t.is_active,onCheckedChange:s=>i({...t,is_active:s})}),e.jsx(c,{children:"Active"})]})]}),e.jsxs(se,{children:[e.jsx(r,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(r,{onClick:W,children:p?"Update":"Create"})]})]})})]})}export{Ce as default};
