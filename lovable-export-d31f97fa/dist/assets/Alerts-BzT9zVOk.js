import{b as je,j as e,e as k,P as K,u as P,c as ve,k as Se,x as we}from"./ui-CeaNA1b8.js";import{r as m,aF as ye,Z as _e,K as Ne,I as Ce,G as Re,T as q,a_ as ke}from"./vendor-CSZBJNtL.js";import{S as Pe}from"./SEOHead-CV9z8O-_.js";import{C as M,a as B,b as I,d as L,c as V}from"./card-clxFFivi.js";import{r as Ee,v as De,a4 as te,X as Ae,W as Te,B as Me,I as J,a5 as Q}from"./index-D230i8hy.js";import{L as Be}from"./label-5YbheAOU.js";import{S as ee}from"./switch-Dcpl_lpr.js";import{A as Ie,B as Ve}from"./use-backend-Xqj8raGa.js";import"./useMutation-1EhplJK_.js";var se=["PageUp","PageDown"],ne=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],re={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},E="Slider",[W,Ke,Le]=Ee(E),[oe]=ve(E,[Le]),[He,U]=oe(E),ae=m.forwardRef((t,s)=>{const{name:o,min:r=0,max:l=100,step:d=1,orientation:a="horizontal",disabled:n=!1,minStepsBetweenThumbs:u=0,defaultValue:x=[r],value:c,onValueChange:i=()=>{},onValueCommit:f=()=>{},inverted:j=!1,form:w,...b}=t,p=m.useRef(new Set),h=m.useRef(0),v=a==="horizontal"?Ue:Oe,[g=[],D]=je({prop:c,defaultProp:x,onChange:S=>{var C;(C=[...p.current][h.current])==null||C.focus(),i(S)}}),O=m.useRef(g);function z(S){const y=Ge(g,S);A(S,y)}function ge(S){A(S,h.current)}function be(){const S=O.current[h.current];g[h.current]!==S&&f(g)}function A(S,y,{commit:C}={commit:!1}){const X=qe(d),F=Je(Math.round((S-r)/d)*d+r,X),T=te(F,[r,l]);D((R=[])=>{const _=We(R,T,y);if(Ze(_,u*d)){h.current=_.indexOf(T);const Z=String(_)!==String(R);return Z&&C&&f(_),Z?_:R}else return R})}return e.jsx(He,{scope:t.__scopeSlider,name:o,disabled:n,min:r,max:l,valueIndexToChangeRef:h,thumbs:p.current,values:g,orientation:a,form:w,children:e.jsx(W.Provider,{scope:t.__scopeSlider,children:e.jsx(W.Slot,{scope:t.__scopeSlider,children:e.jsx(v,{"aria-disabled":n,"data-disabled":n?"":void 0,...b,ref:s,onPointerDown:k(b.onPointerDown,()=>{n||(O.current=g)}),min:r,max:l,inverted:j,onSlideStart:n?void 0:z,onSlideMove:n?void 0:ge,onSlideEnd:n?void 0:be,onHomeKeyDown:()=>!n&&A(r,0,{commit:!0}),onEndKeyDown:()=>!n&&A(l,g.length-1,{commit:!0}),onStepKeyDown:({event:S,direction:y})=>{if(!n){const F=se.includes(S.key)||S.shiftKey&&ne.includes(S.key)?10:1,T=h.current,R=g[T],_=d*F*y;A(R+_,T,{commit:!0})}}})})})})});ae.displayName=E;var[ie,le]=oe(E,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Ue=m.forwardRef((t,s)=>{const{min:o,max:r,dir:l,inverted:d,onSlideStart:a,onSlideMove:n,onSlideEnd:u,onStepKeyDown:x,...c}=t,[i,f]=m.useState(null),j=P(s,v=>f(v)),w=m.useRef(void 0),b=De(l),p=b==="ltr",h=p&&!d||!p&&d;function N(v){const g=w.current||i.getBoundingClientRect(),D=[0,g.width],z=$(D,h?[o,r]:[r,o]);return w.current=g,z(v-g.left)}return e.jsx(ie,{scope:t.__scopeSlider,startEdge:h?"left":"right",endEdge:h?"right":"left",direction:h?1:-1,size:"width",children:e.jsx(ce,{dir:b,"data-orientation":"horizontal",...c,ref:j,style:{...c.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const g=N(v.clientX);a==null||a(g)},onSlideMove:v=>{const g=N(v.clientX);n==null||n(g)},onSlideEnd:()=>{w.current=void 0,u==null||u()},onStepKeyDown:v=>{const D=re[h?"from-left":"from-right"].includes(v.key);x==null||x({event:v,direction:D?-1:1})}})})}),Oe=m.forwardRef((t,s)=>{const{min:o,max:r,inverted:l,onSlideStart:d,onSlideMove:a,onSlideEnd:n,onStepKeyDown:u,...x}=t,c=m.useRef(null),i=P(s,c),f=m.useRef(void 0),j=!l;function w(b){const p=f.current||c.current.getBoundingClientRect(),h=[0,p.height],v=$(h,j?[r,o]:[o,r]);return f.current=p,v(b-p.top)}return e.jsx(ie,{scope:t.__scopeSlider,startEdge:j?"bottom":"top",endEdge:j?"top":"bottom",size:"height",direction:j?1:-1,children:e.jsx(ce,{"data-orientation":"vertical",...x,ref:i,style:{...x.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const p=w(b.clientY);d==null||d(p)},onSlideMove:b=>{const p=w(b.clientY);a==null||a(p)},onSlideEnd:()=>{f.current=void 0,n==null||n()},onStepKeyDown:b=>{const h=re[j?"from-bottom":"from-top"].includes(b.key);u==null||u({event:b,direction:h?-1:1})}})})}),ce=m.forwardRef((t,s)=>{const{__scopeSlider:o,onSlideStart:r,onSlideMove:l,onSlideEnd:d,onHomeKeyDown:a,onEndKeyDown:n,onStepKeyDown:u,...x}=t,c=U(E,o);return e.jsx(K.span,{...x,ref:s,onKeyDown:k(t.onKeyDown,i=>{i.key==="Home"?(a(i),i.preventDefault()):i.key==="End"?(n(i),i.preventDefault()):se.concat(ne).includes(i.key)&&(u(i),i.preventDefault())}),onPointerDown:k(t.onPointerDown,i=>{const f=i.target;f.setPointerCapture(i.pointerId),i.preventDefault(),c.thumbs.has(f)?f.focus():r(i)}),onPointerMove:k(t.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&l(i)}),onPointerUp:k(t.onPointerUp,i=>{const f=i.target;f.hasPointerCapture(i.pointerId)&&(f.releasePointerCapture(i.pointerId),d(i))})})}),de="SliderTrack",ue=m.forwardRef((t,s)=>{const{__scopeSlider:o,...r}=t,l=U(de,o);return e.jsx(K.span,{"data-disabled":l.disabled?"":void 0,"data-orientation":l.orientation,...r,ref:s})});ue.displayName=de;var Y="SliderRange",me=m.forwardRef((t,s)=>{const{__scopeSlider:o,...r}=t,l=U(Y,o),d=le(Y,o),a=m.useRef(null),n=P(s,a),u=l.values.length,x=l.values.map(f=>xe(f,l.min,l.max)),c=u>1?Math.min(...x):0,i=100-Math.max(...x);return e.jsx(K.span,{"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,...r,ref:n,style:{...t.style,[d.startEdge]:c+"%",[d.endEdge]:i+"%"}})});me.displayName=Y;var G="SliderThumb",fe=m.forwardRef((t,s)=>{const o=Ke(t.__scopeSlider),[r,l]=m.useState(null),d=P(s,n=>l(n)),a=m.useMemo(()=>r?o().findIndex(n=>n.ref.current===r):-1,[o,r]);return e.jsx(ze,{...t,ref:d,index:a})}),ze=m.forwardRef((t,s)=>{const{__scopeSlider:o,index:r,name:l,...d}=t,a=U(G,o),n=le(G,o),[u,x]=m.useState(null),c=P(s,N=>x(N)),i=u?a.form||!!u.closest("form"):!0,f=Ae(u),j=a.values[r],w=j===void 0?0:xe(j,a.min,a.max),b=Ye(r,a.values.length),p=f==null?void 0:f[n.size],h=p?$e(p,w,n.direction):0;return m.useEffect(()=>{if(u)return a.thumbs.add(u),()=>{a.thumbs.delete(u)}},[u,a.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[n.startEdge]:`calc(${w}% + ${h}px)`},children:[e.jsx(W.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(K.span,{role:"slider","aria-label":t["aria-label"]||b,"aria-valuemin":a.min,"aria-valuenow":j,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...d,ref:c,style:j===void 0?{display:"none"}:t.style,onFocus:k(t.onFocus,()=>{a.valueIndexToChangeRef.current=r})})}),i&&e.jsx(he,{name:l??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:j},r)]})});fe.displayName=G;var Fe="RadioBubbleInput",he=m.forwardRef(({__scopeSlider:t,value:s,...o},r)=>{const l=m.useRef(null),d=P(l,r),a=Te(s);return m.useEffect(()=>{const n=l.current;if(!n)return;const u=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(u,"value").set;if(a!==s&&c){const i=new Event("input",{bubbles:!0});c.call(n,s),n.dispatchEvent(i)}},[a,s]),e.jsx(K.input,{style:{display:"none"},...o,ref:d,defaultValue:s})});he.displayName=Fe;function We(t=[],s,o){const r=[...t];return r[o]=s,r.sort((l,d)=>l-d)}function xe(t,s,o){const d=100/(o-s)*(t-s);return te(d,[0,100])}function Ye(t,s){return s>2?`Value ${t+1} of ${s}`:s===2?["Minimum","Maximum"][t]:void 0}function Ge(t,s){if(t.length===1)return 0;const o=t.map(l=>Math.abs(l-s)),r=Math.min(...o);return o.indexOf(r)}function $e(t,s,o){const r=t/2,d=$([0,50],[0,r]);return(r-d(s)*o)*o}function Xe(t){return t.slice(0,-1).map((s,o)=>t[o+1]-s)}function Ze(t,s){if(s>0){const o=Xe(t);return Math.min(...o)>=s}return!0}function $(t,s){return o=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const r=(s[1]-s[0])/(t[1]-t[0]);return s[0]+r*(o-t[0])}}function qe(t){return(String(t).split(".")[1]||"").length}function Je(t,s){const o=Math.pow(10,s);return Math.round(t*o)/o}var pe=ae,Qe=ue,et=me,tt=fe;const H=m.forwardRef(({className:t,...s},o)=>e.jsxs(pe,{ref:o,className:Se("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(Qe,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(et,{className:"absolute h-full bg-primary"})}),e.jsx(tt,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));H.displayName=pe.displayName;function ut(){const{data:t,isLoading:s}=Ie(),o=Ve(),[r,l]=m.useState(null),[d,a]=m.useState(!1);t&&!r&&!s&&l(t);const n=r||t||{error_spike_pct:5,ban_spike_pct:8,spend_cap_usd:5e3,unusual_geo_threshold:3,notify_email:!0,notify_webhook:!1,webhook_url:""},u=(c,i)=>{l(f=>({...f||n,[c]:i})),a(!0)},x=async()=>{try{await o.mutateAsync(r),Q.success("Alert thresholds saved successfully"),a(!1)}catch{Q.error("Failed to save configuration")}};return s?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading config..."}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{title:"Admin — Alerts",noindex:!0}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Alert Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure operational thresholds and notification channels."})]}),e.jsxs(we,{onClick:x,disabled:!d,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Save Changes",d&&e.jsx(Me,{variant:"secondary",className:"ml-2 text-xs",children:"unsaved"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs(M,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-base",children:[e.jsx(_e,{className:"h-4 w-4 text-destructive"}),"Error Spike Threshold"]}),e.jsx(L,{children:"Trigger alert when error rate exceeds this percentage."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-2xl font-bold",children:[n.error_spike_pct,"%"]})}),e.jsx(H,{value:[n.error_spike_pct],onValueChange:([c])=>u("error_spike_pct",c),min:1,max:25,step:.5}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: alerts if error rate ",">"," ",n.error_spike_pct,"%"]})]})]}),e.jsxs(M,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ne,{className:"h-4 w-4 text-yellow-600"}),"Ban Spike Threshold"]}),e.jsx(L,{children:"Trigger alert when proxy block/ban rate exceeds this percentage."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-2xl font-bold",children:[n.ban_spike_pct,"%"]})}),e.jsx(H,{value:[n.ban_spike_pct],onValueChange:([c])=>u("ban_spike_pct",c),min:1,max:30,step:.5}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: alerts if ban rate ",">"," ",n.ban_spike_pct,"%"]})]})]}),e.jsxs(M,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ce,{className:"h-4 w-4 text-primary"}),"Spend Cap"]}),e.jsx(L,{children:"Alert when total platform spend exceeds this daily threshold (EUR)."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold",children:"€"}),e.jsx(J,{type:"number",value:n.spend_cap_usd,onChange:c=>u("spend_cap_usd",Number(c.target.value)),className:"max-w-[150px]"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily platform-wide spend alert in EUR."})]})]}),e.jsxs(M,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-base",children:[e.jsx(Re,{className:"h-4 w-4 text-primary"}),"Unusual Geo Usage"]}),e.jsx(L,{children:"Alert when a single user connects from more than N countries in 1 hour."})]}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-2xl font-bold",children:[n.unusual_geo_threshold," countries"]})}),e.jsx(H,{value:[n.unusual_geo_threshold],onValueChange:([c])=>u("unusual_geo_threshold",c),min:2,max:15,step:1}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Flags potential credential sharing or abuse."})]})]})]}),e.jsxs(M,{children:[e.jsx(B,{children:e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"})," Notification Channels"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Send alerts to admin email addresses."})]})]}),e.jsx(ee,{checked:n.notify_email,onCheckedChange:c=>u("notify_email",c)})]}),e.jsxs("div",{className:"space-y-3 rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Webhook"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"POST alert payloads to a custom endpoint."})]})]}),e.jsx(ee,{checked:n.notify_webhook,onCheckedChange:c=>u("notify_webhook",c)})]}),n.notify_webhook&&e.jsxs("div",{className:"space-y-1 pl-7",children:[e.jsx(Be,{className:"text-xs",children:"Webhook URL"}),e.jsx(J,{placeholder:"https://your-service.com/webhook",value:n.webhook_url,onChange:c=>u("webhook_url",c.target.value)})]})]})]})]})]})]})}export{ut as default};
