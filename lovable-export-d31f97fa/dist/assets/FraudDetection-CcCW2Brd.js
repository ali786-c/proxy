import{j as e,x as A}from"./ui-DhchgSRK.js";import{r as C,I as k,aP as R}from"./vendor-Dios4bpT.js";import{F,G as M,H as I,I as H}from"./use-backend-9JRA31jH.js";import{e as U,f as $,g as D,h as B,i as m,B as j,a5 as b}from"./index-Ct2EIi6Q.js";import{C as c,a as x,b as o,c as d}from"./card-ClKFnvWz.js";import{T as u,a as g,b as n,c as a,d as v,e as l}from"./table-BODbY_8L.js";import{T as E,a as V,b as p,c as f}from"./tabs-C-Il2KK3.js";import{f as N}from"./format-sbWH3_uq.js";import"./useMutation-AEPP9WN5.js";const y={low:"bg-blue-500/10 text-blue-500",medium:"bg-yellow-500/10 text-yellow-500",high:"bg-orange-500/10 text-orange-500",critical:"bg-destructive/10 text-destructive"},P={login_anomaly:"Login Anomaly",usage_spike:"Usage Spike",impossible_travel:"Impossible Travel",rapid_auth:"Rapid Auth Attempts"};function le(){const[h,_]=C.useState("unresolved"),{data:r,isLoading:G}=F(h==="all"?void 0:h==="resolved"),{data:i,isLoading:O}=M(),{data:t,isLoading:z}=I(),S=H(),T=async s=>{try{await S.mutateAsync(s),b.success("Signal resolved successfully")}catch{b.error("Failed to resolve signal")}},L=(r==null?void 0:r.filter(s=>s.severity==="critical"&&!s.is_resolved).length)??0,w=(i==null?void 0:i.filter(s=>s.risk_score>=70).length)??0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(k,{className:"h-6 w-6"})," Fraud Detection"]}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor login anomalies, usage abuse, and risk scores"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Active Signals"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.filter(s=>!s.is_resolved).length)??0})})]}),e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Critical Alerts"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:L})})]}),e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"High-Risk Users"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-warning",children:w})})]}),e.jsxs(c,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Login Events (24h)"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.length)??0})})]})]}),e.jsxs(E,{defaultValue:"signals",children:[e.jsxs(V,{children:[e.jsx(p,{value:"signals",children:"Fraud Signals"}),e.jsx(p,{value:"risk",children:"Risk Scores"}),e.jsx(p,{value:"logins",children:"Login History"})]}),e.jsxs(f,{value:"signals",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(U,{value:h,onValueChange:_,children:[e.jsx($,{className:"w-[180px]",children:e.jsx(D,{})}),e.jsxs(B,{children:[e.jsx(m,{value:"all",children:"All Signals"}),e.jsx(m,{value:"unresolved",children:"Unresolved"}),e.jsx(m,{value:"resolved",children:"Resolved"})]})]})}),e.jsx(c,{children:e.jsx(d,{className:"pt-6",children:e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(n,{children:[e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Severity"}),e.jsx(a,{children:"Description"}),e.jsx(a,{children:"Location"}),e.jsx(a,{children:"IP"}),e.jsx(a,{children:"Time"}),e.jsx(a,{children:"Actions"})]})}),e.jsxs(v,{children:[r==null?void 0:r.map(s=>e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(j,{variant:"outline",children:P[s.signal_type]??s.signal_type})}),e.jsx(l,{children:e.jsx("span",{className:`rounded px-2 py-0.5 text-xs font-semibold ${y[s.severity]??""}`,children:s.severity})}),e.jsxs(l,{className:"max-w-[200px] truncate",children:[s.description,s.user&&e.jsxs("div",{className:"text-[10px] text-muted-foreground mt-0.5",children:["User: ",s.user.name||s.user.email]})]}),e.jsx(l,{children:s.geo_city?`${s.geo_city}, ${s.geo_country}`:s.geo_country??"—"}),e.jsx(l,{className:"font-mono text-xs",children:s.ip_address??"—"}),e.jsx(l,{className:"text-xs",children:N(new Date(s.created_at),"MMM d, HH:mm")}),e.jsx(l,{children:s.is_resolved?e.jsx(j,{variant:"secondary",children:"Resolved"}):e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>T(s.id),children:[e.jsx(R,{className:"mr-1 h-3 w-3"})," Resolve"]})})]},s.id)),!(r!=null&&r.length)&&e.jsx(n,{children:e.jsx(l,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No fraud signals detected"})})]})]})})})]}),e.jsx(f,{value:"risk",children:e.jsx(c,{children:e.jsx(d,{className:"pt-6",children:e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(n,{children:[e.jsx(a,{children:"User ID"}),e.jsx(a,{children:"Risk Score"}),e.jsx(a,{children:"Level"}),e.jsx(a,{children:"Factors"}),e.jsx(a,{children:"Last Calculated"})]})}),e.jsxs(v,{children:[i==null?void 0:i.map(s=>e.jsxs(n,{children:[e.jsx(l,{className:"font-mono text-xs",children:s.user?s.user.name||s.user.email:s.user_id}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-16 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.risk_score>=70?"bg-destructive":s.risk_score>=40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${s.risk_score}%`}})}),e.jsx("span",{className:"text-sm font-semibold",children:s.risk_score})]})}),e.jsx(l,{children:e.jsx("span",{className:`rounded px-2 py-0.5 text-xs font-semibold ${y[s.risk_level]??""}`,children:s.risk_level})}),e.jsx(l,{className:"text-xs",children:Array.isArray(s.factors)?s.factors.join(", "):"—"}),e.jsx(l,{className:"text-xs",children:N(new Date(s.last_calculated_at),"MMM d, HH:mm")})]},s.id)),!(i!=null&&i.length)&&e.jsx(n,{children:e.jsx(l,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No risk scores calculated yet"})})]})]})})})}),e.jsx(f,{value:"logins",children:e.jsx(c,{children:e.jsx(d,{className:"pt-6",children:e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(n,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"IP"}),e.jsx(a,{children:"Location"}),e.jsx(a,{children:"User Agent"}),e.jsx(a,{children:"Time"})]})}),e.jsxs(v,{children:[t==null?void 0:t.map(s=>e.jsxs(n,{children:[e.jsx(l,{className:"font-mono text-xs",children:s.user?s.user.name||s.user.email:s.user_id}),e.jsx(l,{children:e.jsx(j,{variant:s.success?"default":"destructive",children:s.success?"Success":"Failed"})}),e.jsx(l,{className:"font-mono text-xs",children:s.ip_address??"—"}),e.jsx(l,{children:s.geo_city?`${s.geo_city}, ${s.geo_country}`:s.geo_country??"—"}),e.jsx(l,{className:"max-w-[150px] truncate text-xs",children:s.user_agent??"—"}),e.jsx(l,{className:"text-xs",children:N(new Date(s.created_at),"MMM d, HH:mm")})]},s.id)),!(t!=null&&t.length)&&e.jsx(n,{children:e.jsx(l,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No login events recorded"})})]})]})})})})]})]})}export{le as default};
